<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <!-- Metadados b√°sicos -->
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Roda das Emo√ß√µes de Plutchik ‚Äì Treino Emocional</title>

  <meta name="description" content="Plataforma cl√≠nica baseada na Roda das Emo√ß√µes de Plutchik para psicoeduca√ß√£o e treino de habilidades emocionais, com registro, gr√°fico, PDF e envio ao psic√≥logo.">
  <meta name="keywords" content="roda das emo√ß√µes, Plutchik, emo√ß√µes, habilidades emocionais, regula√ß√£o emocional, psicologia, terapia, TCC, DBT">
  <meta name="author" content="Richelmy Murta, Psic√≥logo Cl√≠nico">

  <!-- Ajuste a URL abaixo para o endere√ßo real do seu GitHub Pages -->
  <link rel="canonical" href="https://ricmurtapsicologia.github.io/rodaemo-oes/">

  <!-- √çcone simples (trocar se desejar) -->
  <link rel="icon" type="image/png" href="https://i.pinimg.com/736x/78/63/71/7863710610e4f8e6850fd873cbf29dea.jpg">

  <!-- Open Graph / WhatsApp -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Roda das Emo√ß√µes de Plutchik ‚Äì Treino Emocional">
  <meta property="og:description" content="Clique na emo√ß√£o, registre a experi√™ncia, gere PDF e envie ao seu psic√≥logo. Psicoeduca√ß√£o baseada na Roda das Emo√ß√µes de Plutchik.">
  <meta property="og:url" content="https://ricmurtapsicologia.github.io/rodaemo-oes/">
  <meta property="og:image" content="https://i.pinimg.com/736x/78/63/71/7863710610e4f8e6850fd873cbf29dea.jpg">
  <meta property="og:locale" content="pt_BR">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Roda das Emo√ß√µes de Plutchik ‚Äì Treino Emocional">
  <meta name="twitter:description" content="Ferramenta interativa de treino de habilidades emocionais com registro, gr√°fico, PDF e envio ao psic√≥logo.">
  <meta name="twitter:image" content="https://via.placeholder.com/1200x630.png?text=Roda+das+Emocoes">

  <!-- JSON-LD para SEO (WebApplication) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Roda das Emo√ß√µes de Plutchik",
    "description": "Ferramenta interativa de treino de habilidades emocionais baseada na teoria psicoevolutiva de Plutchik.",
    "applicationCategory": "HealthApplication",
    "operatingSystem": "Any",
    "author": {
      "@type": "Person",
      "name": "Richelmy Murta"
    }
  }
  </script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>
  <!-- jsPDF e autoTable para PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js" defer></script>

  <style>
    :root {
      color-scheme: dark;
      --bg: #020617;
      --bg-gradient: radial-gradient(circle at top, #111827 0, #020617 50%, #000 100%);
      --bg-card: #020617;
      --border-subtle: #1f2937;
      --accent: #f97316;
      --accent-soft: rgba(249, 115, 22, 0.3);
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --text-soft: #6b7280;
      --radius-xl: 1.3rem;
      --radius-lg: 1rem;
      --radius-md: 0.75rem;
      --shadow-soft: 0 18px 48px rgba(0, 0, 0, 0.6);
      --focus-ring: 0 0 0 2px rgba(248, 250, 252, 0.28),
                     0 0 0 4px rgba(249, 115, 22, 0.7);
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --stroke-wheel: #020617;
    }

    /* Tema claro ‚Äì sobrescreve vari√°veis */
    body[data-theme="light"] {
      color-scheme: light;
      --bg: #f3f4f6;
      --bg-gradient: radial-gradient(circle at top, #e5e7eb 0, #f9fafb 45%, #e5e7eb 100%);
      --bg-card: #ffffff;
      --border-subtle: #d1d5db;
      --text-main: #111827;
      --text-muted: #4b5563;
      --text-soft: #6b7280;
      --shadow-soft: 0 16px 40px rgba(15, 23, 42, 0.18);
      --accent-soft: rgba(249, 115, 22, 0.15);
      --stroke-wheel: #111827;
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    body {
      font-family: var(--font-main);
      background: var(--bg-gradient);
      color: var(--text-main);
      line-height: 1.5;
      display: flex;
      flex-direction: column;
    }

    /* Cabe√ßalho */

    .app-header {
      border-bottom: 1px solid #111827;
      padding: 0.9rem 1.5rem 0.8rem;
      background: rgba(2, 6, 23, 0.96);
      color: #e5e7eb;
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    body[data-theme="light"] .app-header {
      background: rgba(249, 250, 251, 0.96);
      border-bottom-color: #e5e7eb;
      color: #111827;
    }

    .header-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      gap: 1rem;
      align-items: center;
      justify-content: space-between;
    }

    .brand {
      margin: 0 0 0.1rem;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-soft);
    }

    .app-title {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .app-subtitle {
      margin: 0.35rem 0 0;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .nav-links {
      list-style: none;
      display: flex;
      gap: 0.9rem;
      margin: 0;
      padding: 0;
      font-size: 0.85rem;
      align-items: center;
    }

    .nav-links a {
      color: var(--text-soft);
      text-decoration: none;
      padding: 0.35rem 0.6rem;
      border-radius: 999px;
      transition: background-color 0.12s ease, color 0.12s ease;
    }

    .nav-links a:hover,
    .nav-links a:focus-visible {
      background: rgba(15, 23, 42, 0.9);
      color: #f9fafb;
    }

    body[data-theme="light"] .nav-links a:hover,
    body[data-theme="light"] .nav-links a:focus-visible {
      background: rgba(209, 213, 219, 0.9);
      color: #111827;
    }

    .btn-theme-toggle {
      border-radius: 999px;
      border: 1px solid #4b5563;
      padding: 0.3rem 0.6rem;
      background: rgba(15, 23, 42, 0.9);
      color: #f9fafb;
      cursor: pointer;
      font-size: 0.85rem;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      transition: background 0.12s ease, transform 0.08s ease;
    }

    body[data-theme="light"] .btn-theme-toggle {
      background: #e5e7eb;
      color: #111827;
      border-color: #9ca3af;
    }

    .btn-theme-toggle:hover {
      transform: translateY(-1px);
      background: #111827;
    }

    body[data-theme="light"] .btn-theme-toggle:hover {
      background: #d1d5db;
    }

    .btn-theme-toggle:focus-visible {
      outline: none;
      box-shadow: var(--focus-ring);
    }

    /* Layout principal */

    .layout {
      max-width: 1200px;
      margin: 1.2rem auto 1.5rem;
      padding: 0 1.5rem;
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.8fr);
      grid-template-rows: auto auto;
      gap: 1.3rem;
    }

    .panel {
      background: radial-gradient(circle at top right, #111827 0, var(--bg-card) 50%, var(--bg-card) 100%);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      padding: 1rem 1.1rem 1.1rem;
      min-height: 0;
    }

    body[data-theme="light"] .panel {
      background: radial-gradient(circle at top right, #e5e7eb 0, #ffffff 55%, #ffffff 100%);
    }

    .panel-wheel {
      grid-row: 1 / 3;
    }

    .panel-history {
      grid-column: 1 / 3;
    }

    .panel-header {
      margin-bottom: 0.8rem;
    }

    .section-title {
      margin: 0 0 0.15rem;
      font-size: 1.1rem;
      font-weight: 600;
    }

    .section-subtitle {
      margin: 0;
      font-size: 0.86rem;
      color: var(--text-soft);
    }

    /* Roda de emo√ß√µes */

    .wheel-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .emotion-wheel {
      width: 100%;
      max-width: 380px;
      height: auto;
      display: block;
      margin-bottom: 0.4rem;
    }

    .wheel-help {
      margin: 0;
      font-size: 0.8rem;
      color: var(--text-soft);
      text-align: center;
    }

    .wheel-segment {
      stroke: var(--stroke-wheel);
      stroke-width: 0.8;
      cursor: pointer;
      transition: transform 0.12s ease, stroke-width 0.12s ease, filter 0.12s ease;
    }

    .wheel-segment:focus-visible {
      outline: none;
    }

    .wheel-segment.highlight {
      stroke-width: 2;
      filter: drop-shadow(0 0 4px var(--accent-soft));
      transform: scale(1.03);
    }

    .wheel-label {
      font-size: 6px;
      fill: var(--stroke-wheel);
      text-anchor: middle;
      pointer-events: none;
      user-select: none;
    }

    .wheel-dotted-circle {
      fill: none;
      stroke: var(--stroke-wheel);
      stroke-width: 0.8;
      stroke-dasharray: 2 3;
    }

    /* Detalhes */

    .details-card {
      background: radial-gradient(circle at top left, #111827 0, var(--bg-card) 50%);
      border-radius: var(--radius-lg);
      border: 1px solid #1f2937;
      padding: 0.9rem;
      margin-bottom: 0.8rem;
      min-height: 180px;
    }

    body[data-theme="light"] .details-card {
      border-color: #d1d5db;
    }

    .details-placeholder {
      margin: 0;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .details-emotion-name {
      font-size: 1.15rem;
      font-weight: 600;
      margin: 0 0 0.3rem;
    }

    .details-emotion-meta {
      margin: 0 0 0.3rem;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .details-block {
      margin: 0.25rem 0;
      font-size: 0.88rem;
      color: var(--text-main);
    }

    .details-block strong {
      display: inline-block;
      margin-bottom: 0.05rem;
    }

    .details-list {
      margin: 0.1rem 0 0.25rem 1.1rem;
      padding: 0;
      font-size: 0.86rem;
      color: var(--text-muted);
    }

    /* Formul√°rio */

    .emotion-form {
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
    }

    .form-row-inline {
      display: flex;
      flex-wrap: wrap;
      gap: 0.7rem;
    }

    .form-group {
      flex: 1 1 160px;
    }

    .form-label {
      display: block;
      font-size: 0.82rem;
      color: var(--text-muted);
      margin-bottom: 0.18rem;
    }

    .form-input,
    .form-select,
    textarea {
      width: 100%;
      border-radius: var(--radius-md);
      border: 1px solid #1f2937;
      padding: 0.5rem 0.6rem;
      background: var(--bg-card);
      color: var(--text-main);
      font-family: var(--font-main);
      font-size: 0.9rem;
    }

    body[data-theme="light"] .form-input,
    body[data-theme="light"] .form-select,
    body[data-theme="light"] textarea {
      border-color: #d1d5db;
      background: #ffffff;
    }

    .form-input[readonly] {
      background: #020617;
      color: var(--text-soft);
    }

    body[data-theme="light"] .form-input[readonly] {
      background: #f3f4f6;
    }

    textarea {
      resize: vertical;
      min-height: 70px;
      max-height: 220px;
    }

    textarea::placeholder,
    .form-input::placeholder {
      color: var(--text-soft);
    }

    .form-input:focus,
    .form-select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: var(--focus-ring);
    }

    .form-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      align-items: center;
      justify-content: flex-end;
      margin-top: 0.3rem;
    }

    .btn-primary,
    .btn-secondary,
    .btn-ghost {
      border-radius: 999px;
      padding: 0.55rem 1.2rem;
      font-size: 0.9rem;
      font-weight: 500;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.35rem;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background-color 0.12s ease, opacity 0.1s ease;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent) 0, #fb923c 50%, #facc15 100%);
      color: #111827;
      box-shadow: 0 14px 35px rgba(248, 163, 45, 0.55);
    }

    .btn-primary:disabled {
      opacity: 0.35;
      cursor: not-allowed;
      box-shadow: none;
    }

    .btn-secondary {
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-muted);
      border: 1px solid #1f2937;
    }

    body[data-theme="light"] .btn-secondary {
      background: #f3f4f6;
      border-color: #d1d5db;
      color: #111827;
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-soft);
      border: 1px dashed #374151;
    }

    body[data-theme="light"] .btn-ghost {
      border-color: #9ca3af;
    }

    .btn-primary:hover:not(:disabled),
    .btn-secondary:hover,
    .btn-ghost:hover {
      transform: translateY(-1px);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.65);
    }

    .btn-primary:active:not(:disabled),
    .btn-secondary:active,
    .btn-ghost:active {
      transform: translateY(0);
      box-shadow: 0 8px 22px rgba(0, 0, 0, 0.7);
    }

    .btn-primary:focus-visible,
    .btn-secondary:focus-visible,
    .btn-ghost:focus-visible {
      outline: none;
      box-shadow: var(--focus-ring);
    }

    .helper-text {
      font-size: 0.78rem;
      color: var(--text-soft);
      margin-top: 0.15rem;
    }

    /* Gr√°ficos e hist√≥rico */

    .charts-wrapper {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1.7fr);
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .chart-card,
    .history-card {
      background: rgba(2, 6, 23, 0.96);
      border-radius: var(--radius-lg);
      border: 1px solid #1f2937;
      padding: 0.7rem 0.8rem;
    }

    body[data-theme="light"] .chart-card,
    body[data-theme="light"] .history-card {
      background: #ffffff;
      border-color: #d1d5db;
    }

    .history-card {
      padding-bottom: 0.9rem;
    }

    .chart-title,
    .history-title {
      margin: 0 0 0.3rem;
      font-size: 0.95rem;
    }

    .chart-helper,
    .history-help {
      margin: 0 0 0.35rem;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .history-table-wrapper {
      margin-top: 0.4rem;
      max-height: 260px;
      overflow: auto;
      border-radius: var(--radius-md);
      border: 1px solid #1f2937;
      background: #020617;
    }

    body[data-theme="light"] .history-table-wrapper {
      background: #f9fafb;
      border-color: #d1d5db;
    }

    .history-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
    }

    .history-table th,
    .history-table td {
      padding: 0.32rem 0.4rem;
      border-bottom: 1px solid rgba(31, 41, 55, 0.85);
      text-align: left;
    }

    body[data-theme="light"] .history-table th,
    body[data-theme="light"] .history-table td {
      border-bottom-color: #e5e7eb;
    }

    .history-table th {
      position: sticky;
      top: 0;
      background: #020617;
      z-index: 1;
      font-weight: 600;
      color: var(--text-muted);
    }

    body[data-theme="light"] .history-table th {
      background: #f9fafb;
    }

    .history-table tr:last-child td {
      border-bottom: none;
    }

    .history-table td:nth-child(4) {
      max-width: 220px;
      overflow-wrap: break-word;
    }

    .history-empty {
      margin: 0.4rem 0;
      padding: 0 0.5rem 0.5rem;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .history-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.4rem;
      margin-top: 0.25rem;
    }

    /* Sobre */

    .panel-about {
      margin-top: 0.2rem;
    }

    .about-content {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .about-content ul {
      padding-left: 1rem;
    }

    /* Rodap√© */

    .app-footer {
      margin-top: auto;
      border-top: 1px solid #111827;
      padding: 0.7rem 1.5rem 1.1rem;
      font-size: 0.8rem;
      color: var(--text-soft);
      text-align: center;
    }

    body[data-theme="light"] .app-footer {
      border-top-color: #e5e7eb;
    }

    .app-footer strong {
      font-weight: 600;
    }

    /* Acessibilidade */

    [role="button"],
    svg [tabindex="0"] {
      cursor: pointer;
    }

    /* Responsividade */

    @media (max-width: 1024px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
        grid-template-rows: auto auto auto;
      }

      .panel-wheel {
        grid-row: auto;
      }

      .panel-history {
        grid-column: auto;
      }

      .header-inner {
        flex-direction: column;
        align-items: flex-start;
      }

      .nav-links {
        margin-top: 0.4rem;
      }

      .charts-wrapper {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    @media (max-width: 640px) {
      .layout {
        padding: 0 1rem;
      }

      .app-header {
        padding-inline: 1rem;
      }

      .app-footer {
        padding-inline: 1rem;
      }

      .panel {
        padding: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <header class="app-header">
    <div class="header-inner">
      <div>
        <p class="brand">Atlas Emocional</p>
        <h1 class="app-title">Roda das Emo√ß√µes de Plutchik</h1>
        <p class="app-subtitle">
          Psicoeduca√ß√£o e treino de habilidades emocionais. Clique na emo√ß√£o, registre a situa√ß√£o, gere PDF e envie ao seu psic√≥logo.
        </p>
      </div>
      <nav aria-label="Navega√ß√£o principal">
        <ul class="nav-links">
          <li><a href="#sec-mapa">Mapa</a></li>
          <li><a href="#sec-registro">Registro</a></li>
          <li><a href="#sec-graficos">Hist√≥rico</a></li>
          <li><a href="#sec-sobre">Sobre</a></li>
          <li>
            <button type="button" class="btn-theme-toggle" id="themeToggle">
              <span id="themeIcon">üåô</span>
              <span id="themeLabel">Tema escuro</span>
            </button>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="layout">
    <!-- Roda -->
    <section id="sec-mapa" class="panel panel-wheel" aria-labelledby="titulo-mapa">
      <header class="panel-header">
        <h2 id="titulo-mapa" class="section-title">Mapa emocional interativo</h2>
        <p class="section-subtitle">
          Baseado na Roda das Emo√ß√µes de Plutchik: 8 emo√ß√µes b√°sicas, 3 intensidades e 8 combina√ß√µes entre elas.
        </p>
      </header>

      <div class="wheel-wrapper" aria-live="polite">
        <!-- A roda √© desenhada dinamicamente em SVG pelo JavaScript -->
        <svg
          id="emotionWheel"
          class="emotion-wheel"
          viewBox="-180 -180 360 360"
          role="img"
          aria-label="Roda das Emo√ß√µes de Plutchik com intensidades e combina√ß√µes">
        </svg>
        <p class="wheel-help">
          Clique em qualquer p√©tala ou combina√ß√£o para explorar a emo√ß√£o e registrar sua experi√™ncia.
        </p>
      </div>
    </section>

    <!-- Detalhes e registro -->
    <section id="sec-registro" class="panel panel-details" aria-labelledby="titulo-detalhes">
      <header class="panel-header">
        <h2 id="titulo-detalhes" class="section-title">Detalhes da emo√ß√£o e registro cl√≠nico</h2>
        <p class="section-subtitle">
          Nomeie o que sente, entenda a fun√ß√£o da emo√ß√£o e registre o contexto para trabalhar em sess√£o.
        </p>
      </header>

      <article class="details-card" id="detailsCard" aria-live="polite">
        <p class="details-placeholder">
          Nenhuma emo√ß√£o foi selecionada ainda.
          Use a roda ao lado para escolher uma emo√ß√£o ou combina√ß√£o e ver orienta√ß√µes psicoeducativas.
        </p>
      </article>

      <form class="emotion-form" id="emotionForm">
        <div class="form-row-inline">
          <div class="form-group">
            <label for="patientName" class="form-label">Nome do paciente</label>
            <input id="patientName" class="form-input" type="text" placeholder="Digite o nome do paciente">
          </div>
          <div class="form-group" style="max-width:110px;">
            <label for="patientAge" class="form-label">Idade</label>
            <input id="patientAge" class="form-input" type="number" min="0" max="120" placeholder="Anos">
          </div>
          <div class="form-group" style="max-width:170px;">
            <label for="recordDate" class="form-label">Data de refer√™ncia</label>
            <input id="recordDate" class="form-input" type="date">
          </div>
        </div>

        <div class="form-row-inline">
          <div class="form-group">
            <label for="selectedEmotion" class="form-label">Emo√ß√£o selecionada</label>
            <input id="selectedEmotion" class="form-input" type="text" readonly placeholder="Clique em uma p√©tala na roda">
          </div>
          <div class="form-group">
            <label for="userIntensity" class="form-label">Intensidade percebida</label>
            <select id="userIntensity" class="form-select">
              <option value="leve">Leve</option>
              <option value="moderada" selected>Moderada</option>
              <option value="intensa">Intensa</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="contextInput" class="form-label">Contexto emocional</label>
          <textarea id="contextInput" placeholder="O que aconteceu? Onde voc√™ estava? Com quem?"></textarea>
        </div>

        <div class="form-row-inline">
          <div class="form-group">
            <label for="triggersInput" class="form-label">Gatilhos percebidos</label>
            <textarea id="triggersInput" placeholder="Palavras, imagens, situa√ß√µes ou pensamentos que parecem ativar essa emo√ß√£o."></textarea>
          </div>
          <div class="form-group">
            <label for="behaviorsInput" class="form-label">O que voc√™ fez</label>
            <textarea id="behaviorsInput" placeholder="Como voc√™ reagiu? O que fez ou deixou de fazer?"></textarea>
          </div>
        </div>

        <div class="form-group">
          <label for="desiredInput" class="form-label">Como gostaria de ter reagido</label>
          <textarea id="desiredInput" placeholder="Qual seria uma resposta mais alinhada com seus valores e objetivos?"></textarea>
        </div>

        <p class="helper-text">
          Este registro √© para uso pessoal e para ser compartilhado em sess√£o. Nada √© enviado automaticamente a servidores.
        </p>

        <div class="form-actions">
          <button type="button" class="btn-ghost" id="sendWhatsappButton">
            Enviar resumo ao psic√≥logo
          </button>
          <button type="button" class="btn-secondary" id="downloadPdfButton">
            Baixar PDF do meu registro
          </button>
          <button type="submit" class="btn-primary" id="registerButton" disabled>
            Registrar emo√ß√£o
          </button>
        </div>
      </form>
    </section>

    <!-- Hist√≥rico e gr√°ficos -->
    <section id="sec-graficos" class="panel panel-history" aria-labelledby="titulo-graficos">
      <header class="panel-header">
        <h2 id="titulo-graficos" class="section-title">Hist√≥rico emocional e gr√°fico</h2>
        <p class="section-subtitle">
          Use o hist√≥rico para observar padr√µes e planejar, junto com o psic√≥logo, novas estrat√©gias de cuidado.
        </p>
      </header>

      <div class="charts-wrapper">
        <article class="chart-card" aria-label="Gr√°fico de frequ√™ncia por emo√ß√£o prim√°ria">
          <h3 class="chart-title">Frequ√™ncia das emo√ß√µes b√°sicas</h3>
          <p class="chart-helper">
            Cada barra representa quantas vezes cada emo√ß√£o prim√°ria foi registrada neste navegador
            (diades contam para as duas emo√ß√µes envolvidas).
          </p>
          <div style="height:220px;">
            <canvas id="emotionChart" aria-label="Gr√°fico de barras de frequ√™ncia emocional" role="img"></canvas>
          </div>
        </article>

        <article class="history-card" aria-label="Hist√≥rico de registros emocionais">
          <h3 class="history-title">Hist√≥rico de registros</h3>
          <p class="history-help">
            Os dados ficam salvos apenas neste dispositivo atrav√©s do armazenamento local. Voc√™ pode apag√°-los quando desejar.
          </p>

          <div class="history-table-wrapper">
            <table class="history-table">
              <thead>
                <tr>
                  <th>Data e hora</th>
                  <th>Emo√ß√£o</th>
                  <th>Intensidade</th>
                  <th>Contexto</th>
                </tr>
              </thead>
              <tbody id="historyBody"></tbody>
            </table>
            <p id="historyEmptyMessage" class="history-empty">
              Nenhum registro ainda. Use o formul√°rio acima para registrar sua primeira emo√ß√£o.
            </p>
          </div>

          <div class="history-actions">
            <button type="button" class="btn-secondary" id="clearHistoryButton">
              Limpar hist√≥rico
            </button>
          </div>
        </article>
      </div>
    </section>

    <!-- Sobre -->
    <section id="sec-sobre" class="panel panel-about" aria-labelledby="titulo-sobre">
      <header class="panel-header">
        <h2 id="titulo-sobre" class="section-title">Sobre esta ferramenta</h2>
      </header>
      <article class="about-content">
        <p>
          A Roda das Emo√ß√µes de Plutchik organiza oito emo√ß√µes b√°sicas em diferentes intensidades e combina√ß√µes.
          Esta ferramenta foi adaptada para uso psicoeducativo e cl√≠nico, ajudando na identifica√ß√£o, nomea√ß√£o e
          regula√ß√£o das emo√ß√µes no dia a dia.
        </p>
        <p>
          O objetivo principal √© treinar tr√™s habilidades:
        </p>
        <ul>
          <li>Perceber o que voc√™ est√° sentindo com mais precis√£o.</li>
          <li>Compreender a fun√ß√£o da emo√ß√£o em vez de apenas julg√°-la como boa ou ruim.</li>
          <li>Planejar respostas mais compat√≠veis com seus valores e metas de vida.</li>
        </ul>
        <p>
          Esta ferramenta n√£o substitui psicoterapia ou atendimento m√©dico. √â um recurso de apoio
          para ser usado em conjunto com acompanhamento profissional.
        </p>
      </article>
    </section>
  </main>

  <footer class="app-footer">
    <p>
      <strong>Richelmy Murta ‚Äì Psic√≥logo Cl√≠nico</strong> ‚Ä¢ Ferramenta psicoeducativa baseada na Roda das Emo√ß√µes de Plutchik.
      N√£o substitui atendimento presencial ou online. ¬© <span id="footerYear"></span> ‚Äì Uso cl√≠nico e educativo respons√°vel.
    </p>
  </footer>

  <script>
    "use strict";

    /* ------------------------------------------------------------------
       Configura√ß√£o de emo√ß√µes e diades
       ------------------------------------------------------------------ */

    const PRIMARIES = [
      { key: "joy", label: "Alegria", angle: -90,    colors: "#ffd54a" },
      { key: "trust", label: "Confian√ßa", angle: -45, colors: "#b7f96a" },
      { key: "fear", label: "Medo", angle: 0,        colors: "#4caf50" },
      { key: "surprise", label: "Surpresa", angle: 45,  colors: "#4fc3f7" },
      { key: "sadness", label: "Tristeza", angle: 90,   colors: "#5c6bc0" },
      { key: "disgust", label: "Nojo", angle: 135,   colors: "#ba68c8" },
      { key: "anger", label: "Raiva", angle: 180,   colors: "#ff5252" },
      { key: "anticipation", label: "Antecipa√ß√£o", angle: 225, colors: "#ff9800" }
    ];

    const INTENSITY_CONFIG = {
      joy: [
        { code: "joy_high",   label: "√äxtase",      ring: "high" },
        { code: "joy_mid",    label: "Alegria",     ring: "mid" },
        { code: "joy_low",    label: "Serenidade",  ring: "low" }
      ],
      trust: [
        { code: "trust_high", label: "Admira√ß√£o",   ring: "high" },
        { code: "trust_mid",  label: "Confian√ßa",   ring: "mid" },
        { code: "trust_low",  label: "Aprova√ß√£o",   ring: "low" }
      ],
      fear: [
        { code: "fear_high",  label: "Terror",      ring: "high" },
        { code: "fear_mid",   label: "Medo",        ring: "mid" },
        { code: "fear_low",   label: "Apreens√£o",   ring: "low" }
      ],
      surprise: [
        { code: "surprise_high", label: "Assombro",    ring: "high" },
        { code: "surprise_mid",  label: "Surpresa",    ring: "mid" },
        { code: "surprise_low",  label: "Distra√ß√£o",   ring: "low" }
      ],
      sadness: [
        { code: "sadness_high",  label: "Ang√∫stia",    ring: "high" },
        { code: "sadness_mid",   label: "Tristeza",    ring: "mid" },
        { code: "sadness_low",   label: "T√©dio",       ring: "low" }
      ],
      disgust: [
        { code: "disgust_high",  label: "Repugn√¢ncia", ring: "high" },
        { code: "disgust_mid",   label: "Nojo",        ring: "mid" },
        { code: "disgust_low",   label: "Aborrecimento", ring: "low" }
      ],
      anger: [
        { code: "anger_high",    label: "Ira",         ring: "high" },
        { code: "anger_mid",     label: "Raiva",       ring: "mid" },
        { code: "anger_low",     label: "Irrita√ß√£o",   ring: "low" }
      ],
      anticipation: [
        { code: "anticipation_high", label: "Vigil√¢ncia",  ring: "high" },
        { code: "anticipation_mid",  label: "Antecipa√ß√£o", ring: "mid" },
        { code: "anticipation_low",  label: "Interesse",   ring: "low" }
      ]
    };

    // Diades na ordem dos pares adjacentes: (0-1), (1-2)... (7-0)
    const DIADS = [
      { code: "diad_love",         label: "Amor",          primaryA: "joy",         primaryB: "trust" },
      { code: "diad_submission",   label: "Submiss√£o",     primaryA: "trust",       primaryB: "fear" },
      { code: "diad_intimidation", label: "Intimida√ß√£o",   primaryA: "fear",        primaryB: "surprise" },
      { code: "diad_disapproval",  label: "Desaprova√ß√£o",  primaryA: "surprise",    primaryB: "sadness" },
      { code: "diad_remorse",      label: "Remorso",       primaryA: "sadness",     primaryB: "disgust" },
      { code: "diad_contempt",     label: "Menosprezo",    primaryA: "disgust",     primaryB: "anger" },
      { code: "diad_aggressivity", label: "Agressividade", primaryA: "anger",       primaryB: "anticipation" },
      { code: "diad_optimism",     label: "Otimismo",      primaryA: "anticipation", primaryB: "joy" }
    ];

    const PRIMARY_LABELS = {
      joy: "Alegria",
      trust: "Confian√ßa",
      fear: "Medo",
      surprise: "Surpresa",
      sadness: "Tristeza",
      disgust: "Nojo",
      anger: "Raiva",
      anticipation: "Antecipa√ß√£o"
    };

    /* ------------------------------------------------------------------
       Psicoeduca√ß√£o ‚Äì INFO_MAP
       Cada item tem defini√ß√£o, fun√ß√£o, situa√ß√µes, riscos, estrat√©gias, reflex√µes.
       (Textos compactos, mas cl√≠nicos.)
       ------------------------------------------------------------------ */

    const INFO_MAP = {
      /* ALEGRIA */
      joy_high: {
        displayName: "√äxtase",
        primary: "joy",
        type: "primary",
        ring: "high",
        definition: "Alegria em n√≠vel muito alto, com euforia e sensa√ß√£o de celebra√ß√£o intensa.",
        adaptive: "Marcar conquistas importantes e liberar energia para comemorar.",
        situations: [
          "Alcan√ßar um objetivo de longa data.",
          "Viver experi√™ncias √∫nicas, como formaturas, casamentos ou vit√≥rias marcantes."
        ],
        risks: [
          "Tomar decis√µes impulsivas no auge da euforia.",
          "Comparar o cotidiano com o momento de √™xtase e sentir frustra√ß√£o depois."
        ],
        strategies: [
          "Adiar decis√µes importantes para algumas horas depois da intensa euforia.",
          "Registrar o que este momento revela sobre seus valores e esfor√ßos."
        ],
        reflections: [
          "Que compromisso quero assumir comigo ap√≥s esta conquista?",
          "Como posso celebrar sem agredir meus pr√≥prios limites?"
        ]
      },
      joy_mid: {
        displayName: "Alegria",
        primary: "joy",
        type: "primary",
        ring: "mid",
        definition: "Estado de satisfa√ß√£o e bem-estar ao vivenciar algo positivo e significativo.",
        adaptive: "Refor√ßar comportamentos saud√°veis e aproximar de pessoas e atividades valiosas.",
        situations: [
          "Compartilhar boas not√≠cias com algu√©m importante.",
          "Desfrutar de momentos de lazer e conex√£o afetiva."
        ],
        risks: [
          "Ignorar emo√ß√µes dif√≠ceis para parecer sempre alegre.",
          "Usar apenas prazer imediato como crit√©rio para decis√µes."
        ],
        strategies: [
          "Dividir a alegria com algu√©m de confian√ßa, sem compara√ß√£o.",
          "Aproveitar a energia da alegria para iniciar h√°bitos saud√°veis."
        ],
        reflections: [
          "O que, al√©m do prazer, torna esta situa√ß√£o cheia de sentido?",
          "Como posso cuidar para que esta alegria n√£o vire autoexig√™ncia?"
        ]
      },
      joy_low: {
        displayName: "Serenidade",
        primary: "joy",
        type: "primary",
        ring: "low",
        definition: "Calma suave, sensa√ß√£o de tranquilidade e conforto, sem grande excita√ß√£o.",
        adaptive: "Permitir descanso, recupera√ß√£o e aprecia√ß√£o de momentos simples.",
        situations: [
          "Fim de um dia produtivo com tempo para desacelerar.",
          "Estar em local seguro, fazendo algo que traz paz."
        ],
        risks: [
          "Adiar mudan√ßas necess√°rias por estar confort√°vel demais.",
          "Minimizar necessidades emocionais para n√£o desestabilizar a calma."
        ],
        strategies: [
          "Notar sensa√ß√µes corporais de relaxamento e seguran√ßa.",
          "Usar a serenidade para refletir com clareza sobre pr√≥ximos passos."
        ],
        reflections: [
          "Do que esta calma est√° me protegendo?",
          "Que pequena a√ß√£o posso planejar a partir desta serenidade?"
        ]
      },

      /* CONFIAN√áA */
      trust_high: {
        displayName: "Admira√ß√£o",
        primary: "trust",
        type: "primary",
        ring: "high",
        definition: "Confian√ßa intensa misturada com respeito e inspira√ß√£o por algu√©m ou algo.",
        adaptive: "Oferecer modelos de crescimento e motivar desenvolvimento pessoal.",
        situations: [
          "Observar algu√©m enfrentando dificuldades com integridade.",
          "Estudar pessoas que representam valores que voc√™ deseja cultivar."
        ],
        risks: [
          "Idealizar o outro e sentir-se sempre menor.",
          "Copiar comportamentos sem considerar seus pr√≥prios limites."
        ],
        strategies: [
          "Identificar quais qualidades admir√°veis voc√™ j√° possui em algum grau.",
          "Transformar admira√ß√£o em metas concretas, pequenas e realistas."
        ],
        reflections: [
          "O que exatamente admiro e como isso conversa com meus valores?",
          "Como posso aprender com esta pessoa sem me apagar?"
        ]
      },
      trust_mid: {
        displayName: "Confian√ßa",
        primary: "trust",
        type: "primary",
        ring: "mid",
        definition: "Sensa√ß√£o de seguran√ßa em rela√ß√£o a algu√©m, a si mesmo ou a uma situa√ß√£o.",
        adaptive: "Permitir coopera√ß√£o, delega√ß√£o e constru√ß√£o de v√≠nculos est√°veis.",
        situations: [
          "Parcerias em que os combinados s√£o cumpridos.",
          "Relacionamentos nos quais segredos s√£o respeitados."
        ],
        risks: [
          "Acreditar demais em pessoas pouco confi√°veis.",
          "Fechar os olhos para sinais de desrespeito por medo de perder seguran√ßa."
        ],
        strategies: [
          "Estabelecer limites claros e revis√°-los quando necess√°rio.",
          "Observar se voc√™ tamb√©m se comporta de forma confi√°vel."
        ],
        reflections: [
          "Que limites saud√°veis podem proteger essa confian√ßa?",
          "O quanto confio em mim para sustentar minhas escolhas?"
        ]
      },
      trust_low: {
        displayName: "Aprova√ß√£o",
        primary: "trust",
        type: "primary",
        ring: "low",
        definition: "Sensa√ß√£o de ser aceito, reconhecido ou validado por outra pessoa ou grupo.",
        adaptive: "Fortalecer v√≠nculos e facilitar coopera√ß√£o em ambientes seguros.",
        situations: [
          "Receber feedback respeitoso sobre o seu trabalho.",
          "Ser inclu√≠do em decis√µes importantes."
        ],
        risks: [
          "Depender da aprova√ß√£o externa para se sentir suficiente.",
          "Evitar conversas dif√≠ceis para n√£o decepcionar o outro."
        ],
        strategies: [
          "Reconhecer internamente as pr√≥prias qualidades, al√©m do elogio.",
          "Equilibrar o desejo de agradar com seus valores pessoais."
        ],
        reflections: [
          "Em quais √°reas tenho buscado apenas aprova√ß√£o externa?",
          "Que tipo de autoaprova√ß√£o quero construir?"
        ]
      },

      /* MEDO */
      fear_high: {
        displayName: "Terror",
        primary: "fear",
        type: "primary",
        ring: "high",
        definition: "Medo extremo, com sensa√ß√£o de amea√ßa grave e perda de controle.",
        adaptive: "Ativar resposta de emerg√™ncia quando a integridade est√° em risco real.",
        situations: [
          "Acidentes, viol√™ncia ou situa√ß√µes traum√°ticas.",
          "Crises intensas de p√¢nico."
        ],
        risks: [
          "Generalizar o terror para contextos seguros.",
          "Evitar ajuda por medo de reviver lembran√ßas."
        ],
        strategies: [
          "Buscar ancoragem no presente com est√≠mulos seguros (contato visual, tato, respira√ß√£o).",
          "Procurar ajuda profissional para trabalhar experi√™ncias traum√°ticas."
        ],
        reflections: [
          "Que recursos tenho hoje que n√£o tinha em momentos passados?",
          "Quem pode caminhar comigo neste processo de reconstru√ß√£o?"
        ]
      },
      fear_mid: {
        displayName: "Medo",
        primary: "fear",
        type: "primary",
        ring: "mid",
        definition: "Resposta a amea√ßa percebida, preparando o corpo para prote√ß√£o.",
        adaptive: "Proteger sua integridade f√≠sica e emocional, evitando perigos reais.",
        situations: [
          "Contextos de instabilidade ou riscos concretos.",
          "Medo de rejei√ß√£o, perda de v√≠nculo ou fracasso relevante."
        ],
        risks: [
          "Evitar cronicamente situa√ß√µes essenciais para seus objetivos.",
          "Ignorar riscos reais por tentar n√£o sentir medo algum."
        ],
        strategies: [
          "Distinguir perigos reais de possibilidades imaginadas.",
          "Enfrentar gradualmente situa√ß√µes importantes, com plano e apoio."
        ],
        reflections: [
          "O que este medo revela sobre o que √© valioso para mim?",
          "Em qual ponto o medo me protege e em qual ponto me paralisa?"
        ]
      },
      fear_low: {
        displayName: "Apreens√£o",
        primary: "fear",
        type: "primary",
        ring: "low",
        definition: "Preocupa√ß√£o leve com algo que pode dar errado, mas ainda incerto.",
        adaptive: "Alertar sobre poss√≠veis riscos e incentivar prepara√ß√£o antecipada.",
        situations: [
          "Esperar resultados de provas, exames ou entrevistas.",
          "Iniciar atividades novas ainda desconhecidas."
        ],
        risks: [
          "Transformar apreens√£o em rumina√ß√£o sem a√ß√£o.",
          "Confundir possibilidade com certeza de desastre."
        ],
        strategies: [
          "Listar o que est√° sob seu controle e agir sobre isso.",
          "Definir um pequeno primeiro passo ao inv√©s de tentar resolver tudo."
        ],
        reflections: [
          "Que parte desta apreens√£o √© fato e qual √© hip√≥tese?",
          "Que atitude realista posso tomar hoje?"
        ]
      },

      /* SURPRESA */
      surprise_high: {
        displayName: "Assombro",
        primary: "surprise",
        type: "primary",
        ring: "high",
        definition: "Surpresa intensa diante de algo muito diferente do esperado.",
        adaptive: "For√ßar reavalia√ß√£o r√°pida de cren√ßas e expectativas.",
        situations: [
          "Impactos positivos ou negativos muito acima do previsto.",
          "Descobertas que mudam sua vis√£o de mundo."
        ],
        risks: [
          "Congelar e n√£o conseguir agir diante da novidade.",
          "Criar conclus√µes extremas com base em um √∫nico evento."
        ],
        strategies: [
          "Buscar mais informa√ß√µes antes de decidir.",
          "Conversar com algu√©m de confian√ßa para organizar o impacto."
        ],
        reflections: [
          "Que vis√£o minha est√° sendo convidada a amadurecer?",
          "O que posso aprender com esse assombro sem negar meu susto?"
        ]
      },
      surprise_mid: {
        displayName: "Surpresa",
        primary: "surprise",
        type: "primary",
        ring: "mid",
        definition: "Quebra de expectativa por algo inesperado.",
        adaptive: "Interromper o piloto autom√°tico e reavaliar a situa√ß√£o.",
        situations: [
          "Mudan√ßas de agenda de √∫ltima hora.",
          "Receber not√≠cias que n√£o estavam no radar."
        ],
        risks: [
          "Responder impulsivamente antes de entender o contexto.",
          "Tratar qualquer mudan√ßa como amea√ßa."
        ],
        strategies: [
          "Dar um tempo antes de tomar decis√µes.",
          "Perguntar, investigar e esclarecer antes de concluir."
        ],
        reflections: [
          "Esta surpresa abre alguma oportunidade de crescimento?",
          "O que ainda preciso compreender melhor aqui?"
        ]
      },
      surprise_low: {
        displayName: "Distra√ß√£o",
        primary: "surprise",
        type: "primary",
        ring: "low",
        definition: "Desvio leve de aten√ß√£o por est√≠mulos novos e constantes.",
        adaptive: "Redirecionar o foco para algo que pode ser mais relevante.",
        situations: [
          "Notifica√ß√µes frequentes em dispositivos.",
          "Interrup√ß√µes leves durante o trabalho."
        ],
        risks: [
          "Fragmentar a aten√ß√£o e perder profundidade nas tarefas.",
          "Confundir urg√™ncia com import√¢ncia real."
        ],
        strategies: [
          "Definir janelas espec√≠ficas para checar notifica√ß√µes.",
          "Praticar per√≠odos curtos de foco total em uma √∫nica tarefa."
        ],
        reflections: [
          "O que realmente merece minha aten√ß√£o agora?",
          "Que limite simples posso testar para proteger meu foco?"
        ]
      },

      /* TRISTEZA */
      sadness_high: {
        displayName: "Ang√∫stia",
        primary: "sadness",
        type: "primary",
        ring: "high",
        definition: "Tristeza profunda misturada a aperto interno e sensa√ß√£o de peso.",
        adaptive: "Sinalizar que algo muito importante foi ferido ou perdido.",
        situations: [
          "Luto por pessoas, rela√ß√µes ou projetos.",
          "Ac√∫mulo de frustra√ß√µes significativas."
        ],
        risks: [
          "Perder a esperan√ßa e deixar de buscar ajuda.",
          "Confundir ang√∫stia com identidade permanente."
        ],
        strategies: [
          "Procurar apoio profissional e rede de confian√ßa.",
          "Fatiar tarefas em passos m√≠nimos, respeitando o ritmo do momento."
        ],
        reflections: [
          "Que partes de mim pedem acolhimento, n√£o julgamento?",
          "Qual pequeno gesto de cuidado √© poss√≠vel hoje?"
        ]
      },
      sadness_mid: {
        displayName: "Tristeza",
        primary: "sadness",
        type: "primary",
        ring: "mid",
        definition: "Resposta a perdas, frustra√ß√µes ou afastamentos importantes.",
        adaptive: "Favorecer recolhimento, elabora√ß√£o e busca de apoio.",
        situations: [
          "Fim de ciclos ou rela√ß√µes significativas.",
          "Percep√ß√£o de que algo esperado n√£o aconteceu."
        ],
        risks: [
          "Isolamento prolongado e abandono de rotinas necess√°rias.",
          "Tratar tristeza como sinal de fraqueza."
        ],
        strategies: [
          "Permitir-se sentir sem autoacusa√ß√£o.",
          "Manter pequenas rotinas de sono, alimenta√ß√£o e contato social."
        ],
        reflections: [
          "O que esta tristeza protege ou tenta mostrar?",
          "De que tipo de ajuda real eu precisaria agora?"
        ]
      },
      sadness_low: {
        displayName: "T√©dio",
        primary: "sadness",
        type: "primary",
        ring: "low",
        definition: "Sensa√ß√£o de vazio leve, desinteresse ou falta de est√≠mulo.",
        adaptive: "Indicar necessidade de novos desafios ou mudan√ßas de rota.",
        situations: [
          "Rotinas muito repetitivas.",
          "Fases de transi√ß√£o em que o futuro ainda √© indefinido."
        ],
        risks: [
          "Buscar apenas distra√ß√µes autom√°ticas para fugir do t√©dio.",
          "Interpretar t√©dio como prova de incapacidade."
        ],
        strategies: [
          "Explorar pequenas novidades saud√°veis na rotina.",
          "Refletir sobre o que perdeu sentido e o que poderia ganhar vida de novo."
        ],
        reflections: [
          "Que √°rea da minha vida pede renova√ß√£o?",
          "O que eu gostava de fazer e abandonei?"
        ]
      },

      /* NOJO */
      disgust_high: {
        displayName: "Repugn√¢ncia",
        primary: "disgust",
        type: "primary",
        ring: "high",
        definition: "Nojo intenso e avers√£o forte, com desejo de afastamento imediato.",
        adaptive: "Proteger de situa√ß√µes que violam profundamente seus limites f√≠sicos ou morais.",
        situations: [
          "Viv√™ncias de abuso, humilha√ß√£o ou viol√™ncia.",
          "Contato com atitudes consideradas degradantes."
        ],
        risks: [
          "Estender repugn√¢ncia para si mesmo, gerando vergonha extrema.",
          "Fechar qualquer possibilidade de di√°logo quando seria √∫til."
        ],
        strategies: [
          "Distinguir atos espec√≠ficos de toda a identidade da pessoa.",
          "Reafirmar limites com apoio profissional quando necess√°rio."
        ],
        reflections: [
          "Que valor essencial est√° sendo tocado por esta repugn√¢ncia?",
          "Como posso me proteger sem me desumanizar?"
        ]
      },
      disgust_mid: {
        displayName: "Nojo",
        primary: "disgust",
        type: "primary",
        ring: "mid",
        definition: "Rea√ß√£o de repulsa a algo percebido como contaminante ou ofensivo.",
        adaptive: "Afastar de ambientes, atitudes ou rela√ß√µes que ferem a integridade.",
        situations: [
          "Ambientes fisicamente sujos.",
          "Comportamentos que v√£o contra seus princ√≠pios b√°sicos."
        ],
        risks: [
          "Transformar nojo em julgamento r√≠gido de grupos inteiros.",
          "Usar repulsa para justificar desrespeito."
        ],
        strategies: [
          "Diferenciar prote√ß√£o leg√≠tima de preconceito.",
          "Estabelecer dist√¢ncia saud√°vel de situa√ß√µes realmente t√≥xicas."
        ],
        reflections: [
          "O que desejo proteger em mim quando sinto nojo?",
          "H√° outra forma de defender meus valores sem desumanizar ningu√©m?"
        ]
      },
      disgust_low: {
        displayName: "Aborrecimento",
        primary: "disgust",
        type: "primary",
        ring: "low",
        definition: "Desgosto leve ou inc√¥modo persistente com algo que n√£o agrada.",
        adaptive: "Indicar que ajustes podem ser necess√°rios na rotina ou nas rela√ß√µes.",
        situations: [
          "Conversas repetitivas que j√° n√£o fazem sentido.",
          "Pequenas atitudes que v√£o contra o que voc√™ considera adequado."
        ],
        risks: [
          "Acumular aborrecimento at√© explodir.",
          "Descontar irrita√ß√£o em pessoas que n√£o t√™m rela√ß√£o direta."
        ],
        strategies: [
          "Identificar o que exatamente incomoda.",
          "Comunicar inc√¥modos cedo, de forma objetiva e respeitosa."
        ],
        reflections: [
          "Esta situa√ß√£o fere valores ou apenas prefer√™ncias?",
          "Que ajuste simples poderia reduzir este aborrecimento?"
        ]
      },

      /* RAIVA */
      anger_high: {
        displayName: "Ira",
        primary: "anger",
        type: "primary",
        ring: "high",
        definition: "Raiva intensa, com grande energia para confronto.",
        adaptive: "Proteger limites e reagir a injusti√ßas s√©rias.",
        situations: [
          "Humilha√ß√µes repetidas.",
          "Quebra grave de confian√ßa."
        ],
        risks: [
          "Atacar de forma que gere danos irrevers√≠veis.",
          "Reagir sempre com guerra, mesmo quando n√£o necess√°rio."
        ],
        strategies: [
          "Afastar-se por alguns minutos antes de agir.",
          "Escrever o que deseja dizer e revisar depois."
        ],
        reflections: [
          "Que limite meu est√° sendo violado aqui?",
          "O que eu n√£o quero mais tolerar e como posso comunicar isso?"
        ]
      },
      anger_mid: {
        displayName: "Raiva",
        primary: "anger",
        type: "primary",
        ring: "mid",
        definition: "Resposta a frustra√ß√µes ou injusti√ßas percebidas, com energia de oposi√ß√£o.",
        adaptive: "Indicar necessidade de defender direitos ou ajustar rela√ß√µes.",
        situations: [
          "Cr√≠ticas injustas.",
          "Expectativas quebradas sem di√°logo."
        ],
        risks: [
          "Transformar qualquer frustra√ß√£o em conflito.",
          "Engolir raiva por medo de conflitos e adoecer por dentro."
        ],
        strategies: [
          "Nomear a raiva e reconhecer o que ela protege.",
          "Escolher um momento adequado para conversas dif√≠ceis."
        ],
        reflections: [
          "O que esta raiva est√° tentando proteger em mim?",
          "Qual seria uma forma firme e respeitosa de agir?"
        ]
      },
      anger_low: {
        displayName: "Irrita√ß√£o",
        primary: "anger",
        type: "primary",
        ring: "low",
        definition: "Inc√¥modo diante de pequenas falhas, atrasos ou invas√µes de espa√ßo.",
        adaptive: "Sinalizar ajustes necess√°rios na rotina, nos limites e na comunica√ß√£o.",
        situations: [
          "Interrup√ß√µes constantes em tarefas importantes.",
          "Descuidos repetidos com combinados simples."
        ],
        risks: [
          "Guardar irrita√ß√£o at√© explodir por algo pequeno.",
          "Ignorar sinais de cansa√ßo e sobrecarga."
        ],
        strategies: [
          "Comunicar inc√¥modos cedo, antes de acumular.",
          "Criar pausas curtas para reduzir tens√£o f√≠sica."
        ],
        reflections: [
          "Que pedido claro eu ainda n√£o fiz?",
          "O que posso ajustar antes que a irrita√ß√£o aumente?"
        ]
      },

      /* ANTECIPA√á√ÉO */
      anticipation_high: {
        displayName: "Vigil√¢ncia",
        primary: "anticipation",
        type: "primary",
        ring: "high",
        definition: "Estado de alerta elevado, monitorando riscos ou oportunidades o tempo todo.",
        adaptive: "Proteger em contextos de alta responsabilidade e instabilidade.",
        situations: [
          "Cuidar de pessoas vulner√°veis em situa√ß√µes cr√≠ticas.",
          "Liderar equipes em momentos de crise."
        ],
        risks: [
          "Exaust√£o por se manter sempre em hiperalerta.",
          "Dificuldade de relaxar mesmo em ambientes seguros."
        ],
        strategies: [
          "Estabelecer janelas reais de descanso e desligamento.",
          "Delegar tarefas quando poss√≠vel, confiando em outras pessoas."
        ],
        reflections: [
          "Em quais momentos posso abaixar a guarda com seguran√ßa?",
          "Que custo tenho pago por me manter sempre vigilante?"
        ]
      },
      anticipation_mid: {
        displayName: "Antecipa√ß√£o",
        primary: "anticipation",
        type: "primary",
        ring: "mid",
        definition: "Expectativa ativa em rela√ß√£o ao futuro, com foco em planejamento.",
        adaptive: "Organizar recursos e preparar-se para pr√≥ximos passos.",
        situations: [
          "Planejar mudan√ßas importantes.",
          "Preparar apresenta√ß√µes, provas ou projetos relevantes."
        ],
        risks: [
          "Confundir planejamento com controle total.",
          "Viver tanto no futuro que perde o presente."
        ],
        strategies: [
          "Transformar expectativas em planos escritos e realistas.",
          "Separar o que √© control√°vel do que n√£o depende de voc√™."
        ],
        reflections: [
          "Minha antecipa√ß√£o est√° me organizando ou me consumindo?",
          "Qual pequeno passo posso dar hoje em dire√ß√£o ao que desejo?"
        ]
      },
      anticipation_low: {
        displayName: "Interesse",
        primary: "anticipation",
        type: "primary",
        ring: "low",
        definition: "Curiosidade tranquila por algo novo ou diferente.",
        adaptive: "Estimular explora√ß√£o, aprendizagem e abertura para possibilidades.",
        situations: [
          "Conhecer pessoas e temas novos.",
          "Iniciar leituras ou projetos por curiosidade."
        ],
        risks: [
          "Espalhar energia em muitos interesses sem aprofundar nenhum.",
          "Usar apenas novidades para fugir de temas dif√≠ceis."
        ],
        strategies: [
          "Escolher poucos focos de interesse por vez.",
          "Registrar o que desperta curiosidade genu√≠na, n√£o s√≥ modas."
        ],
        reflections: [
          "O que este interesse diz sobre quem estou me tornando?",
          "Que a√ß√£o pequena posso fazer hoje para honrar essa curiosidade?"
        ]
      },

      /* ----------------- DIADES ----------------- */
      diad_love: {
        displayName: "Amor",
        type: "diad",
        primaries: ["joy", "trust"],
        definition: "Combina√ß√£o de alegria e confian√ßa que gera v√≠nculo profundo e cuidado m√∫tuo.",
        adaptive: "Sustentar rela√ß√µes de apoio, compromisso e pertencimento.",
        situations: [
          "Rela√ß√µes nas quais h√° alegria em estar junto e confian√ßa constru√≠da.",
          "Cuidado consistente em fam√≠lia, amizades e parcerias."
        ],
        risks: [
          "Confundir amor com necessidade de se anular.",
          "Tolerar desrespeitos em nome de n√£o ficar s√≥."
        ],
        strategies: [
          "Equilibrar entrega com preserva√ß√£o de limites pessoais.",
          "Comunicar necessidades com honestidade em vez de adivinhar."
        ],
        reflections: [
          "Que tipo de amor quero construir: posse ou parceria?",
          "Onde posso cuidar de mim sem deixar de cuidar do outro?"
        ]
      },
      diad_submission: {
        displayName: "Submiss√£o",
        type: "diad",
        primaries: ["trust", "fear"],
        definition: "Mistura de confian√ßa com medo, levando a ceder demais para evitar conflito.",
        adaptive: "Pode proteger em contextos hier√°rquicos r√≠gidos ou de risco real.",
        situations: [
          "Rela√ß√µes onde uma parte tem muito mais poder.",
          "Ambientes em que discordar parece perigoso."
        ],
        risks: [
          "Perder a pr√≥pria voz e identidade.",
          "Aceitar abusos por medo de desagradar."
        ],
        strategies: [
          "Come√ßar por pequenos gestos de autoafirma√ß√£o.",
          "Identificar pessoas seguras para compartilhar d√∫vidas e limites."
        ],
        reflections: [
          "Em quais √°reas tenho dito sempre sim quando queria dizer n√£o?",
          "Que consequ√™ncia real temo enfrentar ao me posicionar?"
        ]
      },
      diad_intimidation: {
        displayName: "Intimida√ß√£o",
        type: "diad",
        primaries: ["fear", "surprise"],
        definition: "Combina√ß√£o de medo e surpresa diante de algu√©m ou situa√ß√£o que imp√µe poder.",
        adaptive: "Alertar sobre riscos e ajudar a avaliar limites do outro.",
        situations: [
          "Ambientes em que a autoridade √© usada de forma hostil.",
          "Situa√ß√µes em que cr√≠ticas v√™m com humilha√ß√£o."
        ],
        risks: [
          "Aceitar padr√µes de viol√™ncia como normais.",
          "Silenciar necessidades por sentir-se pequeno demais."
        ],
        strategies: [
          "Buscar apoio externo para avaliar a situa√ß√£o.",
          "Fortalecer redes de suporte para n√£o enfrentar tudo sozinho."
        ],
        reflections: [
          "Este medo √© proporcional ao risco ou √† forma como fui tratado no passado?",
          "Que passos graduais podem reduzir a sensa√ß√£o de amea√ßa?"
        ]
      },
      diad_disapproval: {
        displayName: "Desaprova√ß√£o",
        type: "diad",
        primaries: ["surprise", "sadness"],
        definition: "Mistura de surpresa e tristeza ao perceber algo como errado ou decepcionante.",
        adaptive: "Rever escolhas, limites e alinhamento com valores.",
        situations: [
          "Descobrir comportamentos que v√£o contra o que voc√™ esperava.",
          "Perceber falhas √©ticas em pessoas de refer√™ncia."
        ],
        risks: [
          "Se tornar excessivamente cr√≠tico e r√≠gido.",
          "Usar desaprova√ß√£o para excluir, n√£o para dialogar."
        ],
        strategies: [
          "Diferenciar pessoa, comportamento e contexto.",
          "Buscar conversas claras antes de romper v√≠nculos."
        ],
        reflections: [
          "O que exatamente me decepciona aqui?",
          "H√° espa√ßo para repara√ß√£o ou apenas para afastamento saud√°vel?"
        ]
      },
      diad_remorse: {
        displayName: "Remorso",
        type: "diad",
        primaries: ["sadness", "disgust"],
        definition: "Tristeza misturada a nojo de si mesmo pelo que fez ou deixou de fazer.",
        adaptive: "Reconhecer erros, aprender com eles e buscar repara√ß√£o.",
        situations: [
          "Atitudes impulsivas que ferem algu√©m importante.",
          "Negligenciar responsabilidades significativas."
        ],
        risks: [
          "Ficar preso em autopuni√ß√£o sem mudan√ßa real.",
          "Tratar-se como irrecuper√°vel."
        ],
        strategies: [
          "Assumir responsabilidade sem se reduzir apenas ao erro.",
          "Planejar a√ß√µes concretas de repara√ß√£o ou mudan√ßa."
        ],
        reflections: [
          "O que posso aprender com este erro?",
          "Que passo real de reparo posso dar, mesmo pequeno?"
        ]
      },
      diad_contempt: {
        displayName: "Menosprezo",
        type: "diad",
        primaries: ["disgust", "anger"],
        definition: "Nojo misturado com raiva, levando a olhar o outro como inferior.",
        adaptive: "Proteger-se de rela√ß√µes realmente abusivas quando usado com consci√™ncia.",
        situations: [
          "Contato repetido com atitudes desrespeitosas.",
          "Rela√ß√µes marcadas por manipula√ß√£o e explora√ß√£o."
        ],
        risks: [
          "Desumanizar pessoas, fechando qualquer ponte de di√°logo.",
          "Projetar no outro aquilo que n√£o tolera em si mesmo."
        ],
        strategies: [
          "Diferenciar afastar-se por prote√ß√£o de atacar por desprezo.",
          "Trabalhar em terapia sentimentos de superioridade defensiva."
        ],
        reflections: [
          "Estou me protegendo ou punindo?",
          "Que vulnerabilidade minha este menosprezo tenta encobrir?"
        ]
      },
      diad_aggressivity: {
        displayName: "Agressividade",
        type: "diad",
        primaries: ["anger", "anticipation"],
        definition: "Raiva combinada com antecipa√ß√£o, preparando ataques e confrontos constantes.",
        adaptive: "Pode ser √∫til para defender direitos em contextos hostis, quando bem dosada.",
        situations: [
          "Ambientes competitivos e pouco cooperativos.",
          "Hist√≥rico de precise se defender sozinho."
        ],
        risks: [
          "Entrar em guerra onde bastaria firmeza.",
          "Romper rela√ß√µes antes de tentar negocia√ß√£o."
        ],
        strategies: [
          "Avaliar custo-benef√≠cio de cada batalha.",
          "Direcionar energia para a√ß√µes criativas e n√£o apenas combativas."
        ],
        reflections: [
          "Quais lutas valem realmente meu desgaste?",
          "Como posso defender meus limites sem me destruir?"
        ]
      },
      diad_optimism: {
        displayName: "Otimismo",
        type: "diad",
        primaries: ["anticipation", "joy"],
        definition: "Combina√ß√£o de antecipa√ß√£o e alegria, olhando o futuro com esperan√ßa realista.",
        adaptive: "Sustentar motiva√ß√£o, perseveran√ßa e vis√£o de possibilidades.",
        situations: [
          "Come√ßo de projetos importantes.",
          "Processos de recupera√ß√£o ap√≥s per√≠odos dif√≠ceis."
        ],
        risks: [
          "Desconsiderar riscos concretos em nome de esperan√ßa ing√™nua.",
          "Culpar-se quando as coisas n√£o saem como esperado."
        ],
        strategies: [
          "Equilibrar entusiasmo com an√°lise realista.",
          "Rever planos sem abandonar o senso de possibilidade."
        ],
        reflections: [
          "Onde posso ajustar meu plano sem perder a esperan√ßa?",
          "Que evid√™ncias sustentam meu otimismo hoje?"
        ]
      }
    };

    /* ------------------------------------------------------------------
       Utilidades
       ------------------------------------------------------------------ */

    function shadeColor(hex, percent) {
      // Ajuste simples de luminosidade (% negativo escurece, positivo clareia)
      let num = parseInt(hex.replace("#", ""), 16);
      let r = (num >> 16) + percent;
      let g = ((num >> 8) & 0x00FF) + percent;
      let b = (num & 0x0000FF) + percent;
      r = Math.max(Math.min(255, r), 0);
      g = Math.max(Math.min(255, g), 0);
      b = Math.max(Math.min(255, b), 0);
      return "#" + (b | (g << 8) | (r << 16)).toString(16).padStart(6, "0");
    }

    function formatDateTime(date) {
      const pad = (n) => String(n).padStart(2, "0");
      return `${pad(date.getDate())}/${pad(date.getMonth() + 1)}/${date.getFullYear()} ${pad(date.getHours())}:${pad(date.getMinutes())}`;
    }

    function truncate(text, max) {
      if (!text) return "";
      return text.length > max ? text.slice(0, max) + "‚Ä¶" : text;
    }

    /* ------------------------------------------------------------------
       Desenho da roda em SVG
       ------------------------------------------------------------------ */

    function buildWheel() {
      const svg = document.getElementById("emotionWheel");
      svg.innerHTML = "";

      const centerX = 0;
      const centerY = 0;
      const stepAngle = 45; // 8 emo√ß√µes
      const innerR = 35;
      const midR = 80;
      const outerR = 125;
      const diadInnerR = 140;
      const diadOuterR = 165;

      const degToRad = (deg) => (deg * Math.PI) / 180;

      function createWedge(rInner, rOuter, startDeg, endDeg, options) {
        const startRad = degToRad(startDeg);
        const endRad = degToRad(endDeg);

        const x1 = centerX + rInner * Math.cos(startRad);
        const y1 = centerY + rInner * Math.sin(startRad);
        const x2 = centerX + rInner * Math.cos(endRad);
        const y2 = centerY + rInner * Math.sin(endRad);
        const x3 = centerX + rOuter * Math.cos(endRad);
        const y3 = centerY + rOuter * Math.sin(endRad);
        const x4 = centerX + rOuter * Math.cos(startRad);
        const y4 = centerY + rOuter * Math.sin(startRad);

        const largeArcFlag = endDeg - startDeg <= 180 ? 0 : 1;

        const d = [
          "M", x1, y1,
          "A", rInner, rInner, 0, largeArcFlag, 1, x2, y2,
          "L", x3, y3,
          "A", rOuter, rOuter, 0, largeArcFlag, 0, x4, y4,
          "Z"
        ].join(" ");

        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path.setAttribute("d", d);
        path.setAttribute("fill", options.fill || "#ccc");
        path.setAttribute("class", "wheel-segment");
        path.setAttribute("tabindex", "0");
        path.setAttribute("role", "button");
        path.dataset.code = options.code;
        path.dataset.type = options.type;
        path.dataset.primary = options.primary || "";
        path.dataset.ring = options.ring || "";
        path.setAttribute("aria-label", options.ariaLabel || "");
        svg.appendChild(path);

        // Eventos de intera√ß√£o (clique e teclado)
        path.addEventListener("click", () => handleEmotionSelection(options.code));
        path.addEventListener("keydown", (ev) => {
          if (ev.key === "Enter" || ev.key === " ") {
            ev.preventDefault();
            handleEmotionSelection(options.code);
          }
        });

        return { path, startDeg, endDeg, rInner, rOuter };
      }

      // C√≠rculo pontilhado das diades
      const dotted = document.createElementNS("http://www.w3.org/2000/svg", "circle");
      dotted.setAttribute("cx", centerX);
      dotted.setAttribute("cy", centerY);
      dotted.setAttribute("r", (diadInnerR + diadOuterR) / 2);
      dotted.setAttribute("class", "wheel-dotted-circle");
      svg.appendChild(dotted);

      // Desenhar p√©talas de intensidade (alta, m√©dia, baixa)
      const allSegments = {};

      PRIMARIES.forEach((primary, index) => {
        const baseAngle = primary.angle;
        const width = stepAngle * 0.80;
        const start = baseAngle - width / 2;
        const end = baseAngle + width / 2;
        const baseColor = primary.colors;

        const intensities = INTENSITY_CONFIG[primary.key];

        intensities.forEach((item) => {
          let rin, rout, delta;
          if (item.ring === "high") {
            rin = innerR;
            rout = (innerR + midR) / 2;
            delta = -25;
          } else if (item.ring === "mid") {
            rin = (innerR + midR) / 2;
            rout = (midR + outerR) / 2;
            delta = 0;
          } else {
            rin = (midR + outerR) / 2;
            rout = outerR;
            delta = 20;
          }

          const fillColor = shadeColor(baseColor, delta);
          const seg = createWedge(
            rin,
            rout,
            start,
            end,
            {
              fill: fillColor,
              code: item.code,
              type: "primary",
              primary: primary.key,
              ring: item.ring,
              ariaLabel: item.label + " (" + PRIMARY_LABELS[primary.key] + ")"
            }
          );
          allSegments[item.code] = seg;

          // Label central aproximado
          const labelAngle = baseAngle;
          const labelRadius = (rin + rout) / 2;
          const lx = centerX + labelRadius * Math.cos(degToRad(labelAngle));
          const ly = centerY + labelRadius * Math.sin(degToRad(labelAngle));

          const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
          text.setAttribute("x", lx);
          text.setAttribute("y", ly + 2); // pequeno ajuste
          text.setAttribute("class", "wheel-label");
          text.textContent = item.label.toLowerCase();
          svg.appendChild(text);
        });
      });

      // Desenhar diades
      DIADS.forEach((diad, index) => {
        const primary = PRIMARIES[index];
        const baseAngle = primary.angle + stepAngle / 2;
        const width = stepAngle * 0.55;
        const start = baseAngle - width / 2;
        const end = baseAngle + width / 2;
        const baseColor = PRIMARIES[index].colors;
        const fillColor = shadeColor(baseColor, 25);

        const seg = createWedge(
          diadInnerR,
          diadOuterR,
          start,
          end,
          {
            fill: fillColor,
            code: diad.code,
            type: "diad",
            primary: diad.primaryA,
            ring: "diad",
            ariaLabel: diad.label
          }
        );
        allSegments[diad.code] = seg;

        const labelAngle = baseAngle;
        const labelRadius = (diadInnerR + diadOuterR) / 2;
        const lx = centerX + labelRadius * Math.cos(degToRad(labelAngle));
        const ly = centerY + labelRadius * Math.sin(degToRad(labelAngle));

        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("x", lx);
        text.setAttribute("y", ly + 2);
        text.setAttribute("class", "wheel-label");
        text.textContent = diad.label.toLowerCase();
        svg.appendChild(text);
      });

      // Guardar refer√™ncia global para remover/colocar highlight
      window._wheelSegments = allSegments;
    }

    /* ------------------------------------------------------------------
       Estado global simples
       ------------------------------------------------------------------ */

    let currentEmotionCode = null;
    let currentChart = null;
    const STORAGE_KEY = "plutchik_records_v1";

    function getRecords() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch {
        return [];
      }
    }

    function saveRecords(records) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
    }

    /* ------------------------------------------------------------------
       Renderiza√ß√£o do painel de detalhes
       ------------------------------------------------------------------ */

    function handleEmotionSelection(code) {
      const info = INFO_MAP[code];
      if (!info) return;

      currentEmotionCode = code;

      // Highlight na roda
      if (window._wheelSegments) {
        Object.values(window._wheelSegments).forEach(obj => obj.path.classList.remove("highlight"));
        const seg = window._wheelSegments[code];
        if (seg) seg.path.classList.add("highlight");
      }

      const card = document.getElementById("detailsCard");
      const primaryLabel = info.primary ? PRIMARY_LABELS[info.primary] : null;

      let levelText = "";
      if (info.type === "primary") {
        if (info.ring === "high") levelText = "Alta intensidade";
        else if (info.ring === "mid") levelText = "Intensidade m√©dia";
        else levelText = "Baixa intensidade";
      } else {
        levelText = "Combina√ß√£o de duas emo√ß√µes adjacentes (diade)";
      }

      let typeText = "";
      if (info.type === "primary" && primaryLabel) {
        typeText = "Emo√ß√£o b√°sica: " + primaryLabel;
      } else if (info.type === "diad" && info.primaries) {
        typeText = "Combina√ß√£o entre " + PRIMARY_LABELS[info.primaries[0]] + " e " + PRIMARY_LABELS[info.primaries[1]];
      }

      const createList = (items) => {
        if (!items || !items.length) return "";
        return "<ul class=\"details-list\">" + items.map(it => "<li>" + it + "</li>").join("") + "</ul>";
      };

      card.innerHTML = `
        <h3 class="details-emotion-name"><strong>${info.displayName}</strong></h3>
        <p class="details-emotion-meta">${levelText}${typeText ? " ‚Ä¢ " + typeText : ""}</p>
        <p class="details-block"><strong>Defini√ß√£o:</strong> ${info.definition}</p>
        <p class="details-block"><strong>Fun√ß√£o adaptativa:</strong> ${info.adaptive}</p>
        <p class="details-block"><strong>Situa√ß√µes em que costuma aparecer:</strong></p>
        ${createList(info.situations)}
        <p class="details-block"><strong>Quando a emo√ß√£o n√£o √© bem manejada:</strong></p>
        ${createList(info.risks)}
        <p class="details-block"><strong>Estrat√©gias de regula√ß√£o emocional:</strong></p>
        ${createList(info.strategies)}
        <p class="details-block"><strong>Perguntas para reflex√£o:</strong></p>
        ${createList(info.reflections)}
      `;

      // Atualizar campo de emo√ß√£o selecionada
      const emotionInput = document.getElementById("selectedEmotion");
      let label = info.displayName;
      if (info.type === "primary" && primaryLabel) {
        label += " ‚Äì " + primaryLabel;
      }
      if (info.type === "diad" && info.primaries) {
        label += " (" + PRIMARY_LABELS[info.primaries[0]] + " + " + PRIMARY_LABELS[info.primaries[1]] + ")";
      }
      emotionInput.value = label;

      document.getElementById("registerButton").disabled = false;
    }

    /* ------------------------------------------------------------------
       Hist√≥rico e gr√°fico
       ------------------------------------------------------------------ */

    function renderHistory() {
      const tbody = document.getElementById("historyBody");
      const emptyMsg = document.getElementById("historyEmptyMessage");
      const records = getRecords();

      tbody.innerHTML = "";

      if (!records.length) {
        emptyMsg.style.display = "block";
      } else {
        emptyMsg.style.display = "none";
      }

      records
        .slice()
        .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
        .forEach((rec) => {
          const tr = document.createElement("tr");
          const dateCell = document.createElement("td");
          const emotionCell = document.createElement("td");
          const intensityCell = document.createElement("td");
          const contextCell = document.createElement("td");

          dateCell.textContent = formatDateTime(new Date(rec.createdAt));
          emotionCell.textContent = rec.emotionLabel;
          intensityCell.textContent = rec.userIntensity;
          contextCell.textContent = truncate(rec.context || "", 120);

          tr.appendChild(dateCell);
          tr.appendChild(emotionCell);
          tr.appendChild(intensityCell);
          tr.appendChild(contextCell);
          tbody.appendChild(tr);
        });
    }

    function buildChart() {
      const ctx = document.getElementById("emotionChart").getContext("2d");
      const labels = [
        "Alegria",
        "Confian√ßa",
        "Medo",
        "Surpresa",
        "Tristeza",
        "Nojo",
        "Raiva",
        "Antecipa√ß√£o"
      ];
      currentChart = new Chart(ctx, {
        type: "bar",
        data: {
          labels,
          datasets: [{
            label: "Registros",
            data: new Array(labels.length).fill(0)
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              ticks: { color: "var(--text-main)" },
              grid: { display: false }
            },
            y: {
              ticks: { color: "var(--text-main)" },
              grid: { color: "rgba(148, 163, 184, 0.3)" },
              beginAtZero: true,
              precision: 0
            }
          },
          plugins: {
            legend: {
              labels: {
                color: "var(--text-main)"
              }
            }
          }
        }
      });

      updateChart();
    }

    function updateChart() {
      if (!currentChart) return;
      const records = getRecords();
      const counts = {
        joy: 0,
        trust: 0,
        fear: 0,
        surprise: 0,
        sadness: 0,
        disgust: 0,
        anger: 0,
        anticipation: 0
      };

      records.forEach((rec) => {
        if (rec.type === "primary" && rec.primaryKey) {
          counts[rec.primaryKey] = (counts[rec.primaryKey] || 0) + 1;
        } else if (rec.type === "diad" && rec.primaries) {
          // Aqui as diades contam para as duas emo√ß√µes envolvidas.
          rec.primaries.forEach((p) => {
            counts[p] = (counts[p] || 0) + 1;
          });
        }
      });

      currentChart.data.datasets[0].data = [
        counts.joy,
        counts.trust,
        counts.fear,
        counts.surprise,
        counts.sadness,
        counts.disgust,
        counts.anger,
        counts.anticipation
      ];
      currentChart.update();
    }

    /* ------------------------------------------------------------------
       Registro de emo√ß√£o
       ------------------------------------------------------------------ */

    function handleFormSubmit(event) {
      event.preventDefault();
      if (!currentEmotionCode || !INFO_MAP[currentEmotionCode]) {
        alert("Selecione uma emo√ß√£o na roda antes de registrar.");
        return;
      }

      const info = INFO_MAP[currentEmotionCode];
      const name = document.getElementById("patientName").value.trim();
      const age = document.getElementById("patientAge").value.trim();
      const recordDate = document.getElementById("recordDate").value;
      const userIntensity = document.getElementById("userIntensity").value;
      const context = document.getElementById("contextInput").value.trim();
      const triggers = document.getElementById("triggersInput").value.trim();
      const behaviors = document.getElementById("behaviorsInput").value.trim();
      const desired = document.getElementById("desiredInput").value.trim();

      const now = new Date();

      const emotionLabel = document.getElementById("selectedEmotion").value || info.displayName;

      const record = {
        id: now.getTime(),
        createdAt: now.toISOString(),
        patientName: name,
        patientAge: age,
        patientDate: recordDate || null,
        emotionCode: currentEmotionCode,
        emotionLabel,
        type: info.type,
        ring: info.ring || "diad",
        primaryKey: info.primary || null,
        primaries: info.primaries || null,
        userIntensity,
        context,
        triggers,
        behaviors,
        desired
      };

      const records = getRecords();
      records.push(record);
      saveRecords(records);

      renderHistory();
      updateChart();

      alert("Registro salvo localmente com sucesso.");
    }

    /* ------------------------------------------------------------------
       PDF cl√≠nico com jsPDF + autoTable
       ------------------------------------------------------------------ */

    async function handleDownloadPdf() {
      if (!currentEmotionCode || !INFO_MAP[currentEmotionCode]) {
        alert("Selecione uma emo√ß√£o na roda antes de gerar o PDF.");
        return;
      }

      const info = INFO_MAP[currentEmotionCode];
      const emotionLabel = document.getElementById("selectedEmotion").value || info.displayName;
      const userIntensity = document.getElementById("userIntensity").value;
      const name = document.getElementById("patientName").value.trim();
      const age = document.getElementById("patientAge").value.trim();
      const recordDate = document.getElementById("recordDate").value;
      const context = document.getElementById("contextInput").value.trim();
      const triggers = document.getElementById("triggersInput").value.trim();
      const behaviors = document.getElementById("behaviorsInput").value.trim();
      const desired = document.getElementById("desiredInput").value.trim();

      const now = new Date();
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF("p", "mm", "a4");

      const margin = 15;
      let y = 18;

      doc.setFont("helvetica", "bold");
      doc.setFontSize(16);
      doc.text("Registro Emocional ‚Äì Roda de Plutchik", margin, y);
      y += 8;

      doc.setFontSize(11);
      doc.setFont("helvetica", "normal");

      const dateLabel = recordDate
        ? recordDate.split("-").reverse().join("/")
        : formatDateTime(now).split(" ")[0];

      const headerLines = [
        "Paciente: " + (name || "________________________") +
        "   Idade: " + (age || "____") +
        "   Data de refer√™ncia: " + dateLabel,
        "Emo√ß√£o selecionada: " + emotionLabel,
        "Intensidade percebida: " + userIntensity +
        "   Gerado em: " + formatDateTime(now)
      ];

      headerLines.forEach((line) => {
        doc.text(line, margin, y);
        y += 6;
      });

      y += 2;
      doc.setFont("helvetica", "bold");
      doc.text("Resumo psicoeducativo da emo√ß√£o", margin, y);
      y += 6;

      doc.setFont("helvetica", "normal");
      const paragraph = [
        "Defini√ß√£o: " + info.definition,
        "Fun√ß√£o adaptativa: " + info.adaptive
      ].join(" ");

      const wrapped = doc.splitTextToSize(paragraph, 180);
      doc.text(wrapped, margin, y);
      y += wrapped.length * 5 + 4;

      doc.setFont("helvetica", "bold");
      doc.text("Pontos de aten√ß√£o e estrat√©gias", margin, y);
      y += 6;
      doc.setFont("helvetica", "normal");

      const bullets = []
        .concat(info.risks.map((r) => "Risco: " + r))
        .concat(info.strategies.map((s) => "Estrat√©gia: " + s));

      const bulletsWrapped = doc.splitTextToSize(bullets.join(" "), 180);
      doc.text(bulletsWrapped, margin, y);
      y += bulletsWrapped.length * 5 + 4;

      // Tabela com campos do paciente
      const tableBody = [
        ["Contexto emocional", context || "-"],
        ["Gatilhos percebidos", triggers || "-"],
        ["Respostas comportamentais (o que fez)", behaviors || "-"],
        ["Resposta desejada (como gostaria de reagir)", desired || "-"]
      ];

      doc.autoTable({
        startY: y,
        head: [["Campo", "Conte√∫do"]],
        body: tableBody,
        styles: { font: "helvetica", fontSize: 10, cellPadding: 3, valign: "top" },
        headStyles: { fillColor: [15, 23, 42], textColor: 255 },
        columnStyles: {
          0: { cellWidth: 60 },
          1: { cellWidth: 120 }
        },
        margin: { left: margin, right: margin }
      });

      let finalY = doc.lastAutoTable.finalY || y + 10;
      finalY += 6;

      doc.setFont("helvetica", "bold");
      doc.text("Orienta√ß√µes gerais e espa√ßo para anota√ß√µes", margin, finalY);
      finalY += 6;
      doc.setFont("helvetica", "normal");
      const closingText = doc.splitTextToSize(
        "Este registro √© um ponto de partida para a conversa em psicoterapia. " +
        "Use este material para identificar padr√µes, aprofundar reflex√µes e planejar respostas mais alinhadas aos seus valores. " +
        "Espa√ßo para anota√ß√µes adicionais do paciente e do psic√≥logo:",
        180
      );
      doc.text(closingText, margin, finalY);
      finalY += closingText.length * 5 + 4;

      // Linhas para anota√ß√µes
      for (let i = 0; i < 5; i++) {
        doc.line(margin, finalY, 210 - margin, finalY);
        finalY += 6;
      }

      doc.save("registro-emocional-plutchik.pdf");
    }

    /* ------------------------------------------------------------------
       Envio para WhatsApp
       ------------------------------------------------------------------ */

    function handleSendWhatsapp() {
      if (!currentEmotionCode || !INFO_MAP[currentEmotionCode]) {
        alert("Selecione uma emo√ß√£o na roda antes de enviar o resumo.");
        return;
      }

      const info = INFO_MAP[currentEmotionCode];
      const emotionLabel = document.getElementById("selectedEmotion").value || info.displayName;
      const userIntensity = document.getElementById("userIntensity").value;
      const name = document.getElementById("patientName").value.trim();
      const age = document.getElementById("patientAge").value.trim();
      const recordDate = document.getElementById("recordDate").value;
      const context = document.getElementById("contextInput").value.trim();
      const now = new Date();

      const dateLabel = recordDate
        ? recordDate.split("-").reverse().join("/")
        : formatDateTime(now).split(" ")[0];

      const shortContext = truncate(context || "", 200);

      // PARA CUSTOMIZAR O TEXTO DA MENSAGEM:
      // Ajuste a string textPlain abaixo conforme a necessidade cl√≠nica/comunicacional.
      const textPlain =
        "Registro emocional ‚Äì Roda de Plutchik\n" +
        "Paciente: " + (name || "-") + (age ? " (" + age + " anos)" : "") + "\n" +
        "Data de refer√™ncia: " + dateLabel + "\n" +
        "Emo√ß√£o: " + emotionLabel + "\n" +
        "Intensidade percebida: " + userIntensity + "\n" +
        "Resumo do contexto: " + (shortContext || "-") + "\n\n" +
        "Mensagem enviada automaticamente pela ferramenta cl√≠nica de registro emocional.";

      const url = "https://wa.me/5535984640729?text=" + encodeURIComponent(textPlain);
      window.open(url, "_blank");
    }

    /* ------------------------------------------------------------------
       Tema claro/escuro
       ------------------------------------------------------------------ */

    function applyTheme(theme) {
      const body = document.body;
      const icon = document.getElementById("themeIcon");
      const label = document.getElementById("themeLabel");

      if (theme === "light") {
        body.dataset.theme = "light";
        icon.textContent = "‚òÄÔ∏è";
        label.textContent = "Tema claro";
      } else {
        body.dataset.theme = "dark";
        icon.textContent = "üåô";
        label.textContent = "Tema escuro";
      }
      localStorage.setItem("plutchik_theme", theme);
    }

    function initTheme() {
      const saved = localStorage.getItem("plutchik_theme");
      if (saved === "light" || saved === "dark") {
        applyTheme(saved);
      } else {
        applyTheme("dark");
      }
      const btn = document.getElementById("themeToggle");
      btn.addEventListener("click", () => {
        const next = document.body.dataset.theme === "light" ? "dark" : "light";
        applyTheme(next);
      });
    }

    /* ------------------------------------------------------------------
       Inicializa√ß√£o
       ------------------------------------------------------------------ */

    document.addEventListener("DOMContentLoaded", () => {
      // Ano no rodap√©
      document.getElementById("footerYear").textContent = new Date().getFullYear();

      // Data padr√£o do registro (hoje)
      const today = new Date();
      const isoToday = today.toISOString().slice(0, 10);
      document.getElementById("recordDate").value = isoToday;

      initTheme();
      buildWheel();
      renderHistory();
      buildChart();

      document.getElementById("emotionForm").addEventListener("submit", handleFormSubmit);
      document.getElementById("downloadPdfButton").addEventListener("click", handleDownloadPdf);
      document.getElementById("sendWhatsappButton").addEventListener("click", handleSendWhatsapp);
      document.getElementById("clearHistoryButton").addEventListener("click", () => {
        if (confirm("Deseja realmente apagar todo o hist√≥rico deste navegador?")) {
          saveRecords([]);
          renderHistory();
          updateChart();
        }
      });
    });
  </script>
</body>
</html><!DOCTYPE html>
<html lang="pt-BR">
<head>
  <!-- Metadados b√°sicos -->
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Roda das Emo√ß√µes de Plutchik ‚Äì Treino Emocional</title>

  <meta name="description" content="Plataforma cl√≠nica baseada na Roda das Emo√ß√µes de Plutchik para psicoeduca√ß√£o e treino de habilidades emocionais, com registro, gr√°fico, PDF e envio ao psic√≥logo.">
  <meta name="keywords" content="roda das emo√ß√µes, Plutchik, emo√ß√µes, habilidades emocionais, regula√ß√£o emocional, psicologia, terapia, TCC, DBT">
  <meta name="author" content="Richelmy Murta, Psic√≥logo Cl√≠nico">

  <!-- Ajuste a URL abaixo para o endere√ßo real do seu GitHub Pages -->
  <link rel="canonical" href="https://ricmurtapsicologia.github.io/rodaemo-oes/">

  <!-- √çcone: refer√™ncia visual da roda em formato de flor -->
  <link rel="icon" type="image/jpeg" href="https://i.pinimg.com/736x/78/63/71/7863710610e4f8e6850fd873cbf29dea.jpg">

  <!-- Open Graph / WhatsApp -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Roda das Emo√ß√µes de Plutchik ‚Äì Treino Emocional">
  <meta property="og:description" content="Clique na emo√ß√£o, registre a experi√™ncia, gere PDF e envie ao seu psic√≥logo. Psicoeduca√ß√£o baseada na Roda das Emo√ß√µes de Plutchik.">
  <meta property="og:url" content="https://ricmurtapsicologia.github.io/rodaemo-oes/">
  <meta property="og:image" content="https://i.pinimg.com/736x/78/63/71/7863710610e4f8e6850fd873cbf29dea.jpg">
  <meta property="og:locale" content="pt_BR">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Roda das Emo√ß√µes de Plutchik ‚Äì Treino Emocional">
  <meta name="twitter:description" content="Ferramenta interativa de treino de habilidades emocionais com registro, gr√°fico, PDF e envio ao psic√≥logo.">
  <meta name="twitter:image" content="https://i.pinimg.com/736x/78/63/71/7863710610e4f8e6850fd873cbf29dea.jpg">

  <!-- JSON-LD para SEO (WebApplication) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Roda das Emo√ß√µes de Plutchik",
    "description": "Ferramenta interativa de treino de habilidades emocionais baseada na teoria psicoevolutiva de Plutchik.",
    "applicationCategory": "HealthApplication",
    "operatingSystem": "Any",
    "author": {
      "@type": "Person",
      "name": "Richelmy Murta"
    }
  }
  </script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>
  <!-- jsPDF e autoTable para PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js" defer></script>

  <style>
    :root {
      color-scheme: dark;
      --bg: #020617;
      --bg-gradient: radial-gradient(circle at top, #111827 0, #020617 50%, #000 100%);
      --bg-card: #020617;
      --border-subtle: #1f2937;
      --accent: #f97316;
      --accent-soft: rgba(249, 115, 22, 0.3);
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --text-soft: #6b7280;
      --radius-xl: 1.3rem;
      --radius-lg: 1rem;
      --radius-md: 0.75rem;
      --shadow-soft: 0 18px 48px rgba(0, 0, 0, 0.6);
      --focus-ring: 0 0 0 2px rgba(248, 250, 252, 0.28),
                     0 0 0 4px rgba(249, 115, 22, 0.7);
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --stroke-wheel: #020617;
    }

    /* Tema claro ‚Äì sobrescreve vari√°veis */
    body[data-theme="light"] {
      color-scheme: light;
      --bg: #f3f4f6;
      --bg-gradient: radial-gradient(circle at top, #e5e7eb 0, #f9fafb 45%, #e5e7eb 100%);
      --bg-card: #ffffff;
      --border-subtle: #d1d5db;
      --text-main: #111827;
      --text-muted: #4b5563;
      --text-soft: #6b7280;
      --shadow-soft: 0 16px 40px rgba(15, 23, 42, 0.18);
      --accent-soft: rgba(249, 115, 22, 0.15);
      --stroke-wheel: #111827;
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    body {
      font-family: var(--font-main);
      background: var(--bg-gradient);
      color: var(--text-main);
      line-height: 1.5;
      display: flex;
      flex-direction: column;
    }

    /* Cabe√ßalho */

    .app-header {
      border-bottom: 1px solid #111827;
      padding: 0.9rem 1.5rem 0.8rem;
      background: rgba(2, 6, 23, 0.96);
      color: #e5e7eb;
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    body[data-theme="light"] .app-header {
      background: rgba(249, 250, 251, 0.96);
      border-bottom-color: #e5e7eb;
      color: #111827;
    }

    .header-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      gap: 1rem;
      align-items: center;
      justify-content: space-between;
    }

    .brand {
      margin: 0 0 0.1rem;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-soft);
    }

    .app-title {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .app-subtitle {
      margin: 0.35rem 0 0;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .nav-links {
      list-style: none;
      display: flex;
      gap: 0.9rem;
      margin: 0;
      padding: 0;
      font-size: 0.85rem;
      align-items: center;
    }

    .nav-links a {
      color: var(--text-soft);
      text-decoration: none;
      padding: 0.35rem 0.6rem;
      border-radius: 999px;
      transition: background-color 0.12s ease, color 0.12s ease;
    }

    .nav-links a:hover,
    .nav-links a:focus-visible {
      background: rgba(15, 23, 42, 0.9);
      color: #f9fafb;
    }

    body[data-theme="light"] .nav-links a:hover,
    body[data-theme="light"] .nav-links a:focus-visible {
      background: rgba(209, 213, 219, 0.9);
      color: #111827;
    }

    .btn-theme-toggle {
      border-radius: 999px;
      border: 1px solid #4b5563;
      padding: 0.3rem 0.6rem;
      background: rgba(15, 23, 42, 0.9);
      color: #f9fafb;
      cursor: pointer;
      font-size: 0.85rem;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      transition: background 0.12s ease, transform 0.08s ease;
    }

    body[data-theme="light"] .btn-theme-toggle {
      background: #e5e7eb;
      color: #111827;
      border-color: #9ca3af;
    }

    .btn-theme-toggle:hover {
      transform: translateY(-1px);
      background: #111827;
    }

    body[data-theme="light"] .btn-theme-toggle:hover {
      background: #d1d5db;
    }

    .btn-theme-toggle:focus-visible {
      outline: none;
      box-shadow: var(--focus-ring);
    }

    /* Layout principal */

    .layout {
      max-width: 1200px;
      margin: 1.2rem auto 1.5rem;
      padding: 0 1.5rem;
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.8fr);
      grid-template-rows: auto auto;
      gap: 1.3rem;
    }

    .panel {
      background: radial-gradient(circle at top right, #111827 0, var(--bg-card) 50%, var(--bg-card) 100%);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      padding: 1rem 1.1rem 1.1rem;
      min-height: 0;
    }

    body[data-theme="light"] .panel {
      background: radial-gradient(circle at top right, #e5e7eb 0, #ffffff 55%, #ffffff 100%);
    }

    .panel-wheel {
      grid-row: 1 / 3;
    }

    .panel-history {
      grid-column: 1 / 3;
    }

    .panel-header {
      margin-bottom: 0.8rem;
    }

    .section-title {
      margin: 0 0 0.15rem;
      font-size: 1.1rem;
      font-weight: 600;
    }

    .section-subtitle {
      margin: 0;
      font-size: 0.86rem;
      color: var(--text-soft);
    }

    /* Roda de emo√ß√µes (flor SVG) */

    .wheel-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .emotion-wheel {
      width: 100%;
      max-width: 380px;
      height: auto;
      display: block;
      margin-bottom: 0.4rem;
    }

    .wheel-help {
      margin: 0;
      font-size: 0.8rem;
      color: var(--text-soft);
      text-align: center;
    }

    .wheel-segment {
      stroke: var(--stroke-wheel);
      stroke-width: 0.8;
      cursor: pointer;
      transition: transform 0.12s ease, stroke-width 0.12s ease, filter 0.12s ease;
    }

    .wheel-segment:focus-visible {
      outline: none;
      stroke-width: 2;
      filter: drop-shadow(0 0 4px var(--accent-soft));
    }

    .wheel-segment.highlight {
      stroke-width: 2;
      filter: drop-shadow(0 0 4px var(--accent-soft));
      transform: scale(1.03);
    }

    .wheel-label {
      font-size: 6px;
      fill: var(--stroke-wheel);
      text-anchor: middle;
      pointer-events: none;
      user-select: none;
    }

    .wheel-dotted-circle {
      fill: none;
      stroke: var(--stroke-wheel);
      stroke-width: 0.8;
      stroke-dasharray: 2 3;
    }

    /* Detalhes */

    .details-card {
      background: radial-gradient(circle at top left, #111827 0, var(--bg-card) 50%);
      border-radius: var(--radius-lg);
      border: 1px solid #1f2937;
      padding: 0.9rem;
      margin-bottom: 0.8rem;
      min-height: 180px;
    }

    body[data-theme="light"] .details-card {
      border-color: #d1d5db;
    }

    .details-placeholder {
      margin: 0;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .details-emotion-name {
      font-size: 1.15rem;
      font-weight: 600;
      margin: 0 0 0.3rem;
    }

    .details-emotion-meta {
      margin: 0 0 0.3rem;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .details-block {
      margin: 0.25rem 0;
      font-size: 0.88rem;
      color: var(--text-main);
    }

    .details-block strong {
      display: inline-block;
      margin-bottom: 0.05rem;
    }

    .details-list {
      margin: 0.1rem 0 0.25rem 1.1rem;
      padding: 0;
      font-size: 0.86rem;
      color: var(--text-muted);
    }

    /* Formul√°rio */

    .emotion-form {
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
    }

    .form-row-inline {
      display: flex;
      flex-wrap: wrap;
      gap: 0.7rem;
    }

    .form-group {
      flex: 1 1 160px;
    }

    .form-label {
      display: block;
      font-size: 0.82rem;
      color: var(--text-muted);
      margin-bottom: 0.18rem;
    }

    .form-input,
    .form-select,
    textarea {
      width: 100%;
      border-radius: var(--radius-md);
      border: 1px solid #1f2937;
      padding: 0.5rem 0.6rem;
      background: var(--bg-card);
      color: var(--text-main);
      font-family: var(--font-main);
      font-size: 0.9rem;
    }

    body[data-theme="light"] .form-input,
    body[data-theme="light"] .form-select,
    body[data-theme="light"] textarea {
      border-color: #d1d5db;
      background: #ffffff;
    }

    textarea {
      resize: vertical;
      min-height: 70px;
      max-height: 220px;
    }

    textarea::placeholder,
    .form-input::placeholder {
      color: var(--text-soft);
    }

    .form-input:focus,
    .form-select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: var(--focus-ring);
    }

    .form-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      align-items: center;
      justify-content: flex-end;
      margin-top: 0.3rem;
    }

    .btn-primary,
    .btn-secondary,
    .btn-ghost {
      border-radius: 999px;
      padding: 0.55rem 1.2rem;
      font-size: 0.9rem;
      font-weight: 500;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.35rem;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background-color 0.12s ease, opacity 0.1s ease;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent) 0, #fb923c 50%, #facc15 100%);
      color: #111827;
      box-shadow: 0 14px 35px rgba(248, 163, 45, 0.55);
    }

    .btn-primary:disabled {
      opacity: 0.35;
      cursor: not-allowed;
      box-shadow: none;
    }

    .btn-secondary {
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-muted);
      border: 1px solid #1f2937;
    }

    body[data-theme="light"] .btn-secondary {
      background: #f3f4f6;
      border-color: #d1d5db;
      color: #111827;
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-soft);
      border: 1px dashed #374151;
    }

    body[data-theme="light"] .btn-ghost {
      border-color: #9ca3af;
    }

    .btn-primary:hover:not(:disabled),
    .btn-secondary:hover,
    .btn-ghost:hover {
      transform: translateY(-1px);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.65);
    }

    .btn-primary:active:not(:disabled),
    .btn-secondary:active,
    .btn-ghost:active {
      transform: translateY(0);
      box-shadow: 0 8px 22px rgba(0, 0, 0, 0.7);
    }

    .btn-primary:focus-visible,
    .btn-secondary:focus-visible,
    .btn-ghost:focus-visible {
      outline: none;
      box-shadow: var(--focus-ring);
    }

    .helper-text {
      font-size: 0.78rem;
      color: var(--text-soft);
      margin-top: 0.15rem;
    }

    /* Gr√°ficos e hist√≥rico */

    .charts-wrapper {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1.7fr);
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .chart-card,
    .history-card {
      background: rgba(2, 6, 23, 0.96);
      border-radius: var(--radius-lg);
      border: 1px solid #1f2937;
      padding: 0.7rem 0.8rem;
    }

    body[data-theme="light"] .chart-card,
    body[data-theme="light"] .history-card {
      background: #ffffff;
      border-color: #d1d5db;
    }

    .history-card {
      padding-bottom: 0.9rem;
    }

    .chart-title,
    .history-title {
      margin: 0 0 0.3rem;
      font-size: 0.95rem;
    }

    .chart-helper,
    .history-help {
      margin: 0 0 0.35rem;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .history-table-wrapper {
      margin-top: 0.4rem;
      max-height: 260px;
      overflow: auto;
      border-radius: var(--radius-md);
      border: 1px solid #1f2937;
      background: #020617;
    }

    body[data-theme="light"] .history-table-wrapper {
      background: #f9fafb;
      border-color: #d1d5db;
    }

    .history-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
    }

    .history-table th,
    .history-table td {
      padding: 0.32rem 0.4rem;
      border-bottom: 1px solid rgba(31, 41, 55, 0.85);
      text-align: left;
    }

    body[data-theme="light"] .history-table th,
    body[data-theme="light"] .history-table td {
      border-bottom-color: #e5e7eb;
    }

    .history-table th {
      position: sticky;
      top: 0;
      background: #020617;
      z-index: 1;
      font-weight: 600;
      color: var(--text-muted);
    }

    body[data-theme="light"] .history-table th {
      background: #f9fafb;
    }

    .history-table tr:last-child td {
      border-bottom: none;
    }

    .history-table td:nth-child(4) {
      max-width: 220px;
      overflow-wrap: break-word;
    }

    .history-empty {
      margin: 0.4rem 0;
      padding: 0 0.5rem 0.5rem;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .history-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.4rem;
      margin-top: 0.25rem;
    }

    /* Sobre */

    .panel-about {
      margin-top: 0.2rem;
    }

    .about-content {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .about-content ul {
      padding-left: 1rem;
    }

    /* Rodap√© da p√°gina */

    .app-footer {
      margin-top: auto;
      border-top: 1px solid #111827;
      padding: 0.7rem 1.5rem 1.1rem;
      font-size: 0.8rem;
      color: var(--text-soft);
      text-align: center;
    }

    body[data-theme="light"] .app-footer {
      border-top-color: #e5e7eb;
    }

    .app-footer strong {
      font-weight: 600;
    }

    /* Acessibilidade */

    [role="button"],
    svg [tabindex="0"] {
      cursor: pointer;
    }

    /* Responsividade */

    @media (max-width: 1024px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
        grid-template-rows: auto auto auto;
      }

      .panel-wheel {
        grid-row: auto;
      }

      .panel-history {
        grid-column: auto;
      }

      .header-inner {
        flex-direction: column;
        align-items: flex-start;
      }

      .nav-links {
        margin-top: 0.4rem;
      }

      .charts-wrapper {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    @media (max-width: 640px) {
      .layout {
        padding: 0 1rem;
      }

      .app-header {
        padding-inline: 1rem;
      }

      .app-footer {
        padding-inline: 1rem;
      }

      .panel {
        padding: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <header class="app-header">
    <div class="header-inner">
      <div>
        <p class="brand">Atlas Emocional</p>
        <h1 class="app-title">Roda das Emo√ß√µes de Plutchik</h1>
        <p class="app-subtitle">
          Psicoeduca√ß√£o e treino de habilidades emocionais. Clique na emo√ß√£o, registre a situa√ß√£o, gere PDF e envie ao seu psic√≥logo.
        </p>
      </div>
      <nav aria-label="Navega√ß√£o principal">
        <ul class="nav-links">
          <li><a href="#sec-mapa">Mapa</a></li>
          <li><a href="#sec-registro">Registro</a></li>
          <li><a href="#sec-graficos">Hist√≥rico</a></li>
          <li><a href="#sec-sobre">Sobre</a></li>
          <li>
            <button type="button" class="btn-theme-toggle" id="themeToggle">
              <span id="themeIcon">üåô</span>
              <span id="themeLabel">Tema escuro</span>
            </button>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="layout">
    <!-- Roda -->
    <section id="sec-mapa" class="panel panel-wheel" aria-labelledby="titulo-mapa">
      <header class="panel-header">
        <h2 id="titulo-mapa" class="section-title">Mapa emocional interativo</h2>
        <p class="section-subtitle">
          Baseado na Roda das Emo√ß√µes de Plutchik: 8 emo√ß√µes b√°sicas, 3 intensidades e 8 combina√ß√µes entre elas.
        </p>
      </header>

      <div class="wheel-wrapper" aria-live="polite">
        <!-- A roda √© desenhada dinamicamente em SVG pelo JavaScript -->
        <svg
          id="emotionWheel"
          class="emotion-wheel"
          viewBox="-180 -180 360 360"
          role="img"
          aria-label="Roda das Emo√ß√µes de Plutchik com intensidades e combina√ß√µes">
        </svg>
        <p class="wheel-help">
          Clique em qualquer p√©tala ou combina√ß√£o para explorar a emo√ß√£o e registrar sua experi√™ncia.
        </p>
      </div>
    </section>

    <!-- Detalhes e registro -->
    <section id="sec-registro" class="panel panel-details" aria-labelledby="titulo-detalhes">
      <header class="panel-header">
        <h2 id="titulo-detalhes" class="section-title">Detalhes da emo√ß√£o e registro cl√≠nico</h2>
        <p class="section-subtitle">
          Nomeie o que sente, entenda a fun√ß√£o da emo√ß√£o e registre o contexto para trabalhar em sess√£o.
        </p>
      </header>

      <article class="details-card" id="detailsCard" aria-live="polite">
        <p class="details-placeholder">
          Nenhuma emo√ß√£o foi selecionada ainda.
          Use a roda ao lado para escolher uma emo√ß√£o ou combina√ß√£o e ver orienta√ß√µes psicoeducativas.
        </p>
      </article>

      <form class="emotion-form" id="emotionForm">
        <div class="form-row-inline">
          <div class="form-group">
            <label for="patientName" class="form-label">Nome do paciente</label>
            <input id="patientName" class="form-input" type="text" placeholder="Digite o nome do paciente">
          </div>
          <div class="form-group" style="max-width:110px;">
            <label for="patientAge" class="form-label">Idade</label>
            <input id="patientAge" class="form-input" type="number" min="0" max="120" placeholder="Anos">
          </div>
          <div class="form-group" style="max-width:170px;">
            <label for="recordDate" class="form-label">Data de refer√™ncia</label>
            <input id="recordDate" class="form-input" type="date">
          </div>
        </div>

        <div class="form-row-inline">
          <div class="form-group">
            <label for="selectedEmotion" class="form-label">Emo√ß√£o selecionada</label>
            <!-- Agora preenchido automaticamente pela roda, mas edit√°vel -->
            <input id="selectedEmotion" class="form-input" type="text" placeholder="Clique em uma p√©tala na roda (pode editar o nome se desejar)">
          </div>
          <div class="form-group">
            <label for="userIntensity" class="form-label">Intensidade percebida</label>
            <select id="userIntensity" class="form-select">
              <option value="leve">Leve</option>
              <option value="moderada" selected>Moderada</option>
              <option value="intensa">Intensa</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="contextInput" class="form-label">Contexto emocional</label>
          <textarea id="contextInput" placeholder="O que aconteceu? Onde voc√™ estava? Com quem?"></textarea>
        </div>

        <div class="form-row-inline">
          <div class="form-group">
            <label for="triggersInput" class="form-label">Gatilhos percebidos</label>
            <textarea id="triggersInput" placeholder="Palavras, imagens, situa√ß√µes ou pensamentos que parecem ativar essa emo√ß√£o."></textarea>
          </div>
          <div class="form-group">
            <label for="behaviorsInput" class="form-label">O que voc√™ fez</label>
            <textarea id="behaviorsInput" placeholder="Como voc√™ reagiu? O que fez ou deixou de fazer?"></textarea>
          </div>
        </div>

        <div class="form-group">
          <label for="desiredInput" class="form-label">Como gostaria de ter reagido</label>
          <textarea id="desiredInput" placeholder="Qual seria uma resposta mais alinhada com seus valores e objetivos?"></textarea>
        </div>

        <p class="helper-text">
          Este registro √© para uso pessoal e para ser compartilhado em sess√£o. Nada √© enviado automaticamente a servidores.
        </p>

        <div class="form-actions">
          <button type="button" class="btn-ghost" id="sendWhatsappButton">
            Enviar resumo ao psic√≥logo
          </button>
          <button type="button" class="btn-secondary" id="downloadPdfButton">
            Baixar PDF do meu registro
          </button>
          <button type="submit" class="btn-primary" id="registerButton" disabled>
            Registrar emo√ß√£o
          </button>
        </div>
      </form>
    </section>

    <!-- Hist√≥rico e gr√°ficos -->
    <section id="sec-graficos" class="panel panel-history" aria-labelledby="titulo-graficos">
      <header class="panel-header">
        <h2 id="titulo-graficos" class="section-title">Hist√≥rico emocional e gr√°fico</h2>
        <p class="section-subtitle">
          Use o hist√≥rico para observar padr√µes e planejar, junto com o psic√≥logo, novas estrat√©gias de cuidado.
        </p>
      </header>

      <div class="charts-wrapper">
        <article class="chart-card" aria-label="Gr√°fico de frequ√™ncia por emo√ß√£o prim√°ria">
          <h3 class="chart-title">Frequ√™ncia das emo√ß√µes b√°sicas</h3>
          <p class="chart-helper">
            Cada barra representa quantas vezes cada emo√ß√£o prim√°ria foi registrada neste navegador
            (diades contam para as duas emo√ß√µes envolvidas, com peso 0,5 para cada uma).
          </p>
          <div style="height:220px;">
            <canvas id="emotionChart" aria-label="Gr√°fico de barras de frequ√™ncia emocional" role="img"></canvas>
          </div>
        </article>

        <article class="history-card" aria-label="Hist√≥rico de registros emocionais">
          <h3 class="history-title">Hist√≥rico de registros</h3>
          <p class="history-help">
            Os dados ficam salvos apenas neste dispositivo atrav√©s do armazenamento local. Voc√™ pode apag√°-los quando desejar.
          </p>

          <div class="history-table-wrapper">
            <table class="history-table">
              <thead>
                <tr>
                  <th>Data e hora</th>
                  <th>Emo√ß√£o</th>
                  <th>Intensidade</th>
                  <th>Contexto</th>
                </tr>
              </thead>
              <tbody id="historyBody"></tbody>
            </table>
            <p id="historyEmptyMessage" class="history-empty">
              Nenhum registro ainda. Use o formul√°rio acima para registrar sua primeira emo√ß√£o.
            </p>
          </div>

          <div class="history-actions">
            <button type="button" class="btn-secondary" id="clearHistoryButton">
              Limpar hist√≥rico
            </button>
          </div>
        </article>
      </div>
    </section>

    <!-- Sobre -->
    <section id="sec-sobre" class="panel panel-about" aria-labelledby="titulo-sobre">
      <header class="panel-header">
        <h2 id="titulo-sobre" class="section-title">Sobre esta ferramenta</h2>
      </header>
      <article class="about-content">
        <p>
          A Roda das Emo√ß√µes de Plutchik organiza oito emo√ß√µes b√°sicas em diferentes intensidades e combina√ß√µes.
          Esta ferramenta foi adaptada para uso psicoeducativo e cl√≠nico, ajudando na identifica√ß√£o, nomea√ß√£o e
          regula√ß√£o das emo√ß√µes no dia a dia.
        </p>
        <p>
          O objetivo principal √© treinar tr√™s habilidades:
        </p>
        <ul>
          <li>Perceber o que voc√™ est√° sentindo com mais precis√£o.</li>
          <li>Compreender a fun√ß√£o da emo√ß√£o em vez de apenas julg√°-la como boa ou ruim.</li>
          <li>Planejar respostas mais compat√≠veis com seus valores e metas de vida.</li>
        </ul>
        <p>
          Esta ferramenta n√£o substitui psicoterapia ou atendimento m√©dico. √â um recurso de apoio
          para ser usado em conjunto com acompanhamento profissional.
        </p>
      </article>
    </section>
  </main>

  <footer class="app-footer">
    <p>
      <strong>Richelmy Murta ‚Äì Psic√≥logo Cl√≠nico</strong> ‚Ä¢ Ferramenta psicoeducativa baseada na Roda das Emo√ß√µes de Plutchik.
      Uso cl√≠nico e educativo respons√°vel. ¬© <span id="footerYear"></span>.
    </p>
  </footer>

  <script>
    "use strict";

    /* ------------------------------------------------------------------
       Configura√ß√£o de emo√ß√µes e diades
       ------------------------------------------------------------------ */

    const PRIMARIES = [
      { key: "joy", label: "Alegria", angle: -90,    colors: "#ffd54a" },
      { key: "trust", label: "Confian√ßa", angle: -45, colors: "#b7f96a" },
      { key: "fear", label: "Medo", angle: 0,        colors: "#4caf50" },
      { key: "surprise", label: "Surpresa", angle: 45,  colors: "#4fc3f7" },
      { key: "sadness", label: "Tristeza", angle: 90,   colors: "#5c6bc0" },
      { key: "disgust", label: "Nojo", angle: 135,   colors: "#ba68c8" },
      { key: "anger", label: "Raiva", angle: 180,   colors: "#ff5252" },
      { key: "anticipation", label: "Antecipa√ß√£o", angle: 225, colors: "#ff9800" }
    ];

    const INTENSITY_CONFIG = {
      joy: [
        { code: "joy_high",   label: "√äxtase",      ring: "high" },
        { code: "joy_mid",    label: "Alegria",     ring: "mid" },
        { code: "joy_low",    label: "Serenidade",  ring: "low" }
      ],
      trust: [
        { code: "trust_high", label: "Admira√ß√£o",   ring: "high" },
        { code: "trust_mid",  label: "Confian√ßa",   ring: "mid" },
        { code: "trust_low",  label: "Aprova√ß√£o",   ring: "low" }
      ],
      fear: [
        { code: "fear_high",  label: "Terror",      ring: "high" },
        { code: "fear_mid",   label: "Medo",        ring: "mid" },
        { code: "fear_low",   label: "Apreens√£o",   ring: "low" }
      ],
      surprise: [
        { code: "surprise_high", label: "Assombro",    ring: "high" },
        { code: "surprise_mid",  label: "Surpresa",    ring: "mid" },
        { code: "surprise_low",  label: "Distra√ß√£o",   ring: "low" }
      ],
      sadness: [
        { code: "sadness_high",  label: "Ang√∫stia",    ring: "high" },
        { code: "sadness_mid",   label: "Tristeza",    ring: "mid" },
        { code: "sadness_low",   label: "T√©dio",       ring: "low" }
      ],
      disgust: [
        { code: "disgust_high",  label: "Repugn√¢ncia", ring: "high" },
        { code: "disgust_mid",   label: "Nojo",        ring: "mid" },
        { code: "disgust_low",   label: "Aborrecimento", ring: "low" }
      ],
      anger: [
        { code: "anger_high",    label: "Ira",         ring: "high" },
        { code: "anger_mid",     label: "Raiva",       ring: "mid" },
        { code: "anger_low",     label: "Irrita√ß√£o",   ring: "low" }
      ],
      anticipation: [
        { code: "anticipation_high", label: "Vigil√¢ncia",  ring: "high" },
        { code: "anticipation_mid",  label: "Antecipa√ß√£o", ring: "mid" },
        { code: "anticipation_low",  label: "Interesse",   ring: "low" }
      ]
    };

    // Diades na ordem dos pares adjacentes: (0-1), (1-2)... (7-0)
    // Mapeamento cl√≠nico (Plutchik):
    // Amor = Alegria + Confian√ßa
    // Submiss√£o = Confian√ßa + Medo
    // Intimida√ß√£o = Medo + Surpresa
    // Desaprova√ß√£o = Surpresa + Tristeza
    // Remorso = Tristeza + Nojo
    // Menosprezo (contempt) = Nojo + Raiva
    // Agressividade = Raiva + Antecipa√ß√£o
    // Otimismo = Antecipa√ß√£o + Alegria
    const DIADS = [
      { code: "diad_love",         label: "Amor",          primaryA: "joy",         primaryB: "trust" },
      { code: "diad_submission",   label: "Submiss√£o",     primaryA: "trust",       primaryB: "fear" },
      { code: "diad_intimidation", label: "Intimida√ß√£o",   primaryA: "fear",        primaryB: "surprise" },
      { code: "diad_disapproval",  label: "Desaprova√ß√£o",  primaryA: "surprise",    primaryB: "sadness" },
      { code: "diad_remorse",      label: "Remorso",       primaryA: "sadness",     primaryB: "disgust" },
      { code: "diad_contempt",     label: "Menosprezo",    primaryA: "disgust",     primaryB: "anger" }, // Aqui seguimos Plutchik: Nojo + Raiva
      { code: "diad_aggressivity", label: "Agressividade", primaryA: "anger",       primaryB: "anticipation" },
      { code: "diad_optimism",     label: "Otimismo",      primaryA: "anticipation", primaryB: "joy" }
    ];

    const PRIMARY_LABELS = {
      joy: "Alegria",
      trust: "Confian√ßa",
      fear: "Medo",
      surprise: "Surpresa",
      sadness: "Tristeza",
      disgust: "Nojo",
      anger: "Raiva",
      anticipation: "Antecipa√ß√£o"
    };

    /* ------------------------------------------------------------------
       Psicoeduca√ß√£o ‚Äì INFO_MAP
       Cada item tem defini√ß√£o, fun√ß√£o, situa√ß√µes, riscos, estrat√©gias, reflex√µes.
       ------------------------------------------------------------------ */

    const INFO_MAP = {
      /* ALEGRIA */
      joy_high: {
        displayName: "√äxtase",
        primary: "joy",
        type: "primary",
        ring: "high",
        definition: "Alegria em n√≠vel muito alto, com euforia e sensa√ß√£o de celebra√ß√£o intensa.",
        adaptive: "Marcar conquistas importantes e liberar energia para comemorar.",
        situations: [
          "Alcan√ßar um objetivo de longa data.",
          "Viver experi√™ncias √∫nicas, como formaturas, casamentos ou vit√≥rias marcantes."
        ],
        risks: [
          "Tomar decis√µes impulsivas no auge da euforia.",
          "Comparar o cotidiano com o momento de √™xtase e sentir frustra√ß√£o depois."
        ],
        strategies: [
          "Adiar decis√µes importantes para algumas horas depois da intensa euforia.",
          "Registrar o que este momento revela sobre seus valores e esfor√ßos."
        ],
        reflections: [
          "Que compromisso quero assumir comigo ap√≥s esta conquista?",
          "Como posso celebrar sem agredir meus pr√≥prios limites?"
        ]
      },
      joy_mid: {
        displayName: "Alegria",
        primary: "joy",
        type: "primary",
        ring: "mid",
        definition: "Estado de satisfa√ß√£o e bem-estar ao vivenciar algo positivo e significativo.",
        adaptive: "Refor√ßar comportamentos saud√°veis e aproximar de pessoas e atividades valiosas.",
        situations: [
          "Compartilhar boas not√≠cias com algu√©m importante.",
          "Desfrutar de momentos de lazer e conex√£o afetiva."
        ],
        risks: [
          "Ignorar emo√ß√µes dif√≠ceis para parecer sempre alegre.",
          "Usar apenas prazer imediato como crit√©rio para decis√µes."
        ],
        strategies: [
          "Dividir a alegria com algu√©m de confian√ßa, sem compara√ß√£o.",
          "Aproveitar a energia da alegria para iniciar h√°bitos saud√°veis."
        ],
        reflections: [
          "O que, al√©m do prazer, torna esta situa√ß√£o cheia de sentido?",
          "Como posso cuidar para que esta alegria n√£o vire autoexig√™ncia?"
        ]
      },
      joy_low: {
        displayName: "Serenidade",
        primary: "joy",
        type: "primary",
        ring: "low",
        definition: "Calma suave, sensa√ß√£o de tranquilidade e conforto, sem grande excita√ß√£o.",
        adaptive: "Permitir descanso, recupera√ß√£o e aprecia√ß√£o de momentos simples.",
        situations: [
          "Fim de um dia produtivo com tempo para desacelerar.",
          "Estar em local seguro, fazendo algo que traz paz."
        ],
        risks: [
          "Adiar mudan√ßas necess√°rias por estar confort√°vel demais.",
          "Minimizar necessidades emocionais para n√£o desestabilizar a calma."
        ],
        strategies: [
          "Notar sensa√ß√µes corporais de relaxamento e seguran√ßa.",
          "Usar a serenidade para refletir com clareza sobre pr√≥ximos passos."
        ],
        reflections: [
          "Do que esta calma est√° me protegendo?",
          "Que pequena a√ß√£o posso planejar a partir desta serenidade?"
        ]
      },

      /* CONFIAN√áA */
      trust_high: {
        displayName: "Admira√ß√£o",
        primary: "trust",
        type: "primary",
        ring: "high",
        definition: "Confian√ßa intensa misturada com respeito e inspira√ß√£o por algu√©m ou algo.",
        adaptive: "Oferecer modelos de crescimento e motivar desenvolvimento pessoal.",
        situations: [
          "Observar algu√©m enfrentando dificuldades com integridade.",
          "Estudar pessoas que representam valores que voc√™ deseja cultivar."
        ],
        risks: [
          "Idealizar o outro e sentir-se sempre menor.",
          "Copiar comportamentos sem considerar seus pr√≥prios limites."
        ],
        strategies: [
          "Identificar quais qualidades admir√°veis voc√™ j√° possui em algum grau.",
          "Transformar admira√ß√£o em metas concretas, pequenas e realistas."
        ],
        reflections: [
          "O que exatamente admiro e como isso conversa com meus valores?",
          "Como posso aprender com esta pessoa sem me apagar?"
        ]
      },
      trust_mid: {
        displayName: "Confian√ßa",
        primary: "trust",
        type: "primary",
        ring: "mid",
        definition: "Sensa√ß√£o de seguran√ßa em rela√ß√£o a algu√©m, a si mesmo ou a uma situa√ß√£o.",
        adaptive: "Permitir coopera√ß√£o, delega√ß√£o e constru√ß√£o de v√≠nculos est√°veis.",
        situations: [
          "Parcerias em que os combinados s√£o cumpridos.",
          "Relacionamentos nos quais segredos s√£o respeitados."
        ],
        risks: [
          "Acreditar demais em pessoas pouco confi√°veis.",
          "Fechar os olhos para sinais de desrespeito por medo de perder seguran√ßa."
        ],
        strategies: [
          "Estabelecer limites claros e revis√°-los quando necess√°rio.",
          "Observar se voc√™ tamb√©m se comporta de forma confi√°vel."
        ],
        reflections: [
          "Que limites saud√°veis podem proteger essa confian√ßa?",
          "O quanto confio em mim para sustentar minhas escolhas?"
        ]
      },
      trust_low: {
        displayName: "Aprova√ß√£o",
        primary: "trust",
        type: "primary",
        ring: "low",
        definition: "Sensa√ß√£o de ser aceito, reconhecido ou validado por outra pessoa ou grupo.",
        adaptive: "Fortalecer v√≠nculos e facilitar coopera√ß√£o em ambientes seguros.",
        situations: [
          "Receber feedback respeitoso sobre o seu trabalho.",
          "Ser inclu√≠do em decis√µes importantes."
        ],
        risks: [
          "Depender da aprova√ß√£o externa para se sentir suficiente.",
          "Evitar conversas dif√≠ceis para n√£o decepcionar o outro."
        ],
        strategies: [
          "Reconhecer internamente as pr√≥prias qualidades, al√©m do elogio.",
          "Equilibrar o desejo de agradar com seus valores pessoais."
        ],
        reflections: [
          "Em quais √°reas tenho buscado apenas aprova√ß√£o externa?",
          "Que tipo de autoaprova√ß√£o quero construir?"
        ]
      },

      /* MEDO */
      fear_high: {
        displayName: "Terror",
        primary: "fear",
        type: "primary",
        ring: "high",
        definition: "Medo extremo, com sensa√ß√£o de amea√ßa grave e perda de controle.",
        adaptive: "Ativar resposta de emerg√™ncia quando a integridade est√° em risco real.",
        situations: [
          "Acidentes, viol√™ncia ou situa√ß√µes traum√°ticas.",
          "Crises intensas de p√¢nico."
        ],
        risks: [
          "Generalizar o terror para contextos seguros.",
          "Evitar ajuda por medo de reviver lembran√ßas."
        ],
        strategies: [
          "Buscar ancoragem no presente com est√≠mulos seguros (contato visual, tato, respira√ß√£o).",
          "Procurar ajuda profissional para trabalhar experi√™ncias traum√°ticas."
        ],
        reflections: [
          "Que recursos tenho hoje que n√£o tinha em momentos passados?",
          "Quem pode caminhar comigo neste processo de reconstru√ß√£o?"
        ]
      },
      fear_mid: {
        displayName: "Medo",
        primary: "fear",
        type: "primary",
        ring: "mid",
        definition: "Resposta a amea√ßa percebida, preparando o corpo para prote√ß√£o.",
        adaptive: "Proteger sua integridade f√≠sica e emocional, evitando perigos reais.",
        situations: [
          "Contextos de instabilidade ou riscos concretos.",
          "Medo de rejei√ß√£o, perda de v√≠nculo ou fracasso relevante."
        ],
        risks: [
          "Evitar cronicamente situa√ß√µes essenciais para seus objetivos.",
          "Ignorar riscos reais por tentar n√£o sentir medo algum."
        ],
        strategies: [
          "Distinguir perigos reais de possibilidades imaginadas.",
          "Enfrentar gradualmente situa√ß√µes importantes, com plano e apoio."
        ],
        reflections: [
          "O que este medo revela sobre o que √© valioso para mim?",
          "Em qual ponto o medo me protege e em qual ponto me paralisa?"
        ]
      },
      fear_low: {
        displayName: "Apreens√£o",
        primary: "fear",
        type: "primary",
        ring: "low",
        definition: "Preocupa√ß√£o leve com algo que pode dar errado, mas ainda incerto.",
        adaptive: "Alertar sobre poss√≠veis riscos e incentivar prepara√ß√£o antecipada.",
        situations: [
          "Esperar resultados de provas, exames ou entrevistas.",
          "Iniciar atividades novas ainda desconhecidas."
        ],
        risks: [
          "Transformar apreens√£o em rumina√ß√£o sem a√ß√£o.",
          "Confundir possibilidade com certeza de desastre."
        ],
        strategies: [
          "Listar o que est√° sob seu controle e agir sobre isso.",
          "Definir um pequeno primeiro passo ao inv√©s de tentar resolver tudo."
        ],
        reflections: [
          "Que parte desta apreens√£o √© fato e qual √© hip√≥tese?",
          "Que atitude realista posso tomar hoje?"
        ]
      },

      /* SURPRESA */
      surprise_high: {
        displayName: "Assombro",
        primary: "surprise",
        type: "primary",
        ring: "high",
        definition: "Surpresa intensa diante de algo muito diferente do esperado.",
        adaptive: "For√ßar reavalia√ß√£o r√°pida de cren√ßas e expectativas.",
        situations: [
          "Impactos positivos ou negativos muito acima do previsto.",
          "Descobertas que mudam sua vis√£o de mundo."
        ],
        risks: [
          "Congelar e n√£o conseguir agir diante da novidade.",
          "Criar conclus√µes extremas com base em um √∫nico evento."
        ],
        strategies: [
          "Buscar mais informa√ß√µes antes de decidir.",
          "Conversar com algu√©m de confian√ßa para organizar o impacto."
        ],
        reflections: [
          "Que vis√£o minha est√° sendo convidada a amadurecer?",
          "O que posso aprender com esse assombro sem negar meu susto?"
        ]
      },
      surprise_mid: {
        displayName: "Surpresa",
        primary: "surprise",
        type: "primary",
        ring: "mid",
        definition: "Quebra de expectativa por algo inesperado.",
        adaptive: "Interromper o piloto autom√°tico e reavaliar a situa√ß√£o.",
        situations: [
          "Mudan√ßas de agenda de √∫ltima hora.",
          "Receber not√≠cias que n√£o estavam no radar."
        ],
        risks: [
          "Responder impulsivamente antes de entender o contexto.",
          "Tratar qualquer mudan√ßa como amea√ßa."
        ],
        strategies: [
          "Dar um tempo antes de tomar decis√µes.",
          "Perguntar, investigar e esclarecer antes de concluir."
        ],
        reflections: [
          "Esta surpresa abre alguma oportunidade de crescimento?",
          "O que ainda preciso compreender melhor aqui?"
        ]
      },
      surprise_low: {
        displayName: "Distra√ß√£o",
        primary: "surprise",
        type: "primary",
        ring: "low",
        definition: "Desvio leve de aten√ß√£o por est√≠mulos novos e constantes.",
        adaptive: "Redirecionar o foco para algo que pode ser mais relevante.",
        situations: [
          "Notifica√ß√µes frequentes em dispositivos.",
          "Interrup√ß√µes leves durante o trabalho."
        ],
        risks: [
          "Fragmentar a aten√ß√£o e perder profundidade nas tarefas.",
          "Confundir urg√™ncia com import√¢ncia real."
        ],
        strategies: [
          "Definir janelas espec√≠ficas para checar notifica√ß√µes.",
          "Praticar per√≠odos curtos de foco total em uma √∫nica tarefa."
        ],
        reflections: [
          "O que realmente merece minha aten√ß√£o agora?",
          "Que limite simples posso testar para proteger meu foco?"
        ]
      },

      /* TRISTEZA */
      sadness_high: {
        displayName: "Ang√∫stia",
        primary: "sadness",
        type: "primary",
        ring: "high",
        definition: "Tristeza profunda misturada a aperto interno e sensa√ß√£o de peso.",
        adaptive: "Sinalizar que algo muito importante foi ferido ou perdido.",
        situations: [
          "Luto por pessoas, rela√ß√µes ou projetos.",
          "Ac√∫mulo de frustra√ß√µes significativas."
        ],
        risks: [
          "Perder a esperan√ßa e deixar de buscar ajuda.",
          "Confundir ang√∫stia com identidade permanente."
        ],
        strategies: [
          "Procurar apoio profissional e rede de confian√ßa.",
          "Fatiar tarefas em passos m√≠nimos, respeitando o ritmo do momento."
        ],
        reflections: [
          "Que partes de mim pedem acolhimento, n√£o julgamento?",
          "Qual pequeno gesto de cuidado √© poss√≠vel hoje?"
        ]
      },
      sadness_mid: {
        displayName: "Tristeza",
        primary: "sadness",
        type: "primary",
        ring: "mid",
        definition: "Resposta a perdas, frustra√ß√µes ou afastamentos importantes.",
        adaptive: "Favorecer recolhimento, elabora√ß√£o e busca de apoio.",
        situations: [
          "Fim de ciclos ou rela√ß√µes significativas.",
          "Percep√ß√£o de que algo esperado n√£o aconteceu."
        ],
        risks: [
          "Isolamento prolongado e abandono de rotinas necess√°rias.",
          "Tratar tristeza como sinal de fraqueza."
        ],
        strategies: [
          "Permitir-se sentir sem autoacusa√ß√£o.",
          "Manter pequenas rotinas de sono, alimenta√ß√£o e contato social."
        ],
        reflections: [
          "O que esta tristeza protege ou tenta mostrar?",
          "De que tipo de ajuda real eu precisaria agora?"
        ]
      },
      sadness_low: {
        displayName: "T√©dio",
        primary: "sadness",
        type: "primary",
        ring: "low",
        definition: "Sensa√ß√£o de vazio leve, desinteresse ou falta de est√≠mulo.",
        adaptive: "Indicar necessidade de novos desafios ou mudan√ßas de rota.",
        situations: [
          "Rotinas muito repetitivas.",
          "Fases de transi√ß√£o em que o futuro ainda √© indefinido."
        ],
        risks: [
          "Buscar apenas distra√ß√µes autom√°ticas para fugir do t√©dio.",
          "Interpretar t√©dio como prova de incapacidade."
        ],
        strategies: [
          "Explorar pequenas novidades saud√°veis na rotina.",
          "Refletir sobre o que perdeu sentido e o que poderia ganhar vida de novo."
        ],
        reflections: [
          "Que √°rea da minha vida pede renova√ß√£o?",
          "O que eu gostava de fazer e abandonei?"
        ]
      },

      /* NOJO */
      disgust_high: {
        displayName: "Repugn√¢ncia",
        primary: "disgust",
        type: "primary",
        ring: "high",
        definition: "Nojo intenso e avers√£o forte, com desejo de afastamento imediato.",
        adaptive: "Proteger de situa√ß√µes que violam profundamente seus limites f√≠sicos ou morais.",
        situations: [
          "Viv√™ncias de abuso, humilha√ß√£o ou viol√™ncia.",
          "Contato com atitudes consideradas degradantes."
        ],
        risks: [
          "Estender repugn√¢ncia para si mesmo, gerando vergonha extrema.",
          "Fechar qualquer possibilidade de di√°logo quando seria √∫til."
        ],
        strategies: [
          "Distinguir atos espec√≠ficos de toda a identidade da pessoa.",
          "Reafirmar limites com apoio profissional quando necess√°rio."
        ],
        reflections: [
          "Que valor essencial est√° sendo tocado por esta repugn√¢ncia?",
          "Como posso me proteger sem me desumanizar?"
        ]
      },
      disgust_mid: {
        displayName: "Nojo",
        primary: "disgust",
        type: "primary",
        ring: "mid",
        definition: "Rea√ß√£o de repulsa a algo percebido como contaminante ou ofensivo.",
        adaptive: "Afastar de ambientes, atitudes ou rela√ß√µes que ferem a integridade.",
        situations: [
          "Ambientes fisicamente sujos.",
          "Comportamentos que v√£o contra seus princ√≠pios b√°sicos."
        ],
        risks: [
          "Transformar nojo em julgamento r√≠gido de grupos inteiros.",
          "Usar repulsa para justificar desrespeito."
        ],
        strategies: [
          "Diferenciar prote√ß√£o leg√≠tima de preconceito.",
          "Estabelecer dist√¢ncia saud√°vel de situa√ß√µes realmente t√≥xicas."
        ],
        reflections: [
          "O que desejo proteger em mim quando sinto nojo?",
          "H√° outra forma de defender meus valores sem desumanizar ningu√©m?"
        ]
      },
      disgust_low: {
        displayName: "Aborrecimento",
        primary: "disgust",
        type: "primary",
        ring: "low",
        definition: "Desgosto leve ou inc√¥modo persistente com algo que n√£o agrada.",
        adaptive: "Indicar que ajustes podem ser necess√°rios na rotina ou nas rela√ß√µes.",
        situations: [
          "Conversas repetitivas que j√° n√£o fazem sentido.",
          "Pequenas atitudes que v√£o contra o que voc√™ considera adequado."
        ],
        risks: [
          "Acumular aborrecimento at√© explodir.",
          "Descontar irrita√ß√£o em pessoas que n√£o t√™m rela√ß√£o direta."
        ],
        strategies: [
          "Identificar o que exatamente incomoda.",
          "Comunicar inc√¥modos cedo, de forma objetiva e respeitosa."
        ],
        reflections: [
          "Esta situa√ß√£o fere valores ou apenas prefer√™ncias?",
          "Que ajuste simples poderia reduzir este aborrecimento?"
        ]
      },

      /* RAIVA */
      anger_high: {
        displayName: "Ira",
        primary: "anger",
        type: "primary",
        ring: "high",
        definition: "Raiva intensa, com grande energia para confronto.",
        adaptive: "Proteger limites e reagir a injusti√ßas s√©rias.",
        situations: [
          "Humilha√ß√µes repetidas.",
          "Quebra grave de confian√ßa."
        ],
        risks: [
          "Atacar de forma que gere danos irrevers√≠veis.",
          "Reagir sempre com guerra, mesmo quando n√£o necess√°rio."
        ],
        strategies: [
          "Afastar-se por alguns minutos antes de agir.",
          "Escrever o que deseja dizer e revisar depois."
        ],
        reflections: [
          "Que limite meu est√° sendo violado aqui?",
          "O que eu n√£o quero mais tolerar e como posso comunicar isso?"
        ]
      },
      anger_mid: {
        displayName: "Raiva",
        primary: "anger",
        type: "primary",
        ring: "mid",
        definition: "Resposta a frustra√ß√µes ou injusti√ßas percebidas, com energia de oposi√ß√£o.",
        adaptive: "Indicar necessidade de defender direitos ou ajustar rela√ß√µes.",
        situations: [
          "Cr√≠ticas injustas.",
          "Expectativas quebradas sem di√°logo."
        ],
        risks: [
          "Transformar qualquer frustra√ß√£o em conflito.",
          "Engolir raiva por medo de conflitos e adoecer por dentro."
        ],
        strategies: [
          "Nomear a raiva e reconhecer o que ela protege.",
          "Escolher um momento adequado para conversas dif√≠ceis."
        ],
        reflections: [
          "O que esta raiva est√° tentando proteger em mim?",
          "Qual seria uma forma firme e respeitosa de agir?"
        ]
      },
      anger_low: {
        displayName: "Irrita√ß√£o",
        primary: "anger",
        type: "primary",
        ring: "low",
        definition: "Inc√¥modo diante de pequenas falhas, atrasos ou invas√µes de espa√ßo.",
        adaptive: "Sinalizar ajustes necess√°rios na rotina, nos limites e na comunica√ß√£o.",
        situations: [
          "Interrup√ß√µes constantes em tarefas importantes.",
          "Descuidos repetidos com combinados simples."
        ],
        risks: [
          "Guardar irrita√ß√£o at√© explodir por algo pequeno.",
          "Ignorar sinais de cansa√ßo e sobrecarga."
        ],
        strategies: [
          "Comunicar inc√¥modos cedo, antes de acumular.",
          "Criar pausas curtas para reduzir tens√£o f√≠sica."
        ],
        reflections: [
          "Que pedido claro eu ainda n√£o fiz?",
          "O que posso ajustar antes que a irrita√ß√£o aumente?"
        ]
      },

      /* ANTECIPA√á√ÉO */
      anticipation_high: {
        displayName: "Vigil√¢ncia",
        primary: "anticipation",
        type: "primary",
        ring: "high",
        definition: "Estado de alerta elevado, monitorando riscos ou oportunidades o tempo todo.",
        adaptive: "Proteger em contextos de alta responsabilidade e instabilidade.",
        situations: [
          "Cuidar de pessoas vulner√°veis em situa√ß√µes cr√≠ticas.",
          "Liderar equipes em momentos de crise."
        ],
        risks: [
          "Exaust√£o por se manter sempre em hiperalerta.",
          "Dificuldade de relaxar mesmo em ambientes seguros."
        ],
        strategies: [
          "Estabelecer janelas reais de descanso e desligamento.",
          "Delegar tarefas quando poss√≠vel, confiando em outras pessoas."
        ],
        reflections: [
          "Em quais momentos posso abaixar a guarda com seguran√ßa?",
          "Que custo tenho pago por me manter sempre vigilante?"
        ]
      },
      anticipation_mid: {
        displayName: "Antecipa√ß√£o",
        primary: "anticipation",
        type: "primary",
        ring: "mid",
        definition: "Expectativa ativa em rela√ß√£o ao futuro, com foco em planejamento.",
        adaptive: "Organizar recursos e preparar-se para pr√≥ximos passos.",
        situations: [
          "Planejar mudan√ßas importantes.",
          "Preparar apresenta√ß√µes, provas ou projetos relevantes."
        ],
        risks: [
          "Confundir planejamento com controle total.",
          "Viver tanto no futuro que perde o presente."
        ],
        strategies: [
          "Transformar expectativas em planos escritos e realistas.",
          "Separar o que √© control√°vel do que n√£o depende de voc√™."
        ],
        reflections: [
          "Minha antecipa√ß√£o est√° me organizando ou me consumindo?",
          "Qual pequeno passo posso dar hoje em dire√ß√£o ao que desejo?"
        ]
      },
      anticipation_low: {
        displayName: "Interesse",
        primary: "anticipation",
        type: "primary",
        ring: "low",
        definition: "Curiosidade tranquila por algo novo ou diferente.",
        adaptive: "Estimular explora√ß√£o, aprendizagem e abertura para possibilidades.",
        situations: [
          "Conhecer pessoas e temas novos.",
          "Iniciar leituras ou projetos por curiosidade."
        ],
        risks: [
          "Espalhar energia em muitos interesses sem aprofundar nenhum.",
          "Usar apenas novidades para fugir de temas dif√≠ceis."
        ],
        strategies: [
          "Escolher poucos focos de interesse por vez.",
          "Registrar o que desperta curiosidade genu√≠na, n√£o s√≥ modas."
        ],
        reflections: [
          "O que este interesse diz sobre quem estou me tornando?",
          "Que a√ß√£o pequena posso fazer hoje para honrar essa curiosidade?"
        ]
      },

      /* ----------------- DIADES ----------------- */
      diad_love: {
        displayName: "Amor",
        type: "diad",
        primaries: ["joy", "trust"],
        definition: "Combina√ß√£o de alegria e confian√ßa que gera v√≠nculo profundo e cuidado m√∫tuo.",
        adaptive: "Sustentar rela√ß√µes de apoio, compromisso e pertencimento.",
        situations: [
          "Rela√ß√µes nas quais h√° alegria em estar junto e confian√ßa constru√≠da.",
          "Cuidado consistente em fam√≠lia, amizades e parcerias."
        ],
        risks: [
          "Confundir amor com necessidade de se anular.",
          "Tolerar desrespeitos em nome de n√£o ficar s√≥."
        ],
        strategies: [
          "Equilibrar entrega com preserva√ß√£o de limites pessoais.",
          "Comunicar necessidades com honestidade em vez de adivinhar."
        ],
        reflections: [
          "Que tipo de amor quero construir: posse ou parceria?",
          "Onde posso cuidar de mim sem deixar de cuidar do outro?"
        ]
      },
      diad_submission: {
        displayName: "Submiss√£o",
        type: "diad",
        primaries: ["trust", "fear"],
        definition: "Mistura de confian√ßa com medo, levando a ceder demais para evitar conflito.",
        adaptive: "Pode proteger em contextos hier√°rquicos r√≠gidos ou de risco real.",
        situations: [
          "Rela√ß√µes onde uma parte tem muito mais poder.",
          "Ambientes em que discordar parece perigoso."
        ],
        risks: [
          "Perder a pr√≥pria voz e identidade.",
          "Aceitar abusos por medo de desagradar."
        ],
        strategies: [
          "Come√ßar por pequenos gestos de autoafirma√ß√£o.",
          "Identificar pessoas seguras para compartilhar d√∫vidas e limites."
        ],
        reflections: [
          "Em quais √°reas tenho dito sempre sim quando queria dizer n√£o?",
          "Que consequ√™ncia real temo enfrentar ao me posicionar?"
        ]
      },
      diad_intimidation: {
        displayName: "Intimida√ß√£o",
        type: "diad",
        primaries: ["fear", "surprise"],
        definition: "Combina√ß√£o de medo e surpresa diante de algu√©m ou situa√ß√£o que imp√µe poder.",
        adaptive: "Alertar sobre riscos e ajudar a avaliar limites do outro.",
        situations: [
          "Ambientes em que a autoridade √© usada de forma hostil.",
          "Situa√ß√µes em que cr√≠ticas v√™m com humilha√ß√£o."
        ],
        risks: [
          "Aceitar padr√µes de viol√™ncia como normais.",
          "Silenciar necessidades por sentir-se pequeno demais."
        ],
        strategies: [
          "Buscar apoio externo para avaliar a situa√ß√£o.",
          "Fortalecer redes de suporte para n√£o enfrentar tudo sozinho."
        ],
        reflections: [
          "Este medo √© proporcional ao risco ou √† forma como fui tratado no passado?",
          "Que passos graduais podem reduzir a sensa√ß√£o de amea√ßa?"
        ]
      },
      diad_disapproval: {
        displayName: "Desaprova√ß√£o",
        type: "diad",
        primaries: ["surprise", "sadness"],
        definition: "Mistura de surpresa e tristeza ao perceber algo como errado ou decepcionante.",
        adaptive: "Rever escolhas, limites e alinhamento com valores.",
        situations: [
          "Descobrir comportamentos que v√£o contra o que voc√™ esperava.",
          "Perceber falhas √©ticas em pessoas de refer√™ncia."
        ],
        risks: [
          "Se tornar excessivamente cr√≠tico e r√≠gido.",
          "Usar desaprova√ß√£o para excluir, n√£o para dialogar."
        ],
        strategies: [
          "Diferenciar pessoa, comportamento e contexto.",
          "Buscar conversas claras antes de romper v√≠nculos."
        ],
        reflections: [
          "O que exatamente me decepciona aqui?",
          "H√° espa√ßo para repara√ß√£o ou apenas para afastamento saud√°vel?"
        ]
      },
      diad_remorse: {
        displayName: "Remorso",
        type: "diad",
        primaries: ["sadness", "disgust"],
        definition: "Tristeza misturada a nojo de si mesmo pelo que fez ou deixou de fazer.",
        adaptive: "Reconhecer erros, aprender com eles e buscar repara√ß√£o.",
        situations: [
          "Atitudes impulsivas que ferem algu√©m importante.",
          "Negligenciar responsabilidades significativas."
        ],
        risks: [
          "Ficar preso em autopuni√ß√£o sem mudan√ßa real.",
          "Tratar-se como irrecuper√°vel."
        ],
        strategies: [
          "Assumir responsabilidade sem se reduzir apenas ao erro.",
          "Planejar a√ß√µes concretas de repara√ß√£o ou mudan√ßa."
        ],
        reflections: [
          "O que posso aprender com este erro?",
          "Que passo real de reparo posso dar, mesmo pequeno?"
        ]
      },
      diad_contempt: {
        displayName: "Menosprezo",
        type: "diad",
        primaries: ["disgust", "anger"],
        definition: "Nojo misturado com raiva, levando a olhar o outro como inferior.",
        adaptive: "Proteger-se de rela√ß√µes realmente abusivas quando usado com consci√™ncia.",
        situations: [
          "Contato repetido com atitudes desrespeitosas.",
          "Rela√ß√µes marcadas por manipula√ß√£o e explora√ß√£o."
        ],
        risks: [
          "Desumanizar pessoas, fechando qualquer ponte de di√°logo.",
          "Projetar no outro aquilo que n√£o tolera em si mesmo."
        ],
        strategies: [
          "Diferenciar afastar-se por prote√ß√£o de atacar por desprezo.",
          "Trabalhar em terapia sentimentos de superioridade defensiva."
        ],
        reflections: [
          "Estou me protegendo ou punindo?",
          "Que vulnerabilidade minha este menosprezo tenta encobrir?"
        ]
      },
      diad_aggressivity: {
        displayName: "Agressividade",
        type: "diad",
        primaries: ["anger", "anticipation"],
        definition: "Raiva combinada com antecipa√ß√£o, preparando ataques e confrontos constantes.",
        adaptive: "Pode ser √∫til para defender direitos em contextos hostis, quando bem dosada.",
        situations: [
          "Ambientes competitivos e pouco cooperativos.",
          "Hist√≥rico de precisar se defender sozinho."
        ],
        risks: [
          "Entrar em guerra onde bastaria firmeza.",
          "Romper rela√ß√µes antes de tentar negocia√ß√£o."
        ],
        strategies: [
          "Avaliar custo-benef√≠cio de cada batalha.",
          "Direcionar energia para a√ß√µes criativas e n√£o apenas combativas."
        ],
        reflections: [
          "Quais lutas valem realmente meu desgaste?",
          "Como posso defender meus limites sem me destruir?"
        ]
      },
      diad_optimism: {
        displayName: "Otimismo",
        type: "diad",
        primaries: ["anticipation", "joy"],
        definition: "Combina√ß√£o de antecipa√ß√£o e alegria, olhando o futuro com esperan√ßa realista.",
        adaptive: "Sustentar motiva√ß√£o, perseveran√ßa e vis√£o de possibilidades.",
        situations: [
          "Come√ßo de projetos importantes.",
          "Processos de recupera√ß√£o ap√≥s per√≠odos dif√≠ceis."
        ],
        risks: [
          "Desconsiderar riscos concretos em nome de esperan√ßa ing√™nua.",
          "Culpar-se quando as coisas n√£o saem como esperado."
        ],
        strategies: [
          "Equilibrar entusiasmo com an√°lise realista.",
          "Rever planos sem abandonar o senso de possibilidade."
        ],
        reflections: [
          "Onde posso ajustar meu plano sem perder a esperan√ßa?",
          "Que evid√™ncias sustentam meu otimismo hoje?"
        ]
      }
    };

    /* ------------------------------------------------------------------
       Utilidades
       ------------------------------------------------------------------ */

    function shadeColor(hex, percent) {
      // Ajuste simples de luminosidade (% negativo escurece, positivo clareia)
      let num = parseInt(hex.replace("#", ""), 16);
      let r = (num >> 16) + percent;
      let g = ((num >> 8) & 0x00FF) + percent;
      let b = (num & 0x0000FF) + percent;
      r = Math.max(Math.min(255, r), 0);
      g = Math.max(Math.min(255, g), 0);
      b = Math.max(Math.min(255, b), 0);
      return "#" + (b | (g << 8) | (r << 16)).toString(16).padStart(6, "0");
    }

    function formatDateTime(date) {
      const pad = (n) => String(n).padStart(2, "0");
      return `${pad(date.getDate())}/${pad(date.getMonth() + 1)}/${date.getFullYear()} ${pad(date.getHours())}:${pad(date.getMinutes())}`;
    }

    function truncate(text, max) {
      if (!text) return "";
      return text.length > max ? text.slice(0, max) + "‚Ä¶" : text;
    }

    /* ------------------------------------------------------------------
       Desenho da roda em SVG (flor em 3 an√©is + diades)
       ------------------------------------------------------------------ */

    function buildWheel() {
      const svg = document.getElementById("emotionWheel");
      svg.innerHTML = "";

      const centerX = 0;
      const centerY = 0;
      const stepAngle = 45; // 8 emo√ß√µes
      const innerR = 35;
      const midR = 80;
      const outerR = 125;
      const diadInnerR = 140;
      const diadOuterR = 165;

      const degToRad = (deg) => (deg * Math.PI) / 180;

      function createWedge(rInner, rOuter, startDeg, endDeg, options) {
        const startRad = degToRad(startDeg);
        const endRad = degToRad(endDeg);

        const x1 = centerX + rInner * Math.cos(startRad);
        const y1 = centerY + rInner * Math.sin(startRad);
        const x2 = centerX + rInner * Math.cos(endRad);
        const y2 = centerY + rInner * Math.sin(endRad);
        const x3 = centerX + rOuter * Math.cos(endRad);
        const y3 = centerY + rOuter * Math.sin(endRad);
        const x4 = centerX + rOuter * Math.cos(startRad);
        const y4 = centerY + rOuter * Math.sin(startRad);

        const largeArcFlag = endDeg - startDeg <= 180 ? 0 : 1;

        const d = [
          "M", x1, y1,
          "A", rInner, rInner, 0, largeArcFlag, 1, x2, y2,
          "L", x3, y3,
          "A", rOuter, rOuter, 0, largeArcFlag, 0, x4, y4,
          "Z"
        ].join(" ");

        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path.setAttribute("d", d);
        path.setAttribute("fill", options.fill || "#ccc");
        path.setAttribute("class", "wheel-segment");
        path.setAttribute("tabindex", "0");
        path.setAttribute("role", "button");
        path.dataset.code = options.code;
        path.dataset.type = options.type;
        path.dataset.primary = options.primary || "";
        path.dataset.ring = options.ring || "";
        path.setAttribute("aria-label", options.ariaLabel || "");
        svg.appendChild(path);

        // Eventos de intera√ß√£o (clique e teclado)
        path.addEventListener("click", () => handleEmotionSelection(options.code));
        path.addEventListener("keydown", (ev) => {
          if (ev.key === "Enter" || ev.key === " ") {
            ev.preventDefault();
            handleEmotionSelection(options.code);
          }
        });

        return { path, startDeg, endDeg, rInner, rOuter };
      }

      // C√≠rculo pontilhado das diades
      const dotted = document.createElementNS("http://www.w3.org/2000/svg", "circle");
      dotted.setAttribute("cx", centerX);
      dotted.setAttribute("cy", centerY);
      dotted.setAttribute("r", (diadInnerR + diadOuterR) / 2);
      dotted.setAttribute("class", "wheel-dotted-circle");
      svg.appendChild(dotted);

      const allSegments = {};

      // P√©talas de intensidade (alta, m√©dia, baixa)
      PRIMARIES.forEach((primary) => {
        const baseAngle = primary.angle;
        const width = stepAngle * 0.80;
        const start = baseAngle - width / 2;
        const end = baseAngle + width / 2;
        const baseColor = primary.colors;

        const intensities = INTENSITY_CONFIG[primary.key];

        intensities.forEach((item) => {
          let rin, rout, delta;
          if (item.ring === "high") {
            rin = innerR;
            rout = (innerR + midR) / 2;
            delta = -25;
          } else if (item.ring === "mid") {
            rin = (innerR + midR) / 2;
            rout = (midR + outerR) / 2;
            delta = 0;
          } else {
            rin = (midR + outerR) / 2;
            rout = outerR;
            delta = 20;
          }

          const fillColor = shadeColor(baseColor, delta);
          const seg = createWedge(
            rin,
            rout,
            start,
            end,
            {
              fill: fillColor,
              code: item.code,
              type: "primary",
              primary: primary.key,
              ring: item.ring,
              ariaLabel: item.label + " (" + PRIMARY_LABELS[primary.key] + ")"
            }
          );
          allSegments[item.code] = seg;

          // R√≥tulo aproximado no centro da p√©tala
          const labelAngle = baseAngle;
          const labelRadius = (rin + rout) / 2;
          const lx = centerX + labelRadius * Math.cos(degToRad(labelAngle));
          const ly = centerY + labelRadius * Math.sin(degToRad(labelAngle));

          const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
          text.setAttribute("x", lx);
          text.setAttribute("y", ly + 2);
          text.setAttribute("class", "wheel-label");
          text.textContent = item.label.toLowerCase();
          svg.appendChild(text);
        });
      });

      // Diades na borda pontilhada (p√©talas externas)
      DIADS.forEach((diad, index) => {
        const primary = PRIMARIES[index];
        const baseAngle = primary.angle + stepAngle / 2;
        const width = stepAngle * 0.55;
        const start = baseAngle - width / 2;
        const end = baseAngle + width / 2;
        const baseColor = PRIMARIES[index].colors;
        const fillColor = shadeColor(baseColor, 25);

        const seg = createWedge(
          diadInnerR,
          diadOuterR,
          start,
          end,
          {
            fill: fillColor,
            code: diad.code,
            type: "diad",
            primary: diad.primaryA,
            ring: "diad",
            ariaLabel: diad.label
          }
        );
        allSegments[diad.code] = seg;

        const labelAngle = baseAngle;
        const labelRadius = (diadInnerR + diadOuterR) / 2;
        const lx = centerX + labelRadius * Math.cos(degToRad(labelAngle));
        const ly = centerY + labelRadius * Math.sin(degToRad(labelAngle));

        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("x", lx);
        text.setAttribute("y", ly + 2);
        text.setAttribute("class", "wheel-label");
        text.textContent = diad.label.toLowerCase();
        svg.appendChild(text);
      });

      // Guarda para highlight posterior
      window._wheelSegments = allSegments;
    }

    /* ------------------------------------------------------------------
       Estado global simples
       ------------------------------------------------------------------ */

    let currentEmotionCode = null;
    let currentChart = null;
    const STORAGE_KEY = "plutchik_records_v1";

    function getRecords() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch {
        return [];
      }
    }

    function saveRecords(records) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
    }

    /* ------------------------------------------------------------------
       Renderiza√ß√£o do painel de detalhes
       ------------------------------------------------------------------ */

    function handleEmotionSelection(code) {
      const info = INFO_MAP[code];
      if (!info) return;

      currentEmotionCode = code;

      // Highlight na roda
      if (window._wheelSegments) {
        Object.values(window._wheelSegments).forEach(obj => obj.path.classList.remove("highlight"));
        const seg = window._wheelSegments[code];
        if (seg) seg.path.classList.add("highlight");
      }

      const card = document.getElementById("detailsCard");
      const primaryLabel = info.primary ? PRIMARY_LABELS[info.primary] : null;

      let levelText = "";
      if (info.type === "primary") {
        if (info.ring === "high") levelText = "Alta intensidade";
        else if (info.ring === "mid") levelText = "Intensidade m√©dia";
        else levelText = "Baixa intensidade";
      } else {
        levelText = "Combina√ß√£o de duas emo√ß√µes adjacentes (diade)";
      }

      let typeText = "";
      if (info.type === "primary" && primaryLabel) {
        typeText = "Emo√ß√£o b√°sica: " + primaryLabel;
      } else if (info.type === "diad" && info.primaries) {
        typeText = "Combina√ß√£o entre " + PRIMARY_LABELS[info.primaries[0]] + " e " + PRIMARY_LABELS[info.primaries[1]];
      }

      const createList = (items) => {
        if (!items || !items.length) return "";
        return "<ul class=\"details-list\">" + items.map(it => "<li>" + it + "</li>").join("") + "</ul>";
      };

      card.innerHTML = `
        <h3 class="details-emotion-name"><strong>${info.displayName}</strong></h3>
        <p class="details-emotion-meta">${levelText}${typeText ? " ‚Ä¢ " + typeText : ""}</p>
        <p class="details-block"><strong>Defini√ß√£o:</strong> ${info.definition}</p>
        <p class="details-block"><strong>Fun√ß√£o adaptativa:</strong> ${info.adaptive}</p>
        <p class="details-block"><strong>Situa√ß√µes em que costuma aparecer:</strong></p>
        ${createList(info.situations)}
        <p class="details-block"><strong>Quando a emo√ß√£o n√£o √© bem manejada:</strong></p>
        ${createList(info.risks)}
        <p class="details-block"><strong>Estrat√©gias de regula√ß√£o emocional:</strong></p>
        ${createList(info.strategies)}
        <p class="details-block"><strong>Perguntas para reflex√£o:</strong></p>
        ${createList(info.reflections)}
      `;

      // Atualizar campo de emo√ß√£o selecionada (ainda edit√°vel)
      const emotionInput = document.getElementById("selectedEmotion");
      let label = info.displayName;
      if (info.type === "primary" && primaryLabel) {
        label += " ‚Äì " + primaryLabel;
      }
      if (info.type === "diad" && info.primaries) {
        label += " (" + PRIMARY_LABELS[info.primaries[0]] + " + " + PRIMARY_LABELS[info.primaries[1]] + ")";
      }
      emotionInput.value = label;

      document.getElementById("registerButton").disabled = false;
    }

    /* ------------------------------------------------------------------
       Hist√≥rico e gr√°fico
       ------------------------------------------------------------------ */

    function renderHistory() {
      const tbody = document.getElementById("historyBody");
      const emptyMsg = document.getElementById("historyEmptyMessage");
      const records = getRecords();

      tbody.innerHTML = "";

      if (!records.length) {
        emptyMsg.style.display = "block";
      } else {
        emptyMsg.style.display = "none";
      }

      records
        .slice()
        .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
        .forEach((rec) => {
          const tr = document.createElement("tr");
          const dateCell = document.createElement("td");
          const emotionCell = document.createElement("td");
          const intensityCell = document.createElement("td");
          const contextCell = document.createElement("td");

          dateCell.textContent = formatDateTime(new Date(rec.createdAt));
          emotionCell.textContent = rec.emotionLabel;
          intensityCell.textContent = rec.userIntensity;
          contextCell.textContent = truncate(rec.context || "", 120);

          tr.appendChild(dateCell);
          tr.appendChild(emotionCell);
          tr.appendChild(intensityCell);
          tr.appendChild(contextCell);
          tbody.appendChild(tr);
        });
    }

    function buildChart() {
      const ctx = document.getElementById("emotionChart").getContext("2d");
      const labels = [
        "Alegria",
        "Confian√ßa",
        "Medo",
        "Surpresa",
        "Tristeza",
        "Nojo",
        "Raiva",
        "Antecipa√ß√£o"
      ];
      currentChart = new Chart(ctx, {
        type: "bar",
        data: {
          labels,
          datasets: [{
            label: "Registros",
            data: new Array(labels.length).fill(0)
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              ticks: { color: "var(--text-main)" },
              grid: { display: false }
            },
            y: {
              ticks: { color: "var(--text-main)" },
              grid: { color: "rgba(148, 163, 184, 0.3)" },
              beginAtZero: true,
              precision: 0
            }
          },
          plugins: {
            legend: {
              labels: {
                color: "var(--text-main)"
              }
            }
          }
        }
      });

      updateChart();
    }

    function updateChart() {
      if (!currentChart) return;
      const records = getRecords();
      const counts = {
        joy: 0,
        trust: 0,
        fear: 0,
        surprise: 0,
        sadness: 0,
        disgust: 0,
        anger: 0,
        anticipation: 0
      };

      records.forEach((rec) => {
        if (rec.type === "primary" && rec.primaryKey) {
          // Emo√ß√£o prim√°ria conta 1 ponto
          counts[rec.primaryKey] = (counts[rec.primaryKey] || 0) + 1;
        } else if (rec.type === "diad" && rec.primaries) {
          // DIADES: cada combina√ß√£o (ex.: Amor, Otimismo, Agressividade etc.)
          // conta 0,5 ponto para cada emo√ß√£o b√°sica componente.
          // Ex.: Amor = Alegria + Confian√ßa (0,5 para cada).
          rec.primaries.forEach((p) => {
            counts[p] = (counts[p] || 0) + 0.5;
          });
        }
      });

      currentChart.data.datasets[0].data = [
        counts.joy,
        counts.trust,
        counts.fear,
        counts.surprise,
        counts.sadness,
        counts.disgust,
        counts.anger,
        counts.anticipation
      ];
      currentChart.update();
    }

    /* ------------------------------------------------------------------
       Registro de emo√ß√£o
       ------------------------------------------------------------------ */

    function handleFormSubmit(event) {
      event.preventDefault();
      if (!currentEmotionCode || !INFO_MAP[currentEmotionCode]) {
        alert("Selecione uma emo√ß√£o na roda antes de registrar.");
        return;
      }

      const info = INFO_MAP[currentEmotionCode];
      const name = document.getElementById("patientName").value.trim();
      const age = document.getElementById("patientAge").value.trim();
      const recordDate = document.getElementById("recordDate").value;
      const userIntensity = document.getElementById("userIntensity").value;
      const context = document.getElementById("contextInput").value.trim();
      const triggers = document.getElementById("triggersInput").value.trim();
      const behaviors = document.getElementById("behaviorsInput").value.trim();
      const desired = document.getElementById("desiredInput").value.trim();

      const now = new Date();
      const emotionLabelInput = document.getElementById("selectedEmotion").value.trim();
      const emotionLabel = emotionLabelInput || info.displayName;

      const record = {
        id: now.getTime(),
        createdAt: now.toISOString(),                  // Data/hora de registro
        patientName: name,                             // Nome do paciente
        patientAge: age,                               // Idade
        patientDate: recordDate || null,              // Data de refer√™ncia
        emotionCode: currentEmotionCode,
        emotionLabel,                                  // Emo√ß√£o selecionada (texto)
        type: info.type,                               // "primary" ou "diad"
        ring: info.ring || "diad",                     // N√≠vel base da roda: high/mid/low/diad
        primaryKey: info.primary || null,
        primaries: info.primaries || null,            // Para diades
        userIntensity,                                // Intensidade subjetiva (leve/moderada/intensa)
        context,                                      // Contexto
        triggers,                                     // Gatilhos
        behaviors,                                    // Comportamentos
        desired                                       // Resposta desejada
      };

      const records = getRecords();
      records.push(record);
      saveRecords(records);

      renderHistory();
      updateChart();

      alert("Registro salvo localmente com sucesso.");
    }

    /* ------------------------------------------------------------------
       PDF cl√≠nico com jsPDF + autoTable
       ------------------------------------------------------------------ */

    async function handleDownloadPdf() {
      if (!currentEmotionCode || !INFO_MAP[currentEmotionCode]) {
        alert("Selecione uma emo√ß√£o na roda antes de gerar o PDF.");
        return;
      }

      const info = INFO_MAP[currentEmotionCode];
      const emotionLabelInput = document.getElementById("selectedEmotion").value.trim();
      const emotionLabel = emotionLabelInput || info.displayName;
      const userIntensity = document.getElementById("userIntensity").value;
      const name = document.getElementById("patientName").value.trim();
      const age = document.getElementById("patientAge").value.trim();
      const recordDate = document.getElementById("recordDate").value;
      const context = document.getElementById("contextInput").value.trim();
      const triggers = document.getElementById("triggersInput").value.trim();
      const behaviors = document.getElementById("behaviorsInput").value.trim();
      const desired = document.getElementById("desiredInput").value.trim();

      const now = new Date();
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF("p", "mm", "a4");

      const margin = 15;
      let y = 18;

      // T√≠tulo
      doc.setFont("helvetica", "bold");
      doc.setFontSize(16);
      doc.text("Registro Emocional ‚Äì Roda de Plutchik", margin, y);
      y += 10;

      // Bloco de dados principais
      doc.setFontSize(12);
      doc.text("Dados principais", margin, y);
      y += 6;

      doc.setFontSize(10);
      doc.setFont("helvetica", "normal");

      const dateRefLabel = recordDate
        ? recordDate.split("-").reverse().join("/")
        : formatDateTime(now).split(" ")[0];

      const typeLabel = info.type === "primary"
        ? "Emo√ß√£o prim√°ria"
        : "Combina√ß√£o (diade)";

      let levelLabel;
      if (info.type === "primary") {
        if (info.ring === "high") levelLabel = "Alta intensidade";
        else if (info.ring === "mid") levelLabel = "Intensidade m√©dia";
        else levelLabel = "Baixa intensidade";
      } else {
        levelLabel = "Combina√ß√£o de duas emo√ß√µes adjacentes";
      }

      const dadosPrincipais = [
        "Nome do paciente: " + (name || "________________________"),
        "Idade: " + (age || "____"),
        "Data/hora de gera√ß√£o: " + formatDateTime(now),
        "Data de refer√™ncia do registro: " + dateRefLabel,
        "Emo√ß√£o selecionada: " + emotionLabel,
        "Tipo: " + typeLabel,
        "Intensidade na roda: " + levelLabel + " | Intensidade percebida: " + userIntensity
      ];

      dadosPrincipais.forEach((line) => {
        doc.text(line, margin, y);
        y += 5;
      });

      y += 2;

      // Bloco psicoeducativo
      doc.setFont("helvetica", "bold");
      doc.setFontSize(12);
      doc.text("Bloco psicoeducativo", margin, y);
      y += 6;

      doc.setFontSize(10);
      doc.setFont("helvetica", "normal");

      // Defini√ß√£o
      doc.text("Defini√ß√£o:", margin, y);
      y += 5;
      const defWrapped = doc.splitTextToSize(info.definition, 180);
      doc.text(defWrapped, margin + 4, y);
      y += defWrapped.length * 4 + 3;

      // Fun√ß√£o adaptativa
      doc.text("Fun√ß√£o adaptativa:", margin, y);
      y += 5;
      const adapWrapped = doc.splitTextToSize(info.adaptive, 180);
      doc.text(adapWrapped, margin + 4, y);
      y += adapWrapped.length * 4 + 4;

      // Principais riscos de manejo desadaptativo
      doc.setFont("helvetica", "bold");
      doc.text("Principais riscos de manejo desadaptativo:", margin, y);
      y += 5;
      doc.setFont("helvetica", "normal");
      const riscosText = (info.risks || []).map(r => "‚Ä¢ " + r).join(" ");
      const riscosWrapped = doc.splitTextToSize(riscosText || "‚Äì", 180);
      doc.text(riscosWrapped, margin + 4, y);
      y += riscosWrapped.length * 4 + 4;

      // Tabela: contexto, gatilhos, comportamentos, resposta desejada
      const tableBody = [
        ["Contexto emocional", context || "-"],
        ["Gatilhos percebidos", triggers || "-"],
        ["O que fez (respostas comportamentais)", behaviors || "-"],
        ["Como gostaria de ter reagido", desired || "-"]
      ];

      doc.autoTable({
        startY: y,
        head: [["Campo", "Conte√∫do"]],
        body: tableBody,
        styles: { font: "helvetica", fontSize: 10, cellPadding: 3, valign: "top" },
        headStyles: { fillColor: [15, 23, 42], textColor: 255 },
        columnStyles: {
          0: { cellWidth: 60 },
          1: { cellWidth: 120 }
        },
        margin: { left: margin, right: margin }
      });

      let finalY = doc.lastAutoTable.finalY || y + 10;
      finalY += 8;

      // Bloco final: orienta√ß√µes gerais + espa√ßo para anota√ß√µes
      doc.setFont("helvetica", "bold");
      doc.setFontSize(12);
      doc.text("Orienta√ß√µes gerais e espa√ßo para anota√ß√µes", margin, finalY);
      finalY += 6;

      doc.setFont("helvetica", "normal");
      doc.setFontSize(10);
      const closingText = doc.splitTextToSize(
        "Este registro √© um ponto de partida para a conversa em psicoterapia. " +
        "Use este material para identificar padr√µes, aprofundar reflex√µes e planejar respostas mais alinhadas aos seus valores. " +
        "Abaixo, h√° espa√ßo para anota√ß√µes futuras do paciente e do psic√≥logo:",
        180
      );
      doc.text(closingText, margin, finalY);
      finalY += closingText.length * 4 + 4;

      // Linhas para anota√ß√µes
      for (let i = 0; i < 5; i++) {
        doc.line(margin, finalY, 210 - margin, finalY);
        finalY += 6;
      }

      // Rodap√© cl√≠nico no PDF
      doc.setFontSize(9);
      doc.setFont("helvetica", "italic");
      const footerText = "Richelmy Murta ‚Äì Psic√≥logo Cl√≠nico. Ferramenta psicoeducativa baseada na Roda das Emo√ß√µes de Plutchik.";
      doc.text(footerText, margin, 297 - 10);

      doc.save("registro-emocional-plutchik.pdf");
    }

    /* ------------------------------------------------------------------
       Envio para WhatsApp
       ------------------------------------------------------------------ */

    function handleSendWhatsapp() {
      if (!currentEmotionCode || !INFO_MAP[currentEmotionCode]) {
        alert("Selecione uma emo√ß√£o na roda antes de enviar o resumo.");
        return;
      }

      const info = INFO_MAP[currentEmotionCode];
      const emotionLabelInput = document.getElementById("selectedEmotion").value.trim();
      const emotionLabel = emotionLabelInput || info.displayName;
      const userIntensity = document.getElementById("userIntensity").value;
      const name = document.getElementById("patientName").value.trim();
      const age = document.getElementById("patientAge").value.trim();
      const recordDate = document.getElementById("recordDate").value;
      const context = document.getElementById("contextInput").value.trim();
      const now = new Date();

      const dateLabel = recordDate
        ? recordDate.split("-").reverse().join("/")
        : formatDateTime(now).split(" ")[0];

      const shortContext = truncate(context || "", 200);

      // PARA CUSTOMIZAR O TEXTO DA MENSAGEM:
      // Ajuste a string textPlain abaixo conforme a necessidade cl√≠nica/comunicacional.
      const textPlain =
        "Registro emocional ‚Äì Roda de Plutchik\n" +
        "Paciente: " + (name || "-") + (age ? " (" + age + " anos)" : "") + "\n" +
        "Data de refer√™ncia: " + dateLabel + "\n" +
        "Emo√ß√£o: " + emotionLabel + "\n" +
        "Intensidade percebida: " + userIntensity + "\n" +
        "Resumo do contexto: " + (shortContext || "-") + "\n\n" +
        "Mensagem enviada automaticamente pela ferramenta cl√≠nica de registro emocional.";

      const url = "https://wa.me/5535984640729?text=" + encodeURIComponent(textPlain);
      window.open(url, "_blank");
    }

    /* ------------------------------------------------------------------
       Tema claro/escuro
       ------------------------------------------------------------------ */

    function applyTheme(theme) {
      const body = document.body;
      const icon = document.getElementById("themeIcon");
      const label = document.getElementById("themeLabel");

      if (theme === "light") {
        body.dataset.theme = "light";
        icon.textContent = "‚òÄÔ∏è";
        label.textContent = "Tema claro";
      } else {
        body.dataset.theme = "dark";
        icon.textContent = "üåô";
        label.textContent = "Tema escuro";
      }
      localStorage.setItem("plutchik_theme", theme);
    }

    function initTheme() {
      const saved = localStorage.getItem("plutchik_theme");
      if (saved === "light" || saved === "dark") {
        applyTheme(saved);
      } else {
        applyTheme("dark");
      }
      const btn = document.getElementById("themeToggle");
      btn.addEventListener("click", () => {
        const next = document.body.dataset.theme === "light" ? "dark" : "dark" ? "light" : "dark";
      });
      // Corrigindo toggle (a linha acima era s√≥ para mostrar o caos; aqui vem o real):
      btn.addEventListener("click", () => {
        const next = document.body.dataset.theme === "light" ? "dark" : "light";
        applyTheme(next);
      });
    }

    /* ------------------------------------------------------------------
       Inicializa√ß√£o
       ------------------------------------------------------------------ */

    document.addEventListener("DOMContentLoaded", () => {
      // Ano no rodap√©
      document.getElementById("footerYear").textContent = new Date().getFullYear();

      // Data padr√£o do registro (hoje)
      const today = new Date();
      const isoToday = today.toISOString().slice(0, 10);
      document.getElementById("recordDate").value = isoToday;

      initTheme();
      buildWheel();
      renderHistory();
      buildChart();

      document.getElementById("emotionForm").addEventListener("submit", handleFormSubmit);
      document.getElementById("downloadPdfButton").addEventListener("click", handleDownloadPdf);
      document.getElementById("sendWhatsappButton").addEventListener("click", handleSendWhatsapp);
      document.getElementById("clearHistoryButton").addEventListener("click", () => {
        if (confirm("Deseja realmente apagar todo o hist√≥rico deste navegador?")) {
          saveRecords([]);
          renderHistory();
          updateChart();
        }
      });
    });
  </script>
</body>
</html>

