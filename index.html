<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <!-- Metadados básicos -->
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Roda das Emoções de Plutchik – Psicoeducação Emocional</title>

  <meta name="description" content="Plataforma clínica baseada na Roda das Emoções de Plutchik para psicoeducação emocional e registro clínico de emoções, com gráfico, PDF e envio ao psicólogo.">
  <meta name="keywords" content="roda das emoções, Plutchik, emoções, psicoeducação emocional, regulação emocional, registro clínico de emoções, psicologia, terapia, TCC, DBT">
  <meta name="author" content="Richelmy Murta, Psicólogo Clínico">

  <!-- Ajuste a URL abaixo para o endereço real do seu GitHub Pages -->
  <link rel="canonical" href="https://ricmurtapsicologia.github.io/rodaemo-oes/">

  <!-- Favicon e imagem principal (circular / clínica) -->
  <link rel="icon" type="image/jpeg" href="https://i.pinimg.com/736x/87/94/80/879480aee2bbe6a01efd0cd848c456ff.jpg">

  <!-- Open Graph / WhatsApp -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Roda das Emoções de Plutchik – Psicoeducação Emocional">
  <meta property="og:description" content="Clique na emoção, leia a explicação, registre o contexto e gere um resumo clínico. Psicoeducação emocional baseada na Roda das Emoções de Plutchik.">
  <meta property="og:url" content="https://ricmurtapsicologia.github.io/rodaemo-oes/">
  <meta property="og:image" content="https://i.pinimg.com/736x/87/94/80/879480aee2bbe6a01efd0cd848c456ff.jpg">
  <meta property="og:locale" content="pt_BR">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Roda das Emoções de Plutchik – Psicoeducação Emocional">
  <meta name="twitter:description" content="Ferramenta interativa de psicoeducação emocional e registro clínico de emoções, com gráfico, PDF e envio ao psicólogo.">
  <meta name="twitter:image" content="https://i.pinimg.com/736x/87/94/80/879480aee2bbe6a01efd0cd848c456ff.jpg">

  <!-- JSON-LD para SEO (WebApplication) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Roda das Emoções de Plutchik",
    "description": "Ferramenta interativa de psicoeducação emocional e treino de habilidades baseada na teoria psicoevolutiva de Plutchik.",
    "applicationCategory": "HealthApplication",
    "operatingSystem": "Any",
    "author": {
      "@type": "Person",
      "name": "Richelmy Murta"
    }
  }
  </script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>
  <!-- jsPDF e autoTable para PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js" defer></script>

  <style>
    :root {
      color-scheme: dark;
      --bg: #020617;
      --bg-gradient: radial-gradient(circle at top, #111827 0, #020617 50%, #000 100%);
      --bg-card: #020617;
      --border-subtle: #1f2937;
      --accent: #f97316;
      --accent-soft: rgba(249, 115, 22, 0.3);
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --text-soft: #6b7280;
      --radius-xl: 1.3rem;
      --radius-lg: 1rem;
      --radius-md: 0.75rem;
      --shadow-soft: 0 18px 48px rgba(0, 0, 0, 0.6);
      --focus-ring: 0 0 0 2px rgba(248, 250, 252, 0.28),
                     0 0 0 4px rgba(249, 115, 22, 0.7);
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      --stroke-wheel: #020617;
    }

    /* Tema claro – sobrescreve variáveis (estado inicial) */
    body[data-theme="light"] {
      color-scheme: light;
      --bg: #f3f4f6;
      --bg-gradient: radial-gradient(circle at top, #e5e7eb 0, #f9fafb 45%, #e5e7eb 100%);
      --bg-card: #ffffff;
      --border-subtle: #d1d5db;
      --text-main: #111827;
      --text-muted: #374151;
      --text-soft: #4b5563;
      --shadow-soft: 0 16px 40px rgba(15, 23, 42, 0.18);
      --accent-soft: rgba(249, 115, 22, 0.15);
      --stroke-wheel: #111827;
    }

    * ,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    body {
      font-family: var(--font-main);
      background: var(--bg-gradient);
      color: var(--text-main);
      line-height: 1.5;
      display: flex;
      flex-direction: column;
    }

    /* ------------------------------------------------------------------
       Cabeçalho – mobile first
       ------------------------------------------------------------------ */

    .app-header {
      border-bottom: 1px solid #111827;
      padding: 0.7rem 1rem 0.6rem;
      background: rgba(2, 6, 23, 0.96);
      color: #e5e7eb;
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    body[data-theme="light"] .app-header {
      background: rgba(249, 250, 251, 0.96);
      border-bottom-color: #e5e7eb;
      color: #111827;
    }

    .header-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      align-items: flex-start;
      justify-content: flex-start;
    }

    .brand {
      margin: 0;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-soft);
    }

    .app-title {
      margin: 0;
      font-size: 1.35rem;
      font-weight: 700;
    }

    .app-subtitle {
      margin: 0.25rem 0 0;
      font-size: 0.86rem;
      color: var(--text-muted);
      max-width: 540px;
      text-align: left;
    }

    nav[aria-label="Navegação principal"] {
      width: 100%;
    }

    .nav-links {
      list-style: none;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin: 0.4rem 0 0;
      padding: 0;
      font-size: 0.8rem;
      align-items: center;
      justify-content: flex-start;
    }

    .nav-links a,
    .nav-links button.nav-help-button {
      color: var(--text-soft);
      text-decoration: none;
      padding: 0.3rem 0.6rem;
      border-radius: 999px;
      transition: background-color 0.12s ease, color 0.12s ease;
    }

    .nav-links a {
      display: inline-flex;
      align-items: center;
    }

    .nav-links button.nav-help-button {
      border: none;
      background: transparent;
      cursor: pointer;
      font: inherit;
      display: inline-flex;
      align-items: center;
    }

    .nav-links a:hover,
    .nav-links a:focus-visible,
    .nav-links button.nav-help-button:hover,
    .nav-links button.nav-help-button:focus-visible {
      background: rgba(15, 23, 42, 0.9);
      color: #f9fafb;
      outline: none;
    }

    body[data-theme="light"] .nav-links a:hover,
    body[data-theme="light"] .nav-links a:focus-visible,
    body[data-theme="light"] .nav-links button.nav-help-button:hover,
    body[data-theme="light"] .nav-links button.nav-help-button:focus-visible {
      background: rgba(209, 213, 219, 0.9);
      color: #111827;
    }

    .btn-theme-toggle {
      border-radius: 999px;
      border: 1px solid #4b5563;
      padding: 0.3rem 0.6rem;
      background: rgba(15, 23, 42, 0.9);
      color: #f9fafb;
      cursor: pointer;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      transition: background 0.12s ease, transform 0.08s ease;
    }

    body[data-theme="light"] .btn-theme-toggle {
      background: #e5e7eb;
      color: #111827;
      border-color: #9ca3af;
    }

    .btn-theme-toggle:hover {
      transform: translateY(-1px);
      background: #111827;
    }

    body[data-theme="light"] .btn-theme-toggle:hover {
      background: #d1d5db;
    }

    .btn-theme-toggle:focus-visible {
      outline: none;
      box-shadow: var(--focus-ring);
    }

    /* ------------------------------------------------------------------
       Layout principal – MOBILE FIRST
       ------------------------------------------------------------------ */

    .layout {
      max-width: 1200px;
      margin: 1rem auto 1.5rem;
      padding: 0 1rem;
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      grid-auto-rows: auto;
      gap: 1rem;
    }

    .panel {
      background: radial-gradient(circle at top right, #111827 0, var(--bg-card) 45%, var(--bg-card) 100%);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      padding: 0.9rem 0.9rem 1rem;
      min-height: 0;
    }

    body[data-theme="light"] .panel {
      background: radial-gradient(circle at top right, #e5e7eb 0, #ffffff 55%, #ffffff 100%);
    }

    .panel-wheel {
      order: 0;
    }

    .panel-details {
      order: 1;
    }

    .panel-history {
      order: 2;
    }

    .panel-header {
      margin-bottom: 0.7rem;
      text-align: left;
    }

    .section-title {
      margin: 0 0 0.15rem;
      font-size: 1.05rem;
      font-weight: 600;
    }

    .section-subtitle {
      margin: 0;
      font-size: 0.82rem;
      color: var(--text-soft);
    }

    /* ------------------------------------------------------------------
       Roda de emoções – centralizada e legível
       ------------------------------------------------------------------ */

    .wheel-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 0.4rem 0 0.7rem;
      max-width: 340px;
      margin: 0 auto;
      text-align: center;
    }

    .emotion-wheel {
      width: 100%;
      max-width: 340px;
      height: auto;
      display: block;
      margin-bottom: 0.45rem;
    }

    .wheel-help {
      margin: 0;
      font-size: 0.8rem;
      color: var(--text-soft);
      text-align: center;
    }

    .wheel-segment {
      stroke: var(--stroke-wheel);
      stroke-width: 0.8;
      cursor: pointer;
      transition: transform 0.12s ease, stroke-width 0.12s ease, filter 0.12s ease;
    }

    .wheel-segment:focus-visible {
      outline: none;
      stroke-width: 2;
      filter: drop-shadow(0 0 4px var(--accent-soft));
    }

    .wheel-segment.highlight {
      stroke-width: 2;
      filter: drop-shadow(0 0 6px var(--accent-soft));
      transform: scale(1.03);
    }

    .wheel-label {
      font-size: 11px;
      font-weight: 600;
      fill: var(--stroke-wheel);
      text-anchor: middle;
      pointer-events: none;
      user-select: none;
    }

    .wheel-dotted-circle {
      fill: none;
      stroke: var(--stroke-wheel);
      stroke-width: 0.8;
      stroke-dasharray: 2 3;
    }

    /* ------------------------------------------------------------------
       Detalhes psicoeducativos
       ------------------------------------------------------------------ */

    .details-card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      border: 1px solid #1f2937;
      padding: 0.8rem;
      margin-bottom: 0.7rem;
      min-height: 190px;
    }

    body[data-theme="light"] .details-card {
      border-color: #d1d5db;
    }

    .details-placeholder {
      margin: 0;
      font-size: 0.9rem;
      color: var(--text-muted);
      text-align: justify;
    }

    .details-emotion-name {
      font-size: 1.15rem;
      font-weight: 600;
      margin: 0 0 0.3rem;
    }

    .details-emotion-meta {
      margin: 0 0 0.4rem;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .details-block {
      margin: 0.25rem 0;
      font-size: 0.9rem;
      color: var(--text-main);
      text-align: justify;
    }

    .details-block strong {
      display: inline-block;
      margin-bottom: 0.05rem;
    }

    .details-list {
      margin: 0.1rem 0 0.25rem 1.1rem;
      padding: 0;
      font-size: 0.84rem;
      color: var(--text-muted);
      text-align: justify;
    }

    /* ------------------------------------------------------------------
       Formulário – registro clínico
       ------------------------------------------------------------------ */

    .emotion-form {
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
    }

    .form-row-inline {
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }

    .form-group {
      flex: 1 1 160px;
    }

    .form-label {
      display: block;
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 0.18rem;
    }

    .form-input,
    .form-select,
    textarea {
      width: 100%;
      border-radius: var(--radius-md);
      border: 1px solid #1f2937;
      padding: 0.5rem 0.6rem;
      background: var(--bg-card);
      color: var(--text-main);
      font-family: var(--font-main);
      font-size: 0.9rem;
    }

    body[data-theme="light"] .form-input,
    body[data-theme="light"] .form-select,
    body[data-theme="light"] textarea {
      border-color: #d1d5db;
      background: #ffffff;
    }

    textarea {
      resize: vertical;
      min-height: 70px;
      max-height: 220px;
    }

    textarea::placeholder,
    .form-input::placeholder {
      color: var(--text-soft);
    }

    .form-input:focus,
    .form-select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: var(--focus-ring);
    }

    .helper-text {
      font-size: 0.75rem;
      color: var(--text-soft);
      margin-top: 0.1rem;
    }

    .helper-warning {
      margin-top: 0.4rem;
      font-size: 0.76rem;
      line-height: 1.4;
    }

    .helper-warning strong {
      font-weight: 600;
    }

    .form-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
      justify-content: flex-end;
      margin-top: 0.2rem;
    }

    .btn-primary,
    .btn-secondary,
    .btn-ghost {
      border-radius: 999px;
      padding: 0.5rem 1.1rem;
      font-size: 0.88rem;
      font-weight: 500;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.35rem;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background-color 0.12s ease, opacity 0.1s ease;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent) 0, #fb923c 50%, #facc15 100%);
      color: #111827;
      box-shadow: 0 14px 35px rgba(248, 163, 45, 0.55);
    }

    .btn-primary:disabled {
      opacity: 0.35;
      cursor: not-allowed;
      box-shadow: none;
    }

    .btn-secondary {
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-muted);
      border: 1px solid #1f2937;
    }

    body[data-theme="light"] .btn-secondary {
      background: #f3f4f6;
      border-color: #d1d5db;
      color: #111827;
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-soft);
      border: 1px dashed #374151;
    }

    body[data-theme="light"] .btn-ghost {
      border-color: #9ca3af;
    }

    .btn-primary:hover:not(:disabled),
    .btn-secondary:hover,
    .btn-ghost:hover {
      transform: translateY(-1px);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.65);
    }

    .btn-primary:active:not(:disabled),
    .btn-secondary:active,
    .btn-ghost:active {
      transform: translateY(0);
      box-shadow: 0 8px 22px rgba(0, 0, 0, 0.7);
    }

    .btn-primary:focus-visible,
    .btn-secondary:focus-visible,
    .btn-ghost:focus-visible {
      outline: none;
      box-shadow: var(--focus-ring);
    }

    /* Feedback visual de registro */

    .feedback-banner {
      margin-top: 0.5rem;
      border-radius: var(--radius-md);
      padding: 0.4rem 0.6rem;
      font-size: 0.8rem;
      display: none;
    }

    .feedback-banner.is-visible {
      display: block;
    }

    .feedback-banner--success {
      background: rgba(22, 163, 74, 0.12);
      border: 1px solid rgba(22, 163, 74, 0.8);
      color: #bbf7d0;
    }

    .feedback-banner--error {
      background: rgba(220, 38, 38, 0.12);
      border: 1px solid rgba(220, 38, 38, 0.8);
      color: #fecaca;
    }

    body[data-theme="light"] .feedback-banner--success {
      background: #ecfdf3;
      border-color: #16a34a;
      color: #166534;
    }

    body[data-theme="light"] .feedback-banner--error {
      background: #fef2f2;
      border-color: #dc2626;
      color: #991b1b;
    }

    /* ------------------------------------------------------------------
       Gráfico e histórico
       ------------------------------------------------------------------ */

    .charts-wrapper {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 0.7rem;
      margin-bottom: 0.5rem;
    }

    .chart-card,
    .history-card {
      background: rgba(2, 6, 23, 0.96);
      border-radius: var(--radius-lg);
      border: 1px solid #1f2937;
      padding: 0.65rem 0.75rem;
    }

    body[data-theme="light"] .chart-card,
    body[data-theme="light"] .history-card {
      background: #ffffff;
      border-color: #d1d5db;
    }

    .history-card {
      padding-bottom: 0.8rem;
    }

    .chart-title,
    .history-title {
      margin: 0 0 0.25rem;
      font-size: 0.9rem;
    }

    .chart-helper,
    .history-help {
      margin: 0 0 0.3rem;
      font-size: 0.78rem;
      color: var(--text-soft);
      text-align: justify;
    }

    .history-table-wrapper {
      margin-top: 0.35rem;
      max-height: 240px;
      overflow: auto;
      border-radius: var(--radius-md);
      border: 1px solid #1f2937;
      background: #020617;
    }

    body[data-theme="light"] .history-table-wrapper {
      background: #f9fafb;
      border-color: #d1d5db;
    }

    .history-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.78rem;
    }

    .history-table th,
    .history-table td {
      padding: 0.28rem 0.4rem;
      border-bottom: 1px solid rgba(31, 41, 55, 0.85);
      text-align: left;
    }

    body[data-theme="light"] .history-table th,
    body[data-theme="light"] .history-table td {
      border-bottom-color: #e5e7eb;
    }

    .history-table th {
      position: sticky;
      top: 0;
      background: #020617;
      z-index: 1;
      font-weight: 600;
      color: var(--text-muted);
    }

    body[data-theme="light"] .history-table th {
      background: #f9fafb;
    }

    .history-table tr:last-child td {
      border-bottom: none;
    }

    .history-table td:nth-child(4) {
      max-width: 220px;
      overflow-wrap: break-word;
    }

    .history-empty {
      margin: 0.35rem 0;
      padding: 0 0.5rem 0.4rem;
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    .history-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.4rem;
      margin-top: 0.2rem;
    }

    /* ------------------------------------------------------------------
       Sobre
       ------------------------------------------------------------------ */

    .panel-about {
      margin-top: 0.1rem;
    }

    .about-content {
      font-size: 0.88rem;
      color: var(--text-muted);
      text-align: justify;
    }

    .about-content ul {
      padding-left: 1rem;
    }

    /* ------------------------------------------------------------------
       Onboarding – modal de boas-vindas
       ------------------------------------------------------------------ */

    .onboarding-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.78);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      z-index: 30;
    }

    .onboarding-backdrop[hidden] {
      display: none;
    }

    .onboarding-panel {
      max-width: 420px;
      width: 100%;
      background: var(--bg-card);
      color: var(--text-main);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--border-subtle);
      padding: 1.2rem 1.1rem 1rem;
    }

    .onboarding-title {
      margin: 0 0 0.4rem;
      font-size: 1rem;
      font-weight: 600;
      text-align: left;
    }

    .onboarding-intro {
      margin: 0 0 0.6rem;
      font-size: 0.86rem;
      color: var(--text-soft);
      text-align: justify;
    }

    .onboarding-steps {
      margin: 0 0 0.7rem;
      padding-left: 1.2rem;
      font-size: 0.85rem;
      color: var(--text-main);
    }

    .onboarding-steps li {
      margin-bottom: 0.3rem;
      text-align: justify;
    }

    .onboarding-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.4rem;
      margin-top: 0.2rem;
    }

    .onboarding-close {
      border-radius: 999px;
      border: 1px solid #4b5563;
      background: transparent;
      padding: 0.4rem 0.8rem;
      font-size: 0.8rem;
      color: var(--text-soft);
      cursor: pointer;
    }

    body[data-theme="light"] .onboarding-close {
      border-color: #9ca3af;
    }

    .onboarding-close:focus-visible {
      outline: none;
      box-shadow: var(--focus-ring);
    }

    .onboarding-note {
      margin: 0.3rem 0 0;
      font-size: 0.75rem;
      color: var(--text-soft);
      text-align: justify;
    }

    /* ------------------------------------------------------------------
       Rodapé – centrado e simétrico
       ------------------------------------------------------------------ */

    .app-footer {
      margin-top: auto;
      padding: 0.6rem 1rem 0.8rem;
      font-size: 0.78rem;
      color: var(--text-soft);
      border-top: 1px solid #111827;
      background: radial-gradient(circle at top, rgba(15,23,42,0.9) 0, #020617 50%, #000 100%);
    }

    body[data-theme="light"] .app-footer {
      border-top-color: #e5e7eb;
      background: linear-gradient(to right, #f9fafb 0, #ffffff 40%, #f9fafb 100%);
      color: #4b5563;
    }

    .footer-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.2rem;
      text-align: center;
    }

    .footer-main {
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }

    .footer-main p {
      margin: 0.1rem 0;
      line-height: 1.3;
    }

    .footer-main strong {
      font-weight: 600;
    }

    /* ------------------------------------------------------------------
       Acessibilidade genérica
       ------------------------------------------------------------------ */

    [role="button"],
    svg [tabindex="0"] {
      cursor: pointer;
    }

    /* ------------------------------------------------------------------
       Responsividade
       ------------------------------------------------------------------ */

    @media (min-width: 768px) {
      .layout {
        padding: 0 1.2rem;
      }

      .wheel-wrapper {
        max-width: 380px;
      }

      .emotion-wheel {
        max-width: 380px;
      }

      .form-row-inline {
        flex-direction: row;
      }

      .footer-inner {
        flex-direction: column;
      }
    }

    @media (min-width: 1024px) {
      .layout {
        padding: 0 1.5rem;
        grid-template-columns: minmax(0, 1.25fr) minmax(0, 1.75fr);
        grid-template-rows: auto auto;
        gap: 1.3rem;
      }

      .panel-wheel {
        grid-row: 1 / 3;
      }

      .panel-history {
        grid-column: 1 / 3;
      }

      .header-inner {
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
      }

      .nav-links {
        margin-top: 0;
        justify-content: flex-end;
      }

      .charts-wrapper {
        grid-template-columns: minmax(0, 1.3fr) minmax(0, 1.7fr);
      }
    }

    @media (max-width: 480px) {
      .wheel-label {
        font-size: 13px;
      }
    }
  </style>
</head>
<body data-theme="light">
  <header class="app-header">
    <div class="header-inner">
      <div>
        <p class="brand">Atlas Emocional</p>
        <h1 class="app-title">Roda das Emoções de Plutchik</h1>
        <p class="app-subtitle">
          Psicoeducação emocional e registro clínico de experiências. Escolha a emoção, entenda sua função e registre a situação com clareza.
        </p>
      </div>
      <nav aria-label="Navegação principal">
        <ul class="nav-links">
          <li><a href="#sec-mapa">Mapa</a></li>
          <li><a href="#sec-registro">Registro</a></li>
          <li><a href="#sec-graficos">Histórico</a></li>
          <li><a href="#sec-sobre">Sobre</a></li>
          <li>
            <button type="button" class="nav-help-button" id="openOnboardingButton">
              Como usar
            </button>
          </li>
          <li>
            <button type="button" class="btn-theme-toggle" id="themeToggle">
              <span id="themeIcon">☀️</span>
              <span id="themeLabel">Tema claro</span>
            </button>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="layout">
    <!-- Roda -->
    <section id="sec-mapa" class="panel panel-wheel" aria-labelledby="titulo-mapa">
      <header class="panel-header">
        <h2 id="titulo-mapa" class="section-title">Mapa emocional interativo</h2>
        <p class="section-subtitle">
          Baseado na Roda das Emoções de Plutchik: 8 emoções básicas, 3 intensidades e 8 combinações entre elas.
        </p>
      </header>

      <div class="wheel-wrapper" aria-live="polite">
        <svg
          id="emotionWheel"
          class="emotion-wheel"
          viewBox="-190 -190 380 380"
          role="img"
          aria-label="Roda das Emoções de Plutchik com intensidades e combinações">
        </svg>
        <p class="wheel-help">
          Clique ou use Tab + Enter em qualquer pétala para explorar a emoção e registrar sua experiência.
        </p>
      </div>
    </section>

    <!-- Detalhes e registro -->
    <section id="sec-registro" class="panel panel-details" aria-labelledby="titulo-detalhes">
      <header class="panel-header">
        <h2 id="titulo-detalhes" class="section-title">Detalhes da emoção e registro clínico</h2>
        <p class="section-subtitle">
          Nomeie o que sente, entenda a função da emoção e registre o contexto para trabalhar em sessão ou compartilhar com alguém de confiança.
        </p>
      </header>

      <article class="details-card" id="detailsCard" aria-live="polite">
        <p class="details-placeholder">
          Nenhuma emoção foi selecionada ainda. Use a roda ao lado para escolher uma emoção ou combinação e ver orientações psicoeducativas em linguagem simples.
        </p>
      </article>

      <form class="emotion-form" id="emotionForm" novalidate>
        <div class="form-row-inline">
          <div class="form-group">
            <label for="patientName" class="form-label">Nome do paciente</label>
            <input id="patientName" class="form-input" type="text" autocomplete="name" placeholder="Digite o nome do paciente (opcional)">
            <p class="helper-text">Ajuda a identificar o registro quando for conversar em sessão.</p>
          </div>
          <div class="form-group" style="max-width:110px;">
            <label for="patientAge" class="form-label">Idade</label>
            <input id="patientAge" class="form-input" type="number" min="0" max="120" inputmode="numeric" placeholder="Anos">
          </div>
          <div class="form-group" style="max-width:170px;">
            <label for="recordDate" class="form-label">Data de referência</label>
            <input id="recordDate" class="form-input" type="date">
          </div>
        </div>

        <div class="form-row-inline">
          <div class="form-group">
            <label for="selectedEmotion" class="form-label">Emoção selecionada</label>
            <input id="selectedEmotion" class="form-input" type="text" placeholder="Clique em uma pétala na roda (pode editar o nome se desejar)">
            <p class="helper-text">Você pode ajustar o nome para ficar mais parecido com sua experiência.</p>
          </div>
          <div class="form-group">
            <label for="userIntensity" class="form-label">Intensidade percebida</label>
            <select id="userIntensity" class="form-select">
              <option value="leve">Leve</option>
              <option value="moderada" selected>Moderada</option>
              <option value="intensa">Intensa</option>
            </select>
            <p class="helper-text">Escolha como a emoção pareceu forte para você neste momento.</p>
          </div>
        </div>

        <div class="form-group">
          <label for="contextInput" class="form-label">Contexto emocional *</label>
          <textarea id="contextInput" placeholder="O que aconteceu? Onde você estava? Com quem?"></textarea>
          <p class="helper-text">Descreva a cena como se contasse a alguém de confiança em poucas frases.</p>
        </div>

        <div class="form-row-inline">
          <div class="form-group">
            <label for="triggersInput" class="form-label">Gatilhos percebidos</label>
            <textarea id="triggersInput" placeholder="Palavras, imagens, situações ou pensamentos que parecem ativar essa emoção."></textarea>
            <p class="helper-text">Anote o que parece acender a emoção, mesmo que ainda não tenha certeza.</p>
          </div>
          <div class="form-group">
            <label for="behaviorsInput" class="form-label">O que você fez</label>
            <textarea id="behaviorsInput" placeholder="Como você reagiu? O que fez ou deixou de fazer?"></textarea>
            <p class="helper-text">Inclua ações e também o que você evitou fazer por causa da emoção.</p>
          </div>
        </div>

        <div class="form-group">
          <label for="desiredInput" class="form-label">Como gostaria de ter reagido</label>
          <textarea id="desiredInput" placeholder="Qual seria uma resposta mais alinhada com seus valores e objetivos?"></textarea>
          <p class="helper-text">Use este espaço para desenhar uma versão mais cuidadosa consigo e com os outros.</p>
        </div>

        <p class="helper-text">
          Este registro é para uso pessoal e para ser compartilhado em sessão. Nada é enviado automaticamente a servidores.
        </p>

        <div id="feedbackBanner" class="feedback-banner" role="status" aria-live="polite"></div>

        <div class="form-actions">
          <button type="button" class="btn-ghost" id="sendWhatsappButton">
            Enviar resumo ao psicólogo
          </button>
          <button type="button" class="btn-ghost" id="sharePageButton">
            Compartilhar esta página via WhatsApp
          </button>
          <button type="button" class="btn-secondary" id="downloadPdfButton">
            Baixar PDF do meu registro
          </button>
          <button type="submit" class="btn-primary" id="registerButton" disabled>
            Registrar emoção
          </button>
        </div>

        <p class="helper-warning">
          <strong>Lembrete importante:</strong> o WhatsApp não substitui serviços de urgência. Em situações de risco imediato, procure atendimento de emergência ou serviços locais de crise. Esta ferramenta é complementar à psicoterapia.
        </p>
      </form>
    </section>

    <!-- Histórico e gráficos -->
    <section id="sec-graficos" class="panel panel-history" aria-labelledby="titulo-graficos">
      <header class="panel-header">
        <h2 id="titulo-graficos" class="section-title">Histórico emocional e gráfico</h2>
        <p class="section-subtitle">
          Observe padrões ao longo do tempo e use os registros como base para decisões e planos em terapia.
        </p>
      </header>

      <div class="charts-wrapper">
        <article class="chart-card" aria-label="Gráfico de frequência por emoção primária">
          <h3 class="chart-title">Frequência das emoções básicas</h3>
          <p class="chart-helper">
            Cada barra representa quantas vezes cada emoção primária foi registrada neste navegador.
            Combinações (diades) contam para as duas emoções envolvidas, com peso 0,5 para cada uma.
          </p>
          <div style="height:220px;">
            <canvas id="emotionChart" aria-label="Gráfico de barras de frequência emocional" role="img"></canvas>
          </div>
        </article>

        <article class="history-card" aria-label="Histórico de registros emocionais">
          <h3 class="history-title">Histórico de registros</h3>
          <p class="history-help">
            Os dados ficam salvos apenas neste dispositivo por meio do armazenamento local. Você pode apagá-los quando desejar.
          </p>

          <div class="history-table-wrapper">
            <table class="history-table">
              <thead>
                <tr>
                  <th>Data e hora</th>
                  <th>Emoção</th>
                  <th>Intensidade</th>
                  <th>Contexto</th>
                </tr>
              </thead>
              <tbody id="historyBody"></tbody>
            </table>
            <p id="historyEmptyMessage" class="history-empty">
              Nenhum registro ainda. Use o formulário acima para registrar sua primeira emoção.
            </p>
          </div>

          <div class="history-actions">
            <button type="button" class="btn-secondary" id="clearHistoryButton">
              Limpar histórico
            </button>
          </div>
        </article>
      </div>
    </section>

    <!-- Sobre -->
    <section id="sec-sobre" class="panel panel-about" aria-labelledby="titulo-sobre">
      <header class="panel-header">
        <h2 id="titulo-sobre" class="section-title">Sobre esta ferramenta</h2>
      </header>
      <article class="about-content">
        <p>
          A Roda das Emoções de Plutchik organiza oito emoções básicas em diferentes intensidades e combinações.
          Esta ferramenta foi adaptada para uso psicoeducativo e clínico, ajudando na identificação, nomeação e
          regulação das emoções no dia a dia.
        </p>
        <p>
          O objetivo principal é treinar três habilidades:
        </p>
        <ul>
          <li>Perceber o que você está sentindo com mais precisão.</li>
          <li>Compreender a função da emoção em vez de apenas julgá-la como boa ou ruim.</li>
          <li>Planejar respostas mais compatíveis com seus valores e metas de vida.</li>
        </ul>
        <p>
          Esta ferramenta não substitui psicoterapia ou atendimento médico. É um recurso de apoio
          para ser usado em conjunto com acompanhamento profissional.
        </p>
      </article>
    </section>
  </main>

  <!-- Onboarding -->
  <div class="onboarding-backdrop" id="onboardingModal" hidden>
    <section class="onboarding-panel" role="dialog" aria-modal="true" aria-labelledby="onboardingTitle" aria-describedby="onboardingDescription">
      <h2 id="onboardingTitle" class="onboarding-title">Como usar a Roda das Emoções</h2>
      <p id="onboardingDescription" class="onboarding-intro">
        Esta ferramenta foi pensada para que você se sinta acolhido ao olhar para suas emoções, com clareza e sem julgamentos.
      </p>
      <ol class="onboarding-steps">
        <li><strong>Escolha uma emoção na roda.</strong> Toque em uma pétala que pareça combinar com o que você está sentindo agora.</li>
        <li><strong>Leia a explicação da emoção e veja como ela funciona em você.</strong> Observe a definição, a função e os principais riscos.</li>
        <li><strong>Registre a situação.</strong> Anote o contexto, gatilhos e como reagiu, para conversar em sessão ou compartilhar com alguém de confiança.</li>
      </ol>
      <p class="onboarding-note">
        Você pode reabrir estas orientações sempre que quiser clicando em *Como usar* no topo da página.
      </p>
      <div class="onboarding-actions">
        <button type="button" class="onboarding-close" id="onboardingCloseButton">
          Fechar
        </button>
        <button type="button" class="btn-primary" id="onboardingStartButton">
          Entendi, começar
        </button>
      </div>
    </section>
  </div>

  <footer class="app-footer">
    <div class="footer-inner">
      <div class="footer-main">
        <p>
          <strong>Richelmy Murta – Psicólogo Clínico</strong>
        </p>
        <p>
          Ferramenta de psicoeducação baseada na Roda das Emoções de Plutchik. Uso clínico e educativo responsável.
        </p>
        <p>
          © 2025. Registros armazenados apenas neste dispositivo.
        </p>
      </div>
    </div>
  </footer>

  <script>
    "use strict";

    /* ------------------------------------------------------------------
       Configuração de emoções e diades
       ------------------------------------------------------------------ */

    const PRIMARIES = [
      { key: "joy", label: "Alegria", angle: -90,    colors: "#ffd54a" },
      { key: "trust", label: "Confiança", angle: -45, colors: "#b7f96a" },
      { key: "fear", label: "Medo", angle: 0,        colors: "#4caf50" },
      { key: "surprise", label: "Surpresa", angle: 45,  colors: "#4fc3f7" },
      { key: "sadness", label: "Tristeza", angle: 90,   colors: "#5c6bc0" },
      { key: "disgust", label: "Nojo", angle: 135,   colors: "#ba68c8" },
      { key: "anger", label: "Raiva", angle: 180,   colors: "#ff5252" },
      { key: "anticipation", label: "Antecipação", angle: 225, colors: "#ff9800" }
    ];

    const INTENSITY_CONFIG = {
      joy: [
        { code: "joy_high",   label: "Êxtase",      ring: "high" },
        { code: "joy_mid",    label: "Alegria",     ring: "mid" },
        { code: "joy_low",    label: "Serenidade",  ring: "low" }
      ],
      trust: [
        { code: "trust_high", label: "Admiração",   ring: "high" },
        { code: "trust_mid",  label: "Confiança",   ring: "mid" },
        { code: "trust_low",  label: "Aprovação",   ring: "low" }
      ],
      fear: [
        { code: "fear_high",  label: "Terror",      ring: "high" },
        { code: "fear_mid",   label: "Medo",        ring: "mid" },
        { code: "fear_low",   label: "Apreensão",   ring: "low" }
      ],
      surprise: [
        { code: "surprise_high", label: "Assombro",    ring: "high" },
        { code: "surprise_mid",  label: "Surpresa",    ring: "mid" },
        { code: "surprise_low",  label: "Distração",   ring: "low" }
      ],
      sadness: [
        { code: "sadness_high",  label: "Angústia",    ring: "high" },
        { code: "sadness_mid",   label: "Tristeza",    ring: "mid" },
        { code: "sadness_low",   label: "Tédio",       ring: "low" }
      ],
      disgust: [
        { code: "disgust_high",  label: "Repugnância", ring: "high" },
        { code: "disgust_mid",   label: "Nojo",        ring: "mid" },
        { code: "disgust_low",   label: "Aborrecimento", ring: "low" }
      ],
      anger: [
        { code: "anger_high",    label: "Ira",         ring: "high" },
        { code: "anger_mid",     label: "Raiva",       ring: "mid" },
        { code: "anger_low",     label: "Irritação",   ring: "low" }
      ],
      anticipation: [
        { code: "anticipation_high", label: "Vigilância",  ring: "high" },
        { code: "anticipation_mid",  label: "Antecipação", ring: "mid" },
        { code: "anticipation_low",  label: "Interesse",   ring: "low" }
      ]
    };

    const DIADS = [
      { code: "diad_love",         label: "Amor",          primaryA: "joy",         primaryB: "trust" },
      { code: "diad_submission",   label: "Submissão",     primaryA: "trust",       primaryB: "fear" },
      { code: "diad_intimidation", label: "Intimidação",   primaryA: "fear",        primaryB: "surprise" },
      { code: "diad_disapproval",  label: "Desaprovação",  primaryA: "surprise",    primaryB: "sadness" },
      { code: "diad_remorse",      label: "Remorso",       primaryA: "sadness",     primaryB: "disgust" },
      { code: "diad_contempt",     label: "Menosprezo",    primaryA: "disgust",     primaryB: "anger" },
      { code: "diad_aggressivity", label: "Agressividade", primaryA: "anger",       primaryB: "anticipation" },
      { code: "diad_optimism",     label: "Otimismo",      primaryA: "anticipation", primaryB: "joy" }
    ];

    const PRIMARY_LABELS = {
      joy: "Alegria",
      trust: "Confiança",
      fear: "Medo",
      surprise: "Surpresa",
      sadness: "Tristeza",
      disgust: "Nojo",
      anger: "Raiva",
      anticipation: "Antecipação"
    };

    /* ------------------------------------------------------------------
       Psicoeducação – INFO_MAP
       ------------------------------------------------------------------ */

    const INFO_MAP = {
      /* ALEGRIA */
      joy_high: {
        displayName: "Êxtase",
        primary: "joy",
        type: "primary",
        ring: "high",
        definition: "Alegria em nível muito alto, com euforia e sensação de celebração intensa.",
        adaptive: "Marcar conquistas importantes e liberar energia para comemorar.",
        situations: [
          "Alcançar um objetivo de longa data.",
          "Viver experiências únicas, como formaturas, casamentos ou vitórias marcantes."
        ],
        risks: [
          "Tomar decisões impulsivas no auge da euforia.",
          "Comparar o cotidiano com o momento de êxtase e sentir frustração depois."
        ],
        strategies: [
          "Adiar decisões importantes para algumas horas depois da intensa euforia.",
          "Registrar o que este momento revela sobre seus valores e esforços."
        ],
        reflections: [
          "Que compromisso quero assumir comigo após esta conquista?",
          "Como posso celebrar sem agredir meus próprios limites?"
        ]
      },
      joy_mid: {
        displayName: "Alegria",
        primary: "joy",
        type: "primary",
        ring: "mid",
        definition: "Estado de satisfação e bem-estar ao vivenciar algo positivo e significativo.",
        adaptive: "Reforçar comportamentos saudáveis e aproximar de pessoas e atividades valiosas.",
        situations: [
          "Compartilhar boas notícias com alguém importante.",
          "Desfrutar de momentos de lazer e conexão afetiva."
        ],
        risks: [
          "Ignorar emoções difíceis para parecer sempre alegre.",
          "Usar apenas prazer imediato como critério para decisões."
        ],
        strategies: [
          "Dividir a alegria com alguém de confiança, sem comparação.",
          "Aproveitar a energia da alegria para iniciar hábitos saudáveis."
        ],
        reflections: [
          "O que, além do prazer, torna esta situação cheia de sentido?",
          "Como posso cuidar para que esta alegria não vire autoexigência?"
        ]
      },
      joy_low: {
        displayName: "Serenidade",
        primary: "joy",
        type: "primary",
        ring: "low",
        definition: "Calma suave, sensação de tranquilidade e conforto, sem grande excitação.",
        adaptive: "Permitir descanso, recuperação e apreciação de momentos simples.",
        situations: [
          "Fim de um dia produtivo com tempo para desacelerar.",
          "Estar em local seguro, fazendo algo que traz paz."
        ],
        risks: [
          "Adiar mudanças necessárias por estar confortável demais.",
          "Minimizar necessidades emocionais para não desestabilizar a calma."
        ],
        strategies: [
          "Notar sensações corporais de relaxamento e segurança.",
          "Usar a serenidade para refletir com clareza sobre próximos passos."
        ],
        reflections: [
          "Do que esta calma está me protegendo?",
          "Que pequena ação posso planejar a partir desta serenidade?"
        ]
      },

      /* CONFIANÇA */
      trust_high: {
        displayName: "Admiração",
        primary: "trust",
        type: "primary",
        ring: "high",
        definition: "Confiança intensa misturada com respeito e inspiração por alguém ou algo.",
        adaptive: "Oferecer modelos de crescimento e motivar desenvolvimento pessoal.",
        situations: [
          "Observar alguém enfrentando dificuldades com integridade.",
          "Estudar pessoas que representam valores que você deseja cultivar."
        ],
        risks: [
          "Idealizar o outro e sentir-se sempre menor.",
          "Copiar comportamentos sem considerar seus próprios limites."
        ],
        strategies: [
          "Identificar quais qualidades admiráveis você já possui em algum grau.",
          "Transformar admiração em metas concretas, pequenas e realistas."
        ],
        reflections: [
          "O que exatamente admiro e como isso conversa com meus valores?",
          "Como posso aprender com esta pessoa sem me apagar?"
        ]
      },
      trust_mid: {
        displayName: "Confiança",
        primary: "trust",
        type: "primary",
        ring: "mid",
        definition: "Sensação de segurança em relação a alguém, a si mesmo ou a uma situação.",
        adaptive: "Permitir cooperação, delegação e construção de vínculos estáveis.",
        situations: [
          "Parcerias em que os combinados são cumpridos.",
          "Relacionamentos nos quais segredos são respeitados."
        ],
        risks: [
          "Acreditar demais em pessoas pouco confiáveis.",
          "Fechar os olhos para sinais de desrespeito por medo de perder segurança."
        ],
        strategies: [
          "Estabelecer limites claros e revisá-los quando necessário.",
          "Observar se você também se comporta de forma confiável."
        ],
        reflections: [
          "Que limites saudáveis podem proteger essa confiança?",
          "O quanto confio em mim para sustentar minhas escolhas?"
        ]
      },
      trust_low: {
        displayName: "Aprovação",
        primary: "trust",
        type: "primary",
        ring: "low",
        definition: "Sensação de ser aceito, reconhecido ou validado por outra pessoa ou grupo.",
        adaptive: "Fortalecer vínculos e facilitar cooperação em ambientes seguros.",
        situations: [
          "Receber feedback respeitoso sobre o seu trabalho.",
          "Ser incluído em decisões importantes."
        ],
        risks: [
          "Depender da aprovação externa para se sentir suficiente.",
          "Evitar conversas difíceis para não decepcionar o outro."
        ],
        strategies: [
          "Reconhecer internamente as próprias qualidades, além do elogio.",
          "Equilibrar o desejo de agradar com seus valores pessoais."
        ],
        reflections: [
          "Em quais áreas tenho buscado apenas aprovação externa?",
          "Que tipo de autoaprovação quero construir?"
        ]
      },

      /* MEDO */
      fear_high: {
        displayName: "Terror",
        primary: "fear",
        type: "primary",
        ring: "high",
        definition: "Medo extremo, com sensação de ameaça grave e perda de controle.",
        adaptive: "Ativar resposta de emergência quando a integridade está em risco real.",
        situations: [
          "Acidentes, violência ou situações traumáticas.",
          "Crises intensas de pânico."
        ],
        risks: [
          "Generalizar o terror para contextos seguros.",
          "Evitar ajuda por medo de reviver lembranças."
        ],
        strategies: [
          "Buscar ancoragem no presente com estímulos seguros (contato visual, tato, respiração).",
          "Procurar ajuda profissional para trabalhar experiências traumáticas."
        ],
        reflections: [
          "Que recursos tenho hoje que não tinha em momentos passados?",
          "Quem pode caminhar comigo neste processo de reconstrução?"
        ]
      },
      fear_mid: {
        displayName: "Medo",
        primary: "fear",
        type: "primary",
        ring: "mid",
        definition: "Resposta a ameaça percebida, preparando o corpo para proteção.",
        adaptive: "Proteger sua integridade física e emocional, evitando perigos reais.",
        situations: [
          "Contextos de instabilidade ou riscos concretos.",
          "Medo de rejeição, perda de vínculo ou fracasso relevante."
        ],
        risks: [
          "Evitar cronicamente situações essenciais para seus objetivos.",
          "Ignorar riscos reais por tentar não sentir medo algum."
        ],
        strategies: [
          "Distinguir perigos reais de possibilidades imaginadas.",
          "Enfrentar gradualmente situações importantes, com plano e apoio."
        ],
        reflections: [
          "O que este medo revela sobre o que é valioso para mim?",
          "Em qual ponto o medo me protege e em qual ponto me paralisa?"
        ]
      },
      fear_low: {
        displayName: "Apreensão",
        primary: "fear",
        type: "primary",
        ring: "low",
        definition: "Preocupação leve com algo que pode dar errado, mas ainda incerto.",
        adaptive: "Alertar sobre possíveis riscos e incentivar preparação antecipada.",
        situations: [
          "Esperar resultados de provas, exames ou entrevistas.",
          "Iniciar atividades novas ainda desconhecidas."
        ],
        risks: [
          "Transformar apreensão em ruminação sem ação.",
          "Confundir possibilidade com certeza de desastre."
        ],
        strategies: [
          "Listar o que está sob seu controle e agir sobre isso.",
          "Definir um pequeno primeiro passo ao invés de tentar resolver tudo."
        ],
        reflections: [
          "Que parte desta apreensão é fato e qual é hipótese?",
          "Que atitude realista posso tomar hoje?"
        ]
      },

      /* SURPRESA */
      surprise_high: {
        displayName: "Assombro",
        primary: "surprise",
        type: "primary",
        ring: "high",
        definition: "Surpresa intensa diante de algo muito diferente do esperado.",
        adaptive: "Forçar reavaliação rápida de crenças e expectativas.",
        situations: [
          "Impactos positivos ou negativos muito acima do previsto.",
          "Descobertas que mudam sua visão de mundo."
        ],
        risks: [
          "Congelar e não conseguir agir diante da novidade.",
          "Criar conclusões extremas com base em um único evento."
        ],
        strategies: [
          "Buscar mais informações antes de decidir.",
          "Conversar com alguém de confiança para organizar o impacto."
        ],
        reflections: [
          "Que visão minha está sendo convidada a amadurecer?",
          "O que posso aprender com esse assombro sem negar meu susto?"
        ]
      },
      surprise_mid: {
        displayName: "Surpresa",
        primary: "surprise",
        type: "primary",
        ring: "mid",
        definition: "Quebra de expectativa por algo inesperado.",
        adaptive: "Interromper o piloto automático e reavaliar a situação.",
        situations: [
          "Mudanças de agenda de última hora.",
          "Receber notícias que não estavam no radar."
        ],
        risks: [
          "Responder impulsivamente antes de entender o contexto.",
          "Tratar qualquer mudança como ameaça."
        ],
        strategies: [
          "Dar um tempo antes de tomar decisões.",
          "Perguntar, investigar e esclarecer antes de concluir."
        ],
        reflections: [
          "Esta surpresa abre alguma oportunidade de crescimento?",
          "O que ainda preciso compreender melhor aqui?"
        ]
      },
      surprise_low: {
        displayName: "Distração",
        primary: "surprise",
        type: "primary",
        ring: "low",
        definition: "Desvio leve de atenção por estímulos novos e constantes.",
        adaptive: "Redirecionar o foco para algo que pode ser mais relevante.",
        situations: [
          "Notificações frequentes em dispositivos.",
          "Interrupções leves durante o trabalho."
        ],
        risks: [
          "Fragmentar a atenção e perder profundidade nas tarefas.",
          "Confundir urgência com importância real."
        ],
        strategies: [
          "Definir janelas específicas para checar notificações.",
          "Praticar períodos curtos de foco total em uma única tarefa."
        ],
        reflections: [
          "O que realmente merece minha atenção agora?",
          "Que limite simples posso testar para proteger meu foco?"
        ]
      },

      /* TRISTEZA */
      sadness_high: {
        displayName: "Angústia",
        primary: "sadness",
        type: "primary",
        ring: "high",
        definition: "Tristeza profunda misturada a aperto interno e sensação de peso.",
        adaptive: "Sinalizar que algo muito importante foi ferido ou perdido.",
        situations: [
          "Luto por pessoas, relações ou projetos.",
          "Acúmulo de frustrações significativas."
        ],
        risks: [
          "Perder a esperança e deixar de buscar ajuda.",
          "Confundir angústia com identidade permanente."
        ],
        strategies: [
          "Procurar apoio profissional e rede de confiança.",
          "Fatiar tarefas em passos mínimos, respeitando o ritmo do momento."
        ],
        reflections: [
          "Que partes de mim pedem acolhimento, não julgamento?",
          "Qual pequeno gesto de cuidado é possível hoje?"
        ]
      },
      sadness_mid: {
        displayName: "Tristeza",
        primary: "sadness",
        type: "primary",
        ring: "mid",
        definition: "Resposta a perdas, frustrações ou afastamentos importantes.",
        adaptive: "Favorecer recolhimento, elaboração e busca de apoio.",
        situations: [
          "Fim de ciclos ou relações significativas.",
          "Percepção de que algo esperado não aconteceu."
        ],
        risks: [
          "Isolamento prolongado e abandono de rotinas necessárias.",
          "Tratar tristeza como sinal de fraqueza."
        ],
        strategies: [
          "Permitir-se sentir sem autoacusação.",
          "Manter pequenas rotinas de sono, alimentação e contato social."
        ],
        reflections: [
          "O que esta tristeza protege ou tenta mostrar?",
          "De que tipo de ajuda real eu precisaria agora?"
        ]
      },
      sadness_low: {
        displayName: "Tédio",
        primary: "sadness",
        type: "primary",
        ring: "low",
        definition: "Sensação de vazio leve, desinteresse ou falta de estímulo.",
        adaptive: "Indicar necessidade de novos desafios ou mudanças de rota.",
        situations: [
          "Rotinas muito repetitivas.",
          "Fases de transição em que o futuro ainda é indefinido."
        ],
        risks: [
          "Buscar apenas distrações automáticas para fugir do tédio.",
          "Interpretar tédio como prova de incapacidade."
        ],
        strategies: [
          "Explorar pequenas novidades saudáveis na rotina.",
          "Refletir sobre o que perdeu sentido e o que poderia ganhar vida de novo."
        ],
        reflections: [
          "Que área da minha vida pede renovação?",
          "O que eu gostava de fazer e abandonei?"
        ]
      },

      /* NOJO */
      disgust_high: {
        displayName: "Repugnância",
        primary: "disgust",
        type: "primary",
        ring: "high",
        definition: "Nojo intenso e aversão forte, com desejo de afastamento imediato.",
        adaptive: "Proteger de situações que violam profundamente seus limites físicos ou morais.",
        situations: [
          "Vivências de abuso, humilhação ou violência.",
          "Contato com atitudes consideradas degradantes."
        ],
        risks: [
          "Estender repugnância para si mesmo, gerando vergonha extrema.",
          "Fechar qualquer possibilidade de diálogo quando seria útil."
        ],
        strategies: [
          "Distinguir atos específicos de toda a identidade da pessoa.",
          "Reafirmar limites com apoio profissional quando necessário."
        ],
        reflections: [
          "Que valor essencial está sendo tocado por esta repugnância?",
          "Como posso me proteger sem me desumanizar?"
        ]
      },
      disgust_mid: {
        displayName: "Nojo",
        primary: "disgust",
        type: "primary",
        ring: "mid",
        definition: "Reação de repulsa a algo percebido como contaminante ou ofensivo.",
        adaptive: "Afastar de ambientes, atitudes ou relações que ferem a integridade.",
        situations: [
          "Ambientes fisicamente sujos.",
          "Comportamentos que vão contra seus princípios básicos."
        ],
        risks: [
          "Transformar nojo em julgamento rígido de grupos inteiros.",
          "Usar repulsa para justificar desrespeito."
        ],
        strategies: [
          "Diferenciar proteção legítima de preconceito.",
          "Estabelecer distância saudável de situações realmente tóxicas."
        ],
        reflections: [
          "O que desejo proteger em mim quando sinto nojo?",
          "Há outra forma de defender meus valores sem desumanizar ninguém?"
        ]
      },
      disgust_low: {
        displayName: "Aborrecimento",
        primary: "disgust",
        type: "primary",
        ring: "low",
        definition: "Desgosto leve ou incômodo persistente com algo que não agrada.",
        adaptive: "Indicar que ajustes podem ser necessários na rotina ou nas relações.",
        situations: [
          "Conversas repetitivas que já não fazem sentido.",
          "Pequenas atitudes que vão contra o que você considera adequado."
        ],
        risks: [
          "Acumular aborrecimento até explodir.",
          "Descontar irritação em pessoas que não têm relação direta."
        ],
        strategies: [
          "Identificar o que exatamente incomoda.",
          "Comunicar incômodos cedo, de forma objetiva e respeitosa."
        ],
        reflections: [
          "Esta situação fere valores ou apenas preferências?",
          "Que ajuste simples poderia reduzir este aborrecimento?"
        ]
      },

      /* RAIVA */
      anger_high: {
        displayName: "Ira",
        primary: "anger",
        type: "primary",
        ring: "high",
        definition: "Raiva intensa, com grande energia para confronto.",
        adaptive: "Proteger limites e reagir a injustiças sérias.",
        situations: [
          "Humilhações repetidas.",
          "Quebra grave de confiança."
        ],
        risks: [
          "Atacar de forma que gere danos irreversíveis.",
          "Reagir sempre com guerra, mesmo quando não necessário."
        ],
        strategies: [
          "Afastar-se por alguns minutos antes de agir.",
          "Escrever o que deseja dizer e revisar depois."
        ],
        reflections: [
          "Que limite meu está sendo violado aqui?",
          "O que eu não quero mais tolerar e como posso comunicar isso?"
        ]
      },
      anger_mid: {
        displayName: "Raiva",
        primary: "anger",
        type: "primary",
        ring: "mid",
        definition: "Resposta a frustrações ou injustiças percebidas, com energia de oposição.",
        adaptive: "Indicar necessidade de defender direitos ou ajustar relações.",
        situations: [
          "Críticas injustas.",
          "Expectativas quebradas sem diálogo."
        ],
        risks: [
          "Transformar qualquer frustração em conflito.",
          "Engolir raiva por medo de conflitos e adoecer por dentro."
        ],
        strategies: [
          "Nomear a raiva e reconhecer o que ela protege.",
          "Escolher um momento adequado para conversas difíceis."
        ],
        reflections: [
          "O que esta raiva está tentando proteger em mim?",
          "Qual seria uma forma firme e respeitosa de agir?"
        ]
      },
      anger_low: {
        displayName: "Irritação",
        primary: "anger",
        type: "primary",
        ring: "low",
        definition: "Incômodo diante de pequenas falhas, atrasos ou invasões de espaço.",
        adaptive: "Sinalizar ajustes necessários na rotina, nos limites e na comunicação.",
        situations: [
          "Interrupções constantes em tarefas importantes.",
          "Descuidos repetidos com combinados simples."
        ],
        risks: [
          "Guardar irritação até explodir por algo pequeno.",
          "Ignorar sinais de cansaço e sobrecarga."
        ],
        strategies: [
          "Comunicar incômodos cedo, antes de acumular.",
          "Criar pausas curtas para reduzir tensão física."
        ],
        reflections: [
          "Que pedido claro eu ainda não fiz?",
          "O que posso ajustar antes que a irritação aumente?"
        ]
      },

      /* ANTECIPAÇÃO */
      anticipation_high: {
        displayName: "Vigilância",
        primary: "anticipation",
        type: "primary",
        ring: "high",
        definition: "Estado de alerta elevado, monitorando riscos ou oportunidades o tempo todo.",
        adaptive: "Proteger em contextos de alta responsabilidade e instabilidade.",
        situations: [
          "Cuidar de pessoas vulneráveis em situações críticas.",
          "Liderar equipes em momentos de crise."
        ],
        risks: [
          "Exaustão por se manter sempre em hiperalerta.",
          "Dificuldade de relaxar mesmo em ambientes seguros."
        ],
        strategies: [
          "Estabelecer janelas reais de descanso e desligamento.",
          "Delegar tarefas quando possível, confiando em outras pessoas."
        ],
        reflections: [
          "Em quais momentos posso abaixar a guarda com segurança?",
          "Que custo tenho pago por me manter sempre vigilante?"
        ]
      },
      anticipation_mid: {
        displayName: "Antecipação",
        primary: "anticipation",
        type: "primary",
        ring: "mid",
        definition: "Expectativa ativa em relação ao futuro, com foco em planejamento.",
        adaptive: "Organizar recursos e preparar-se para próximos passos.",
        situations: [
          "Planejar mudanças importantes.",
          "Preparar apresentações, provas ou projetos relevantes."
        ],
        risks: [
          "Confundir planejamento com controle total.",
          "Viver tanto no futuro que perde o presente."
        ],
        strategies: [
          "Transformar expectativas em planos escritos e realistas.",
          "Separar o que é controlável do que não depende de você."
        ],
        reflections: [
          "Minha antecipação está me organizando ou me consumindo?",
          "Qual pequeno passo posso dar hoje em direção ao que desejo?"
        ]
      },
      anticipation_low: {
        displayName: "Interesse",
        primary: "anticipation",
        type: "primary",
        ring: "low",
        definition: "Curiosidade tranquila por algo novo ou diferente.",
        adaptive: "Estimular exploração, aprendizagem e abertura para possibilidades.",
        situations: [
          "Conhecer pessoas e temas novos.",
          "Iniciar leituras ou projetos por curiosidade."
        ],
        risks: [
          "Espalhar energia em muitos interesses sem aprofundar nenhum.",
          "Usar apenas novidades para fugir de temas difíceis."
        ],
        strategies: [
          "Escolher poucos focos de interesse por vez.",
          "Registrar o que desperta curiosidade genuína, não só modas."
        ],
        reflections: [
          "O que este interesse diz sobre quem estou me tornando?",
          "Que ação pequena posso fazer hoje para honrar essa curiosidade?"
        ]
      },

      /* ----------------- DIADES ----------------- */
      diad_love: {
        displayName: "Amor",
        type: "diad",
        primaries: ["joy", "trust"],
        definition: "Combinação de alegria e confiança que gera vínculo profundo e cuidado mútuo.",
        adaptive: "Sustentar relações de apoio, compromisso e pertencimento.",
        situations: [
          "Relações nas quais há alegria em estar junto e confiança construída.",
          "Cuidado consistente em família, amizades e parcerias."
        ],
        risks: [
          "Confundir amor com necessidade de se anular.",
          "Tolerar desrespeitos em nome de não ficar só."
        ],
        strategies: [
          "Equilibrar entrega com preservação de limites pessoais.",
          "Comunicar necessidades com honestidade em vez de adivinhar."
        ],
        reflections: [
          "Que tipo de amor quero construir: posse ou parceria?",
          "Onde posso cuidar de mim sem deixar de cuidar do outro?"
        ]
      },
      diad_submission: {
        displayName: "Submissão",
        type: "diad",
        primaries: ["trust", "fear"],
        definition: "Mistura de confiança com medo, levando a ceder demais para evitar conflito.",
        adaptive: "Pode proteger em contextos hierárquicos rígidos ou de risco real.",
        situations: [
          "Relações onde uma parte tem muito mais poder.",
          "Ambientes em que discordar parece perigoso."
        ],
        risks: [
          "Perder a própria voz e identidade.",
          "Aceitar abusos por medo de desagradar."
        ],
        strategies: [
          "Começar por pequenos gestos de autoafirmação.",
          "Identificar pessoas seguras para compartilhar dúvidas e limites."
        ],
        reflections: [
          "Em quais áreas tenho dito sempre sim quando queria dizer não?",
          "Que consequência real temo enfrentar ao me posicionar?"
        ]
      },
      diad_intimidation: {
        displayName: "Intimidação",
        type: "diad",
        primaries: ["fear", "surprise"],
        definition: "Combinação de medo e surpresa diante de alguém ou situação que impõe poder.",
        adaptive: "Alertar sobre riscos e ajudar a avaliar limites do outro.",
        situations: [
          "Ambientes em que a autoridade é usada de forma hostil.",
          "Situações em que críticas vêm com humilhação."
        ],
        risks: [
          "Aceitar padrões de violência como normais.",
          "Silenciar necessidades por sentir-se pequeno demais."
        ],
        strategies: [
          "Buscar apoio externo para avaliar a situação.",
          "Fortalecer redes de suporte para não enfrentar tudo sozinho."
        ],
        reflections: [
          "Este medo é proporcional ao risco ou à forma como fui tratado no passado?",
          "Que passos graduais podem reduzir a sensação de ameaça?"
        ]
      },
      diad_disapproval: {
        displayName: "Desaprovação",
        type: "diad",
        primaries: ["surprise", "sadness"],
        definition: "Mistura de surpresa e tristeza ao perceber algo como errado ou decepcionante.",
        adaptive: "Rever escolhas, limites e alinhamento com valores.",
        situations: [
          "Descobrir comportamentos que vão contra o que você esperava.",
          "Perceber falhas éticas em pessoas de referência."
        ],
        risks: [
          "Se tornar excessivamente crítico e rígido.",
          "Usar desaprovação para excluir, não para dialogar."
        ],
        strategies: [
          "Diferenciar pessoa, comportamento e contexto.",
          "Buscar conversas claras antes de romper vínculos."
        ],
        reflections: [
          "O que exatamente me decepciona aqui?",
          "Há espaço para reparação ou apenas para afastamento saudável?"
        ]
      },
      diad_remorse: {
        displayName: "Remorso",
        type: "diad",
        primaries: ["sadness", "disgust"],
        definition: "Tristeza misturada a nojo de si mesmo pelo que fez ou deixou de fazer.",
        adaptive: "Reconhecer erros, aprender com eles e buscar reparação.",
        situations: [
          "Atitudes impulsivas que ferem alguém importante.",
          "Negligenciar responsabilidades significativas."
        ],
        risks: [
          "Ficar preso em autopunição sem mudança real.",
          "Tratar-se como irrecuperável."
        ],
        strategies: [
          "Assumir responsabilidade sem se reduzir apenas ao erro.",
          "Planejar ações concretas de reparação ou mudança."
        ],
        reflections: [
          "O que posso aprender com este erro?",
          "Que passo real de reparo posso dar, mesmo pequeno?"
        ]
      },
      diad_contempt: {
        displayName: "Menosprezo",
        type: "diad",
        primaries: ["disgust", "anger"],
        definition: "Nojo misturado com raiva, levando a olhar o outro como inferior.",
        adaptive: "Proteger-se de relações realmente abusivas quando usado com consciência.",
        situations: [
          "Contato repetido com atitudes desrespeitosas.",
          "Relações marcadas por manipulação e exploração."
        ],
        risks: [
          "Desumanizar pessoas, fechando qualquer ponte de diálogo.",
          "Projetar no outro aquilo que não tolera em si mesmo."
        ],
        strategies: [
          "Diferenciar afastar-se por proteção de atacar por desprezo.",
          "Trabalhar em terapia sentimentos de superioridade defensiva."
        ],
        reflections: [
          "Estou me protegendo ou punindo?",
          "Que vulnerabilidade minha este menosprezo tenta encobrir?"
        ]
      },
      diad_aggressivity: {
        displayName: "Agressividade",
        type: "diad",
        primaries: ["anger", "anticipation"],
        definition: "Raiva combinada com antecipação, preparando ataques e confrontos constantes.",
        adaptive: "Pode ser útil para defender direitos em contextos hostis, quando bem dosada.",
        situations: [
          "Ambientes competitivos e pouco cooperativos.",
          "Histórico de precisar se defender sozinho."
        ],
        risks: [
          "Entrar em guerra onde bastaria firmeza.",
          "Romper relações antes de tentar negociação."
        ],
        strategies: [
          "Avaliar custo-benefício de cada batalha.",
          "Direcionar energia para ações criativas e não apenas combativas."
        ],
        reflections: [
          "Quais lutas valem realmente meu desgaste?",
          "Como posso defender meus limites sem me destruir?"
        ]
      },
      diad_optimism: {
        displayName: "Otimismo",
        type: "diad",
        primaries: ["anticipation", "joy"],
        definition: "Combinação de antecipação e alegria, olhando o futuro com esperança realista.",
        adaptive: "Sustentar motivação, perseverança e visão de possibilidades.",
        situations: [
          "Começo de projetos importantes.",
          "Processos de recuperação após períodos difíceis."
        ],
        risks: [
          "Desconsiderar riscos concretos em nome de esperança ingênua.",
          "Culpar-se quando as coisas não saem como esperado."
        ],
        strategies: [
          "Equilibrar entusiasmo com análise realista.",
          "Rever planos sem abandonar o senso de possibilidade."
        ],
        reflections: [
          "Onde posso ajustar meu plano sem perder a esperança?",
          "Que evidências sustentam meu otimismo hoje?"
        ]
      }
    };

    /* ------------------------------------------------------------------
       Utilidades
       ------------------------------------------------------------------ */

    function shadeColor(hex, percent) {
      let num = parseInt(hex.replace("#", ""), 16);
      let r = (num >> 16) + percent;
      let g = ((num >> 8) & 0x00FF) + percent;
      let b = (num & 0x0000FF) + percent;
      r = Math.max(Math.min(255, r), 0);
      g = Math.max(Math.min(255, g), 0);
      b = Math.max(Math.min(255, b), 0);
      return "#" + (b | (g << 8) | (r << 16)).toString(16).padStart(6, "0");
    }

    function formatDateTime(date) {
      const pad = (n) => String(n).padStart(2, "0");
      return `${pad(date.getDate())}/${pad(date.getMonth() + 1)}/${date.getFullYear()} ${pad(date.getHours())}:${pad(date.getMinutes())}`;
    }

    function truncate(text, max) {
      if (!text) return "";
      return text.length > max ? text.slice(0, max) + "…" : text;
    }

    /* ------------------------------------------------------------------
       Desenho da roda em SVG
       ------------------------------------------------------------------ */

    function buildWheel() {
      const svg = document.getElementById("emotionWheel");
      svg.innerHTML = "";

      const centerX = 0;
      const centerY = 0;
      const stepAngle = 45;
      const innerR = 32;
      const midR = 75;
      const outerR = 118;
      const diadInnerR = 135;
      const diadOuterR = 160;

      const degToRad = (deg) => (deg * Math.PI) / 180;

      function createWedge(rInner, rOuter, startDeg, endDeg, options) {
        const startRad = degToRad(startDeg);
        const endRad = degToRad(endDeg);

        const x1 = centerX + rInner * Math.cos(startRad);
        const y1 = centerY + rInner * Math.sin(startRad);
        const x2 = centerX + rInner * Math.cos(endRad);
        const y2 = centerY + rInner * Math.sin(endRad);
        const x3 = centerX + rOuter * Math.cos(endRad);
        const y3 = centerY + rOuter * Math.sin(endRad);
        const x4 = centerX + rOuter * Math.cos(startRad);
        const y4 = centerY + rOuter * Math.sin(startRad);

        const largeArcFlag = endDeg - startDeg <= 180 ? 0 : 1;

        const d = [
          "M", x1, y1,
          "A", rInner, rInner, 0, largeArcFlag, 1, x2, y2,
          "L", x3, y3,
          "A", rOuter, rOuter, 0, largeArcFlag, 0, x4, y4,
          "Z"
        ].join(" ");

        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path.setAttribute("d", d);
        path.setAttribute("fill", options.fill || "#ccc");
        path.setAttribute("class", "wheel-segment");
        path.setAttribute("tabindex", "0");
        path.setAttribute("role", "button");
        path.dataset.code = options.code;
        path.dataset.type = options.type;
        path.dataset.primary = options.primary || "";
        path.dataset.ring = options.ring || "";
        path.setAttribute("aria-label", options.ariaLabel || "");
        svg.appendChild(path);

        path.addEventListener("click", () => handleEmotionSelection(options.code));
        path.addEventListener("keydown", (ev) => {
          if (ev.key === "Enter" || ev.key === " ") {
            ev.preventDefault();
            handleEmotionSelection(options.code);
          }
        });

        return { path, startDeg, endDeg, rInner, rOuter };
      }

      const dotted = document.createElementNS("http://www.w3.org/2000/svg", "circle");
      dotted.setAttribute("cx", centerX);
      dotted.setAttribute("cy", centerY);
      dotted.setAttribute("r", (diadInnerR + diadOuterR) / 2);
      dotted.setAttribute("class", "wheel-dotted-circle");
      svg.appendChild(dotted);

      const allSegments = {};

      // Pétalas de intensidade
      PRIMARIES.forEach((primary) => {
        const baseAngle = primary.angle;
        const width = stepAngle * 0.80;
        const start = baseAngle - width / 2;
        const end = baseAngle + width / 2;
        const baseColor = primary.colors;

        const intensities = INTENSITY_CONFIG[primary.key];

        intensities.forEach((item) => {
          let rin, rout, delta;
          if (item.ring === "high") {
            rin = innerR;
            rout = (innerR + midR) / 2;
            delta = -25;
          } else if (item.ring === "mid") {
            rin = (innerR + midR) / 2;
            rout = (midR + outerR) / 2;
            delta = 0;
          } else {
            rin = (midR + outerR) / 2;
            rout = outerR;
            delta = 20;
          }

          const fillColor = shadeColor(baseColor, delta);
          const seg = createWedge(
            rin,
            rout,
            start,
            end,
            {
              fill: fillColor,
              code: item.code,
              type: "primary",
              primary: primary.key,
              ring: item.ring,
              ariaLabel: item.label + " (" + PRIMARY_LABELS[primary.key] + ")"
            }
          );
          allSegments[item.code] = seg;

          const labelAngle = baseAngle;
          const labelRadius = (rin + rout) / 2;
          const lx = centerX + labelRadius * Math.cos(degToRad(labelAngle));
          const ly = centerY + labelRadius * Math.sin(degToRad(labelAngle));

          const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
          text.setAttribute("x", lx);
          text.setAttribute("y", ly + 2);
          text.setAttribute("class", "wheel-label");
          text.textContent = item.label.toLowerCase();
          svg.appendChild(text);
        });
      });

      // Diades
      DIADS.forEach((diad, index) => {
        const primary = PRIMARIES[index];
        const baseAngle = primary.angle + stepAngle / 2;
        const width = stepAngle * 0.55;
        const start = baseAngle - width / 2;
        const end = baseAngle + width / 2;
        const baseColor = PRIMARIES[index].colors;
        const fillColor = shadeColor(baseColor, 25);

        const seg = createWedge(
          diadInnerR,
          diadOuterR,
          start,
          end,
          {
            fill: fillColor,
            code: diad.code,
            type: "diad",
            primary: diad.primaryA,
            ring: "diad",
            ariaLabel: diad.label
          }
        );
        allSegments[diad.code] = seg;

        const labelAngle = baseAngle;
        const labelRadius = (diadInnerR + diadOuterR) / 2;
        const lx = centerX + labelRadius * Math.cos(degToRad(labelAngle));
        const ly = centerY + labelRadius * Math.sin(degToRad(labelAngle));

        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("x", lx);
        text.setAttribute("y", ly + 2);
        text.setAttribute("class", "wheel-label");
        text.textContent = diad.label.toLowerCase();
        svg.appendChild(text);
      });

      window._wheelSegments = allSegments;
    }

    /* ------------------------------------------------------------------
       Estado
       ------------------------------------------------------------------ */

    let currentEmotionCode = null;
    let currentChart = null;
    const STORAGE_KEY = "plutchik_records_v1";
    let feedbackTimeoutId = null;

    function getRecords() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch {
        return [];
      }
    }

    function saveRecords(records) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
    }

    /* ------------------------------------------------------------------
       Feedback visual
       ------------------------------------------------------------------ */

    function showFeedback(message, type) {
      const el = document.getElementById("feedbackBanner");
      if (!el) return;

      el.textContent = message;
      el.className = "feedback-banner is-visible";

      if (type === "success") {
        el.classList.add("feedback-banner--success");
      } else if (type === "error") {
        el.classList.add("feedback-banner--error");
      }

      if (feedbackTimeoutId) {
        clearTimeout(feedbackTimeoutId);
      }
      feedbackTimeoutId = setTimeout(() => {
        el.classList.remove("is-visible", "feedback-banner--success", "feedback-banner--error");
        el.textContent = "";
      }, 5000);
    }

    /* ------------------------------------------------------------------
       Detalhes
       ------------------------------------------------------------------ */

    function handleEmotionSelection(code) {
      const info = INFO_MAP[code];
      if (!info) return;

      currentEmotionCode = code;

      if (window._wheelSegments) {
        Object.values(window._wheelSegments).forEach(obj => obj.path.classList.remove("highlight"));
        const seg = window._wheelSegments[code];
        if (seg) seg.path.classList.add("highlight");
      }

      const card = document.getElementById("detailsCard");
      const primaryLabel = info.primary ? PRIMARY_LABELS[info.primary] : null;

      let levelText = "";
      if (info.type === "primary") {
        if (info.ring === "high") levelText = "Alta intensidade";
        else if (info.ring === "mid") levelText = "Intensidade média";
        else levelText = "Baixa intensidade";
      } else {
        levelText = "Combinação de duas emoções adjacentes (diade)";
      }

      let typeText = "";
      if (info.type === "primary" && primaryLabel) {
        typeText = "Emoção básica: " + primaryLabel;
      } else if (info.type === "diad" && info.primaries) {
        typeText = "Combinação entre " + PRIMARY_LABELS[info.primaries[0]] + " e " + PRIMARY_LABELS[info.primaries[1]];
      }

      const createList = (items) => {
        if (!items || !items.length) return "";
        return "<ul class=\"details-list\">" + items.map(it => "<li>" + it + "</li>").join("") + "</ul>";
      };

      card.innerHTML = `
        <h3 class="details-emotion-name"><strong>${info.displayName}</strong></h3>
        <p class="details-emotion-meta">${levelText}${typeText ? " • " + typeText : ""}</p>
        <p class="details-block"><strong>Definição:</strong> ${info.definition}</p>
        <p class="details-block"><strong>Função adaptativa:</strong> ${info.adaptive}</p>
        <p class="details-block"><strong>Situações em que costuma aparecer:</strong></p>
        ${createList(info.situations)}
        <p class="details-block"><strong>Quando a emoção não é bem manejada:</strong></p>
        ${createList(info.risks)}
        <p class="details-block"><strong>Estratégias de regulação emocional:</strong></p>
        ${createList(info.strategies)}
        <p class="details-block"><strong>Perguntas para reflexão:</strong></p>
        ${createList(info.reflections)}
      `;

      const emotionInput = document.getElementById("selectedEmotion");
      let label = info.displayName;
      if (info.type === "primary" && primaryLabel) {
        label += " – " + primaryLabel;
      }
      if (info.type === "diad" && info.primaries) {
        label += " (" + PRIMARY_LABELS[info.primaries[0]] + " + " + PRIMARY_LABELS[info.primaries[1]] + ")";
      }
      emotionInput.value = label;

      document.getElementById("registerButton").disabled = false;
    }

    /* ------------------------------------------------------------------
       Histórico e gráfico
       ------------------------------------------------------------------ */

    function renderHistory() {
      const tbody = document.getElementById("historyBody");
      const emptyMsg = document.getElementById("historyEmptyMessage");
      const records = getRecords();

      tbody.innerHTML = "";

      if (!records.length) {
        emptyMsg.style.display = "block";
      } else {
        emptyMsg.style.display = "none";
      }

      records
        .slice()
        .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
        .forEach((rec) => {
          const tr = document.createElement("tr");
          const dateCell = document.createElement("td");
          const emotionCell = document.createElement("td");
          const intensityCell = document.createElement("td");
          const contextCell = document.createElement("td");

          dateCell.textContent = formatDateTime(new Date(rec.createdAt));
          emotionCell.textContent = rec.emotionLabel;
          intensityCell.textContent = rec.userIntensity;
          contextCell.textContent = truncate(rec.context || "", 120);

          tr.appendChild(dateCell);
          tr.appendChild(emotionCell);
          tr.appendChild(intensityCell);
          tr.appendChild(contextCell);
          tbody.appendChild(tr);
        });
    }

    function buildChart() {
      const canvas = document.getElementById("emotionChart");
      const ctx = canvas.getContext("2d");

      const labels = [
        "Alegria",
        "Confiança",
        "Medo",
        "Surpresa",
        "Tristeza",
        "Nojo",
        "Raiva",
        "Antecipação"
      ];

      const styles = getComputedStyle(document.body);
      const textColor = styles.getPropertyValue("--text-main").trim() || "#111827";

      currentChart = new Chart(ctx, {
        type: "bar",
        data: {
          labels,
          datasets: [{
            label: "Registros",
            data: new Array(labels.length).fill(0)
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              ticks: { color: textColor },
              grid: { display: false }
            },
            y: {
              ticks: { color: textColor },
              grid: { color: "rgba(148, 163, 184, 0.3)" },
              beginAtZero: true,
              precision: 0
            }
          },
          plugins: {
            legend: {
              labels: {
                color: textColor
              }
            }
          }
        }
      });

      updateChart();
    }

    function updateChart() {
      if (!currentChart) return;
      const records = getRecords();
      const counts = {
        joy: 0,
        trust: 0,
        fear: 0,
        surprise: 0,
        sadness: 0,
        disgust: 0,
        anger: 0,
        anticipation: 0
      };

      records.forEach((rec) => {
        if (rec.type === "primary" && rec.primaryKey) {
          counts[rec.primaryKey] = (counts[rec.primaryKey] || 0) + 1;
        } else if (rec.type === "diad" && rec.primaries) {
          rec.primaries.forEach((p) => {
            counts[p] = (counts[p] || 0) + 0.5;
          });
        }
      });

      currentChart.data.datasets[0].data = [
        counts.joy,
        counts.trust,
        counts.fear,
        counts.surprise,
        counts.sadness,
        counts.disgust,
        counts.anger,
        counts.anticipation
      ];
      currentChart.update();
    }

    function updateChartColors() {
      if (!currentChart) return;
      const styles = getComputedStyle(document.body);
      const textColor = styles.getPropertyValue("--text-main").trim() || "#111827";

      currentChart.options.scales.x.ticks.color = textColor;
      currentChart.options.scales.y.ticks.color = textColor;
      if (currentChart.options.plugins && currentChart.options.plugins.legend && currentChart.options.plugins.legend.labels) {
        currentChart.options.plugins.legend.labels.color = textColor;
      }
      currentChart.update();
    }

    /* ------------------------------------------------------------------
       Registro
       ------------------------------------------------------------------ */

    function handleFormSubmit(event) {
      event.preventDefault();
      if (!currentEmotionCode || !INFO_MAP[currentEmotionCode]) {
        showFeedback("Selecione uma emoção na roda antes de registrar.", "error");
        return;
      }

      const info = INFO_MAP[currentEmotionCode];
      const name = document.getElementById("patientName").value.trim();
      const age = document.getElementById("patientAge").value.trim();
      const recordDate = document.getElementById("recordDate").value;
      const userIntensity = document.getElementById("userIntensity").value;
      const context = document.getElementById("contextInput").value.trim();
      const triggers = document.getElementById("triggersInput").value.trim();
      const behaviors = document.getElementById("behaviorsInput").value.trim();
      const desired = document.getElementById("desiredInput").value.trim();

      if (!context) {
        showFeedback("Para que o registro seja útil, descreva um pouco o contexto da emoção.", "error");
        return;
      }

      const now = new Date();
      const emotionLabelInput = document.getElementById("selectedEmotion").value.trim();
      const emotionLabel = emotionLabelInput || info.displayName;

      const record = {
        id: now.getTime(),
        createdAt: now.toISOString(),
        patientName: name,
        patientAge: age,
        patientDate: recordDate || null,
        emotionCode: currentEmotionCode,
        emotionLabel,
        type: info.type,
        ring: info.ring || "diad",
        primaryKey: info.primary || null,
        primaries: info.primaries || null,
        userIntensity,
        context,
        triggers,
        behaviors,
        desired
      };

      const records = getRecords();
      records.push(record);
      saveRecords(records);

      renderHistory();
      updateChart();

      showFeedback("Registro salvo neste dispositivo. Leve estas anotações para a próxima sessão.", "success");
    }

    /* ------------------------------------------------------------------
       PDF
       ------------------------------------------------------------------ */

    async function handleDownloadPdf() {
      if (!currentEmotionCode || !INFO_MAP[currentEmotionCode]) {
        alert("Selecione uma emoção na roda antes de gerar o PDF.");
        return;
      }

      const info = INFO_MAP[currentEmotionCode];
      const emotionLabelInput = document.getElementById("selectedEmotion").value.trim();
      const emotionLabel = emotionLabelInput || info.displayName;
      const userIntensity = document.getElementById("userIntensity").value;
      const name = document.getElementById("patientName").value.trim();
      const age = document.getElementById("patientAge").value.trim();
      const recordDate = document.getElementById("recordDate").value;
      const context = document.getElementById("contextInput").value.trim();
      const triggers = document.getElementById("triggersInput").value.trim();
      const behaviors = document.getElementById("behaviorsInput").value.trim();
      const desired = document.getElementById("desiredInput").value.trim();

      const now = new Date();
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF("p", "mm", "a4");

      const margin = 15;
      let y = 18;

      doc.setFont("helvetica", "bold");
      doc.setFontSize(16);
      doc.text("Registro Emocional – Roda de Plutchik", margin, y);
      y += 10;

      doc.setFontSize(12);
      doc.text("Dados principais", margin, y);
      y += 6;

      doc.setFontSize(10);
      doc.setFont("helvetica", "normal");

      const dateRefLabel = recordDate
        ? recordDate.split("-").reverse().join("/")
        : formatDateTime(now).split(" ")[0];

      const typeLabel = info.type === "primary"
        ? "Emoção primária"
        : "Combinação (diade)";

      let levelLabel;
      if (info.type === "primary") {
        if (info.ring === "high") levelLabel = "Alta intensidade";
        else if (info.ring === "mid") levelLabel = "Intensidade média";
        else levelLabel = "Baixa intensidade";
      } else {
        levelLabel = "Combinação de duas emoções adjacentes";
      }

      const dadosPrincipais = [
        "Nome do paciente: " + (name || "________________________"),
        "Idade: " + (age || "____"),
        "Data/hora de geração: " + formatDateTime(now),
        "Data de referência do registro: " + dateRefLabel,
        "Emoção selecionada: " + emotionLabel,
        "Tipo: " + typeLabel,
        "Intensidade na roda: " + levelLabel + " | Intensidade percebida: " + userIntensity
      ];

      dadosPrincipais.forEach((line) => {
        doc.text(line, margin, y);
        y += 5;
      });

      y += 2;

      doc.setFont("helvetica", "bold");
      doc.setFontSize(12);
      doc.text("Bloco psicoeducativo", margin, y);
      y += 6;

      doc.setFontSize(10);
      doc.setFont("helvetica", "normal");

      doc.text("Definição:", margin, y);
      y += 5;
      const defWrapped = doc.splitTextToSize(info.definition, 180);
      doc.text(defWrapped, margin + 4, y);
      y += defWrapped.length * 4 + 3;

      doc.text("Função adaptativa:", margin, y);
      y += 5;
      const adapWrapped = doc.splitTextToSize(info.adaptive, 180);
      doc.text(adapWrapped, margin + 4, y);
      y += adapWrapped.length * 4 + 4;

      doc.setFont("helvetica", "bold");
      doc.text("Principais riscos de manejo desadaptativo:", margin, y);
      y += 5;
      doc.setFont("helvetica", "normal");
      const riscosText = (info.risks || []).map(r => "• " + r).join(" ");
      const riscosWrapped = doc.splitTextToSize(riscosText || "–", 180);
      doc.text(riscosWrapped, margin + 4, y);
      y += riscosWrapped.length * 4 + 4;

      const tableBody = [
        ["Contexto emocional", context || "-"],
        ["Gatilhos percebidos", triggers || "-"],
        ["O que fez (respostas comportamentais)", behaviors || "-"],
        ["Como gostaria de ter reagido", desired || "-"]
      ];

      doc.autoTable({
        startY: y,
        head: [["Campo", "Conteúdo"]],
        body: tableBody,
        styles: { font: "helvetica", fontSize: 10, cellPadding: 3, valign: "top" },
        headStyles: { fillColor: [15, 23, 42], textColor: 255 },
        columnStyles: {
          0: { cellWidth: 60 },
          1: { cellWidth: 120 }
        },
        margin: { left: margin, right: margin }
      });

      let finalY = doc.lastAutoTable.finalY || y + 10;
      finalY += 8;

      doc.setFont("helvetica", "bold");
      doc.setFontSize(12);
      doc.text("Orientações gerais e espaço para anotações", margin, finalY);
      finalY += 6;

      doc.setFont("helvetica", "normal");
      doc.setFontSize(10);
      const closingText = doc.splitTextToSize(
        "Este registro é um ponto de partida para a conversa em psicoterapia. Use este material para identificar padrões, aprofundar reflexões e planejar respostas mais alinhadas aos seus valores. Abaixo, há espaço para anotações futuras do paciente e do psicólogo:",
        180
      );
      doc.text(closingText, margin, finalY);
      finalY += closingText.length * 4 + 4;

      for (let i = 0; i < 5; i++) {
        doc.line(margin, finalY, 210 - margin, finalY);
        finalY += 6;
      }

      doc.setFontSize(9);
      doc.setFont("helvetica", "italic");
      const footerText = "Richelmy Murta – Psicólogo Clínico. Ferramenta psicoeducativa baseada na Roda das Emoções de Plutchik.";
      doc.text(footerText, margin, 297 - 10);

      doc.save("registro-emocional-plutchik.pdf");
    }

    /* ------------------------------------------------------------------
       WhatsApp
       ------------------------------------------------------------------ */

    function handleSendWhatsapp() {
      if (!currentEmotionCode || !INFO_MAP[currentEmotionCode]) {
        alert("Selecione uma emoção na roda antes de enviar o resumo.");
        return;
      }

      const info = INFO_MAP[currentEmotionCode];
      const emotionLabelInput = document.getElementById("selectedEmotion").value.trim();
      const emotionLabel = emotionLabelInput || info.displayName;
      const userIntensity = document.getElementById("userIntensity").value;
      const name = document.getElementById("patientName").value.trim();
      const age = document.getElementById("patientAge").value.trim();
      const recordDate = document.getElementById("recordDate").value;
      const context = document.getElementById("contextInput").value.trim();
      const now = new Date();

      const dateLabel = recordDate
        ? recordDate.split("-").reverse().join("/")
        : formatDateTime(now).split(" ")[0];

      const shortContext = truncate(context || "", 200);

      const textPlain =
        "Registro emocional – Roda de Plutchik\n" +
        "Paciente: " + (name || "-") + (age ? " (" + age + " anos)" : "") + "\n" +
        "Data de referência: " + dateLabel + "\n" +
        "Emoção: " + emotionLabel + "\n" +
        "Intensidade percebida: " + userIntensity + "\n" +
        "Resumo do contexto: " + (shortContext || "-") + "\n\n" +
        "Mensagem gerada pela ferramenta clínica de psicoeducação emocional e registro de emoções.";

      // Substitua o número abaixo pelo número do psicólogo, se desejar
      const url = "https://wa.me/5535984640729?text=" + encodeURIComponent(textPlain);
      window.open(url, "_blank");
    }

    function handleSharePageWhatsapp() {
      const pageUrl = "https://ricmurtapsicologia.github.io/rodaemo-oes/";
      const textPlain =
        "Estou usando uma ferramenta gratuita de psicoeducação emocional baseada na Roda das Emoções de Plutchik para registrar emoções, contextos e respostas.\n\n" +
        "Ela ajuda a identificar sentimentos, entender a função das emoções e organizar registros para conversar em terapia.\n\n" +
        "Você pode acessar a ferramenta aqui: " + pageUrl;

      const url = "https://wa.me/?text=" + encodeURIComponent(textPlain);
      window.open(url, "_blank");
    }

    /* ------------------------------------------------------------------
       Tema claro/escuro
       ------------------------------------------------------------------ */

    function applyTheme(theme) {
      const body = document.body;
      const icon = document.getElementById("themeIcon");
      const label = document.getElementById("themeLabel");

      if (theme === "light") {
        body.dataset.theme = "light";
        if (icon) icon.textContent = "☀️";
        if (label) label.textContent = "Tema claro";
      } else {
        body.dataset.theme = "dark";
        if (icon) icon.textContent = "🌙";
        if (label) label.textContent = "Tema escuro";
      }

      // Opcional: manter registro, mas sempre iniciar em claro
      localStorage.setItem("plutchik_theme", theme);
      updateChartColors();
    }

    function initTheme() {
      // Requisito: sempre iniciar em modo claro, ignorando o último estado salvo
      applyTheme("light");

      const btn = document.getElementById("themeToggle");
      if (btn) {
        btn.addEventListener("click", () => {
          const next = document.body.dataset.theme === "light" ? "dark" : "light";
          applyTheme(next);
        });
      }
    }

    /* ------------------------------------------------------------------
       Onboarding
       ------------------------------------------------------------------ */

    function openOnboarding() {
      const modal = document.getElementById("onboardingModal");
      if (!modal) return;
      modal.hidden = false;
      const startBtn = document.getElementById("onboardingStartButton");
      if (startBtn) {
        startBtn.focus();
      }
    }

    function closeOnboarding() {
      const modal = document.getElementById("onboardingModal");
      if (!modal) return;
      modal.hidden = true;
    }

    function initOnboarding() {
      const openBtn = document.getElementById("openOnboardingButton");
      const closeBtn = document.getElementById("onboardingCloseButton");
      const startBtn = document.getElementById("onboardingStartButton");
      const modal = document.getElementById("onboardingModal");

      if (openBtn) {
        openBtn.addEventListener("click", () => {
          openOnboarding();
        });
      }

      if (closeBtn) {
        closeBtn.addEventListener("click", () => closeOnboarding());
      }

      if (startBtn) {
        startBtn.addEventListener("click", () => closeOnboarding());
      }

      if (modal) {
        modal.addEventListener("click", (event) => {
          if (event.target === modal) {
            closeOnboarding();
          }
        });

        document.addEventListener("keydown", (event) => {
          if (!modal.hidden && event.key === "Escape") {
            closeOnboarding();
          }
        });
      }

      // Onboarding deve aparecer sempre ao carregar a página
      openOnboarding();
    }

    /* ------------------------------------------------------------------
       Inicialização
       ------------------------------------------------------------------ */

    document.addEventListener("DOMContentLoaded", () => {
      const today = new Date();
      const isoToday = today.toISOString().slice(0, 10);
      const recordDateInput = document.getElementById("recordDate");
      if (recordDateInput) {
        recordDateInput.value = isoToday;
      }

      initTheme();
      buildWheel();
      renderHistory();
      buildChart();
      initOnboarding();

      document.getElementById("emotionForm").addEventListener("submit", handleFormSubmit);
      document.getElementById("downloadPdfButton").addEventListener("click", handleDownloadPdf);
      document.getElementById("sendWhatsappButton").addEventListener("click", handleSendWhatsapp);
      document.getElementById("sharePageButton").addEventListener("click", handleSharePageWhatsapp);

      document.getElementById("clearHistoryButton").addEventListener("click", () => {
        if (confirm("Deseja realmente apagar todo o histórico deste navegador?")) {
          saveRecords([]);
          renderHistory();
          updateChart();
          showFeedback("Histórico apagado deste dispositivo.", "success");
        }
      });
    });
  </script>
</body>
</html>
